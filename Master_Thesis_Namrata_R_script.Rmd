# This notebook contains code for the analysis done for my master thesis project. 
# Several dimensionality reduction plots were made using physico-chemical property scores and prediction scores on different dataset (canonical protein > 100 aa and peptides <= 75):
# 1. Human microproteins (chen et al. paper), human Globular and membrane protein (UniProt), human IDPs (DisProt) and human peptides (NCBI) and physiochemcial properties of IDs (CIDH920105	CHOP780101	CHOP780201	CHOP780202	KLEP840101).
# 2. Reference dataset: Human microproteins (chen et al. paper), human globular (SCOPe), membrane protein (mpstruc), human IDPs (DisProt) and human peptides (NCBI) and physiochemcial properties of IDs (CIDH920105	CHOP780101	CHOP780201	CHOP780202	KLEP840101).
# 3. Human microproteins (chen et al. paper), human globular (SCOPe), membrane protein (mpstruc), human IDPs (DisProt) and human peptides (NCBI) and 5 randomly selected physiochemcial properties of IDs ( CIDH920105,	CHOP780101,	KLEP840101, CHAM830105,ONEK900101) out of eight obtained from clustering.
# 4. Human microproteins (chen et al. paper), human globular (SCOPe), membrane protein (mpstruc), human IDPs (DisProt) and human peptides (NCBI) and eight physiochemcial properties corresponding to IDs (CIDH920105	CHOP780101	CHOP780201	CHOP780202	KLEP840101 CHAM830105 KARP850103 ONEK900101) that was obtained after clustering.
# Additional visulalizations and analysis includes:
# 5. Histograms to check length distribution of protein types.
# 6. Violin plots to check physico-chemical property score distribution for each protein type and physico-chemical property.
# 7. Statistical significanve testing on sub sampled dataset (100) with length distribution of subsampled data.
# 8. Correlation b/w AlphaFold pLDDT scores and physico-chemical property.
# 9. Clustering analysis to find key representative physico-chemical properties.

```{r}
library(Rtsne)
library(umap)
library(ggplot2)
library(usethis)
library(dplyr)
library(data.table)
library(tidyr)
library(Biostrings)
library(seqinr)
library(car)
library(dunn.test) # for pairwise comparison
library(ggpubr)
library(DescTools)
library(FSA)
library(effsize)
library(broom)
library(car)
library(multcomp)
library(tibble) # for rownames_to_column
library(tidyverse)
library(readxl)
library(reshape2)
library(corrplot)
library(psych)
library(factoextra)
library(gridExtra)
library(RColorBrewer) # For additional color options
library(viridis)
library(patchwork)
library(cluster)
library(stats)
```

# Script for performing descriptive statistics on physico-chemical proerties.
```{r}
# Loading the Excel file
pp_file_path <- "/Users/namrataxxx/Desktop/Master_Thesis_material/Docs_by_Joost/Physical_properties_edited.xlsx"
pp_df <- read_excel(pp_file_path)
head(pp_df)
View(pp_df)
pp_df_properties <- pp_df[, -1]
head(pp_df_properties)
pp_df_scaled <- scale(pp_df_properties)
head(pp_df_scaled)
# Selecting the first column
columns_to_add_pp_df <- pp_df[, 1]

# Adding selected columns to pp_df_scaled
pp_df_scaled <- cbind(columns_to_add_pp_df,pp_df_scaled)
head(pp_df_scaled)

# Melt the dataframe for ggplot
pp_df_melted_scaled <- melt(pp_df_scaled, id.vars = "AA", variable.name = "AminoAcid", value.name = "Score")

# Boxplots
boxplot_pp <- ggplot(pp_df_melted_scaled, aes(x = AminoAcid, y = Score, fill = AminoAcid)) +
  geom_boxplot(alpha = 0.5, outlier.shape = 15, outlier.size = 1.5, outlier.color = "red") +
  scale_fill_manual(values = rainbow(length(unique(pp_df_melted_scaled$AminoAcid)))) +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.5, size = 12, face = "bold"),
    axis.text.y = element_text(size = 12),
    axis.title.x = element_text(size = 12, face = "bold"),
    axis.title.y = element_text(size = 12, face = "bold"),
    plot.title = element_text(size = 14, face = "bold", hjust = 0.5),
    legend.position = "none"
  ) +
  labs(
    x = "Amino Acid",
    y = "Physico-chemical Property Score"
  )

boxplot_pp
#ggsave(filename = "Boxplot_PP.pdf", plot = boxplot_pp, width = 10, height = 8)
```

# Script for reading and length normalizing data for different human protrein types : microproteins (chen et al. paper), human Globular and membrane protein (UniProt), human IDPs (DisProt) and human peptides (NCBI) and physiochemcial properties of IDs (CIDH920105	CHOP780101	CHOP780201	CHOP780202	KLEP840101) followed by UMAP, t-SNE, Violin plots. All the canonical proteins are above 100 aa and peptide <= 75.
```{r}
# Microprotein dataset (Chen et al. paper) with sequence IDs in rows and physico-cehmical property IDs (CIDH920105	CHOP780101	CHOP780201	CHOP780202	KLEP840101)  in columns. 
New_Micros <- read.table("/Users/namrataxxx/Desktop/Master_Thesis_material/Thesis_data_script_result/Joost_new_data/newData_micros_Human_physprops_Joost.txt", header=TRUE, sep="\t")
# Removing last column
New_Micros$X <- NULL
# Adding a new column named "type" with all values as "Microprotein"
New_Micros$type <- "Microprotein"
# placing the new column at the second position
New_Micros <- New_Micros[c(1, ncol(New_Micros), 2:(ncol(New_Micros)-1))]
#View(New_Micros)
dim(New_Micros) # 10694  x   8

# Standardizing/normalizing the physico-cehmical property scores by length of the sequence.
# List of physicochemical property columns to length normalize
properties <- c("CIDH920105","CHOP780101",	"CHOP780201",	"CHOP780202",	"KLEP840101")

# Normalizing each property score by the length
for (property in properties) {
  New_Micros[[paste0(property, "_norm")]] <- New_Micros[[property]] / New_Micros$length
}
head(New_Micros)

# Selecting columns 9 to 13 (the length normalized properties)
selected_data <- New_Micros[c(1:3,9:13)]
head(selected_data)

# Writing the selected columns to a new TXT file
write.table(selected_data, 'normalised_micros_weismann_5pp.txt', row.names = FALSE, quote = FALSE, sep = "\t")
```


```{r}
# Disordered protein dataset (DisProt database; filter options: non-ambiguous, non-obsolete ) with sequence IDs in rows and physico-cehmical property IDs (CIDH920105	CHOP780101	CHOP780201	CHOP780202	KLEP840101)  in columns.
New_disprot <- fread('/Users/namrataxxx/Desktop/Master_Thesis_material/Thesis_data_script_result/Joost_new_data/newData_disprot_Human_physprops_Joost.txt', header = TRUE, fill = TRUE, sep = "\t")
head(New_disprot)
View(New_disprot)

# Removing last column
New_disprot$V8 <- NULL

# Extracting the substring between "|" and "pos" for each entry in the 'protein' column
New_disprot[, protein_extracted := sub(".*\\|(.*)pos.*", "\\1", protein)]

# Replace the original 'protein' column with the extracted data
New_disprot[, protein := protein_extracted]
New_disprot[, protein_extracted := NULL]  # Remove the temporary column if it's not needed

# Viewing the first few rows to verify the changes
head(New_disprot)

# Selecting only the necessary columns
New_disprot <- New_disprot[, .(protein, length, CIDH920105,	CHOP780101,	CHOP780201,	CHOP780202,	KLEP840101)]
View(New_disprot)

# Adding a new column named "type" with all values as "Disordered protein"
New_disprot$type <- "Disordered protein"
# Placing the new column at the second position
New_disprot <- New_disprot %>%
  select(1, type, everything())
#head(New_disprot)

# Standardizing/normalizing the physico-cehmical property scores by length of the sequence.
# List of physicochemical property columns to length normalize
properties <- c("CIDH920105","CHOP780101",	"CHOP780201",	"CHOP780202",	"KLEP840101")

# Normalizing each property by the length
for (property in properties) {
  New_disprot[[paste0(property, "_norm")]] <- New_disprot[[property]] / New_disprot$length
}
#View(New_disprot)
dim(New_disprot) # 4587 x 13

# Specifying the columns I want to keep
selected_columns <- c("protein", "type", "length", "CIDH920105_norm", 
                     "CHOP780101_norm", "CHOP780201_norm", "CHOP780202_norm", "KLEP840101_norm")

# Selecting the specified columns
selected_data <- New_disprot[, ..selected_columns]

# Writing 'selected_data' to a text file as follows:
write.table(selected_data, "normalized_disordered_Disprot_5pp.txt", sep = "\t", row.names = FALSE, quote = FALSE)

```

```{r}
# Trans-membrane protein dataset (UniProt; filters:Location-Transmembrane, Reviewed) with sequence IDs in rows and physico-cehmical property IDs (CIDH920105	CHOP780101	CHOP780201	CHOP780202	KLEP840101)in columns.

New_Human_memb_prot <- read.table("/Users/namrataxxx/Desktop/Master_Thesis_material/Thesis_data_script_result/Joost_new_data/newData_TM_Human_physprops_Joost.txt", header=TRUE, sep="\t")
#View(New_Human_memb_prot)
# Removing last column
New_Human_memb_prot$X <- NULL

# Using sub() to extract the substring after the second "|" and before "OS="
New_Human_memb_prot$protein <- sub(".*\\|.*\\|([^=]+) OS=.*", "\\1", New_Human_memb_prot$protein)

# Viewing the first few rows to verify the changes
head(New_Human_memb_prot)

# Adding a new column named "type" with all values as "Membrane protein"
New_Human_memb_prot$type <- "Membrane protein"
# Placing the new column at the second position
New_Human_memb_prot <- New_Human_memb_prot[c(1, ncol(New_Human_memb_prot), 2:(ncol(New_Human_memb_prot)-1))]
#View(New_Human_memb_prot)
dim(New_Human_memb_prot) #10539 x   8

# Standardizing/normalizing the physico-cehmical property scores by length of the sequence.
# List of physicochemical property columns to length normalize
properties <- c("CIDH920105","CHOP780101",	"CHOP780201",	"CHOP780202",	"KLEP840101")

# Normalizing each property by the length
for (property in properties) {
  New_Human_memb_prot[[paste0(property, "_norm")]] <- New_Human_memb_prot[[property]] /New_Human_memb_prot$length
}

# Selecting columns 9 to 13 (the length normalized properties)
selected_data <- New_Human_memb_prot[c(1:3,9:13)]
head(selected_data)
# Writing 'selected_data' to a text file as follows:
write.table(selected_data, "normalized_Transmemb_UniProt_5pp.txt", sep = "\t", row.names = FALSE, quote = FALSE)
```

```{r}
# Globular proteins dataset (UniProt database; filters: Reviewed, Homo sapiens, Cytosol, Topological domain, Active,etc) with sequence IDs in rows and physico-cehmical property IDs (CIDH920105	CHOP780101	CHOP780201	CHOP780202	KLEP840101)in columns.

New_Human_glob_prot <- read.table("/Users/namrataxxx/Desktop/Master_Thesis_material/Thesis_data_script_result/Joost_new_data/newData_globular_Human_physprops_Joost.txt", header=TRUE, sep="\t")
#View(New_Human_glob_prot)
# Removing last column
New_Human_glob_prot$X <- NULL

# Using sub() to extract the substring after the second "|" and before "OS="
New_Human_glob_prot$protein <- sub(".*\\|.*\\|([^=]+) OS=.*", "\\1", New_Human_glob_prot$protein)

# Viewing the first few rows to verify the changes
head(New_Human_glob_prot)

# Adding a new column named "type" with all values as "micro"
New_Human_glob_prot$type <- "Globular protein"
# Placing the new column at the second position
New_Human_glob_prot <- New_Human_glob_prot[c(1, ncol(New_Human_glob_prot), 2:(ncol(New_Human_glob_prot)-1))]
View(New_Human_glob_prot)
dim(New_Human_glob_prot) #373 x  8

# Standardizing/normalizing the physico-cehmical property scores by length of the sequence.
# List of physicochemical property columns to length normalize
properties <- c("CIDH920105","CHOP780101",	"CHOP780201",	"CHOP780202",	"KLEP840101")

# Normalizing each property by the length
for (property in properties) {
  New_Human_glob_prot[[paste0(property, "_norm")]] <- New_Human_glob_prot[[property]] /New_Human_glob_prot$length
}

# Selecting columns (the length normalized properties)
selected_data <- New_Human_glob_prot[c(1,2,3,9,10,11,12,13)]
head(selected_data)
# Writing 'selected_data' to a text file as follows:
write.table(selected_data, "normalized_globular_prot_5pp.txt", sep = "\t", row.names = FALSE, quote = FALSE)
```

```{r}
# Peptides datasets (NCBI ) with sequence IDs in rows and physico-cehmical property IDs (CIDH920105	CHOP780101	CHOP780201	CHOP780202	KLEP840101 CHAM830105 KARP850103 ONEK900101)in columns. 
Human_peptideSeq_NCBI_new_8pp<- read.table("/Users/namrataxxx/Desktop/Master_Thesis_material/Thesis_data_script_result/Weismann_Scope_MObiDB_Mpstruc_DimRed_JoostIDs/8physpropIDs_dataset/human_peptideSeq_NCBI_new_8physpropsIDs.txt", header=TRUE, sep="\t")
dim(Human_peptideSeq_NCBI_new_8pp) # 2212 x  11
head(Human_peptideSeq_NCBI_new_8pp)
# Removing last column
Human_peptideSeq_NCBI_new_8pp$X <- NULL
# Adding a new column named "type" with all values as "micro"
Human_peptideSeq_NCBI_new_8pp$type <- "Peptide"
# Placing the new column at the second position
Human_peptideSeq_NCBI_new_8pp <- Human_peptideSeq_NCBI_new_8pp[c(1, ncol(Human_peptideSeq_NCBI_new_8pp), 2:(ncol(Human_peptideSeq_NCBI_new_8pp)-1))]
#View(Human_peptideSeq_NCBI_8pp)
dim(Human_peptideSeq_NCBI_new_8pp) # 2212 x  11

# Standardizing/normalizing the physico-cehmical property scores by length of the sequence.
# List of physicochemical property columns to length normalize
properties <- c("CIDH920105","CHOP780101",	"CHOP780201",	"CHOP780202",	"KLEP840101","CHAM830105","KARP850103","ONEK900101")

# Normalizing each property by the length
for (property in properties) {
  Human_peptideSeq_NCBI_new_8pp[[paste0(property, "_norm")]] <- Human_peptideSeq_NCBI_new_8pp[[property]] / Human_peptideSeq_NCBI_new_8pp$length
}
head(Human_peptideSeq_NCBI_new_8pp)
View(Human_peptideSeq_NCBI_new_8pp)

# Selecting columns (the length normalized properties)
selected_data_5pp <- Human_peptideSeq_NCBI_new_8pp[c(1:3,12:16)]
head(selected_data_5pp)
# Writing 'selected_data_5pp' to a text file as follows:
write.table(selected_data_5pp, 'normalized_peptideSeq_NCBI_new_5pp.txt', row.names = FALSE, quote = FALSE, sep = "\t")
```

```{r}
# Combining the normalized dataset with canonical proteins length > 100 aa and peptides <= 75.
New_Micros_dim_j <- read.table("/Users/namrataxxx/Desktop/Master_Thesis_material/Thesis_data_script_result/Weismann_Scope_MObiDB_Mpstruc_DimRed_JoostIDs/5_Joost_IDs_Uniprot_Weismann_Disprot_NCBI/normalised_micros_weismann_5pp.txt", header=TRUE, sep="\t")
dim(New_Micros_dim_j) # 10694  x  8 
#View(New_Micros_dim_j)
New_Disprot_dim_j <- fread("/Users/namrataxxx/Desktop/Master_Thesis_material/Thesis_data_script_result/Weismann_Scope_MObiDB_Mpstruc_DimRed_JoostIDs/5_Joost_IDs_Uniprot_Weismann_Disprot_NCBI/normalized_disordered_Disprot_5pp.txt", header = TRUE, fill = TRUE, sep = "\t")
dim(New_Disprot_dim_j) # 4587 x  8
New_Human_memb_prot_uniprot_dim_j <- read.table("/Users/namrataxxx/Desktop/Master_Thesis_material/Thesis_data_script_result/Weismann_Scope_MObiDB_Mpstruc_DimRed_JoostIDs/5_Joost_IDs_Uniprot_Weismann_Disprot_NCBI/normalized_Transmemb_UniProt_5pp.txt", header=TRUE, sep="\t")
dim(New_Human_memb_prot_uniprot_dim_j) # 10539 x 8
New_Human_glob_prot_uniprot_dim_j <- read.table("/Users/namrataxxx/Desktop/Master_Thesis_material/Thesis_data_script_result/Weismann_Scope_MObiDB_Mpstruc_DimRed_JoostIDs/5_Joost_IDs_Uniprot_Weismann_Disprot_NCBI/normalized_globular_prot_5pp.txt", header=TRUE, sep="\t")
dim(New_Human_glob_prot_uniprot_dim_j) # 373 x  8

New_Human_peptide_new <- read.table("/Users/namrataxxx/Desktop/Master_Thesis_material/Thesis_data_script_result/Weismann_Scope_MObiDB_Mpstruc_DimRed_JoostIDs/5_Joost_IDs_Uniprot_Weismann_Disprot_NCBI/normalized_peptideSeq_NCBI_new_5pp.txt", header=TRUE, sep="\t")
dim(New_Human_peptide_new) # 2212 x  8

# Filtering peptides with length <=75 aa
normalized_human_peptideSeq_NCBI_new_5pp_smallerORequal75 <- New_Human_peptide_new %>% filter(length <= 75)
dim(normalized_human_peptideSeq_NCBI_new_5pp_smallerORequal75) # 1381 x 8
#View(normalized_human_peptideSeq_NCBI_new_5pp_smallerORequal75)

# Filtering for disordered proteins larger than 100 amino acids
normalized_human_disprot_Disprot_dim_j_longerthan100 <- New_Disprot_dim_j[length > 100]
dim(normalized_human_disprot_Disprot_dim_j_longerthan100) # 1069 x 8
#View(normalized_human_disprot_Disprot_dim_j_longerthan100) 

# Filtering for membrane proteins larger than 100 amino acids
normalized_human_membprot_uniprot_dim_j_longerthan100 <- New_Human_memb_prot_uniprot_dim_j %>% filter(length > 100)
dim(normalized_human_membprot_uniprot_dim_j_longerthan100) # 10258 x 8
#View(normalized_human_membprot_uniprot_dim_j_longerthan100)

# Filtering for globular proteins larger than 100 amino acids
normalized_human_glob_prot_Uniprot_dim_j_longerthan100 <- New_Human_glob_prot_uniprot_dim_j %>% filter(length > 100)
dim(normalized_human_glob_prot_Uniprot_dim_j_longerthan100) # 363 x 8
#View(normalized_human_glob_prot_Uniprot_dim_j_longerthan100)

new_micros_t_dim_j <- New_Micros_dim_j[sample(nrow(New_Micros_dim_j), 5000),]  #subsampling to reduce microprotein set size 
dim(new_micros_t_dim_j) # 5000 x  8
head(new_micros_t_dim_j)
new_TM_t_dim_j <- normalized_human_membprot_uniprot_dim_j_longerthan100[sample(nrow(normalized_human_membprot_uniprot_dim_j_longerthan100), 5000),] #subsampling to reduce membrane protein set size
dim(new_TM_t_dim_j) # 5000 x  8

new_micros_tt_dim_j <- rbind(new_micros_t_dim_j,normalized_human_disprot_Disprot_dim_j_longerthan100)
head(new_micros_tt_dim_j)
new_micros_ttt_dim_j <- rbind(new_micros_tt_dim_j, new_TM_t_dim_j)
new_micros_dim_j <- rbind(new_micros_ttt_dim_j,normalized_human_glob_prot_Uniprot_dim_j_longerthan100)
new_micros_dim_j <- rbind(new_micros_dim_j,normalized_human_peptideSeq_NCBI_new_5pp_smallerORequal75)
dim(new_micros_dim_j) # 12813 x 8
head(new_micros_dim_j)
View(new_micros_dim_j)
sum(is.na(new_micros_dim_j))
new_micros_dim_j <- na.omit(new_micros_dim_j)
```

```{r}
# Preparing the data for UMAP, selecting only the columns with the physical property values
umap_data_new_micros_dim_j <- new_micros_dim_j[, c("CIDH920105_norm", "CHOP780101_norm", "CHOP780201_norm", "CHOP780202_norm", "KLEP840101_norm")]
head(umap_data_new_micros_dim_j)
# Running UMAP
set.seed(48) # Setting a random seed for reproducibility
umap_result_j_dim_j <- umap(umap_data_new_micros_dim_j,n_neighbors=15, min_dist=0.3)

# Creating a data frame for plotting that includes the UMAP dimensions and the protein type
plot_data_j <- data.frame(UMAP1 = umap_result_j_dim_j$layout[,1], UMAP2 = umap_result_j_dim_j$layout[,2], Type = new_micros_dim_j$type)
head(plot_data_j)

my_colors_new_micros_dim_j1 <- c("Disordered protein" = "red", "Globular protein" = "green", "Membrane protein" = "blue", "Microprotein" = "yellow", "Peptide" = "pink")

# Plotting using ggplot2
p1_new <- ggplot(plot_data_j, aes(x = UMAP1, y = UMAP2, color = Type)) +
  geom_point(size=0.3, alpha=1) + # Adjust point transparency with the alpha parameter
    scale_color_manual(values = my_colors_new_micros_dim_j1) + # Use the custom colors
  labs(title = "UMAP Visualization of Protein Clusters_UniProt_Weismann_Disprot_DB(Joost)",
       x = "UMAP Dimension 1",
       y = "UMAP Dimension 2",
       color = "Protein Type") +
  theme_minimal()
p1_new
```

```{r}
# Performing t-SNE
set.seed(42) # Setting a random seed for reproducibility
tsne_result_dimj <- Rtsne(dist(umap_data_new_micros_dim_j), dims = 2, perplexity = 15, theta = 0.0, max_iter= 1000, verbose = FALSE )

# Creating a data frame for plotting that includes the t-SNE dimensions and the protein type
tsne_data_dimj <- data.frame(TSNE1 = tsne_result_dimj$Y[,1], TSNE2 = tsne_result_dimj$Y[,2], Type = new_micros_dim_j$type)

my_colors_new_micros_dim_j1 <- c("Disordered protein" = "red", "Globular protein" = "green", "Membrane protein" = "blue", "Microprotein" = "yellow", "Peptide" = "pink")
# Plotting using ggplot2
p3_t_SNE <- ggplot(tsne_data_dimj, aes(x = TSNE1, y = TSNE2, color = Type)) +
  geom_point(size=0.65, alpha=0.75) +
  scale_color_manual(values = my_colors_new_micros_dim_j1) + # Use the custom colors
  labs(title = "t-SNE Visualization of Protein Clusters_UniProt_Weismann_Disprot_DB(Joost)",
       x = "t-SNE Dimension 1",
       y = "t-SNE Dimension 2",
       color = "Protein Type") +
  theme_minimal()
p3_t_SNE
```

```{r}
# Performing t-SNE on scaled physical property scores
new_micros_dim_j_properties <- new_micros_dim_j[, c(4:8)]
head(new_micros_dim_j_properties)

# Standardizing the properties in dataframe combined_disport_control2_5PP_J
new_micros_dim_j_scaled <- scale(new_micros_dim_j_properties)
head(new_micros_dim_j_scaled)

# Preparing the data for UMAP, selecting only the columns with the physical property values
umap_data_new_micros_dim_j_scaled <- new_micros_dim_j_scaled[, c("CIDH920105_norm", "CHOP780101_norm", "CHOP780201_norm", "CHOP780202_norm", "KLEP840101_norm")]

# Performing t-SNE
set.seed(42) # Set a random seed for reproducibility
tsne_result_dimj_scaled <- Rtsne(dist(umap_data_new_micros_dim_j_scaled), dims = 2, perplexity = 15, theta = 0.0, max_iter= 1000, verbose = FALSE )

# Creating a data frame for plotting that includes the t-SNE dimensions and the protein type
tsne_data_dimj_scaled <- data.frame(TSNE1 = tsne_result_dimj_scaled$Y[,1], TSNE2 = tsne_result_dimj_scaled$Y[,2], Type = new_micros_dim_j$type)

my_colors_new_micros_dim_j1 <- c("Disordered protein" = "red", "Globular protein" = "green", "Membrane protein" = "blue", "Microprotein" = "yellow", "Peptide" = "pink")
# Plotting using ggplot2
p3_t_SNE_scaled <- ggplot(tsne_data_dimj_scaled, aes(x = TSNE1, y = TSNE2, color = Type)) +
  geom_point(size=0.65, alpha=0.75) +
  scale_color_manual(values = my_colors_new_micros_dim_j1) + # Use the custom colors
  labs(title = "t-SNE Visualization of Protein Clusters_UniProt_Weismann_Disprot_DB(Joost)_scaled",
       x = "t-SNE Dimension 1",
       y = "t-SNE Dimension 2",
       color = "Protein Type") +
  theme_minimal()
p3_t_SNE_scaled
```

```{r}
# Making violin plots to check the distribution of the physico-chemical property scores on the above dataset (microproteins (chen et al. paper), human Globular and membrane protein (UniProt), human IDPs (DisProt) and human peptides (NCBI))

# Selecting the first 3 columns of combined_disport_control6_5PP_J
columns_to_add_new_micros_dim_j_scaled <- new_micros_dim_j[, 1:3]

# Adding selected columns to combined_disport_control6_5PP_J_scaled
new_micros_dim_j_scaled <- cbind(columns_to_add_new_micros_dim_j_scaled,new_micros_dim_j_scaled)
head(new_micros_dim_j_scaled)

# Custom colors 
my_colors_new_micros_dim_j1 <- c("Disordered protein" = "red", "Globular protein" = "green", "Membrane protein" = "blue", "Microprotein" = "yellow", "Peptide" = "pink")
# Reshaping the dataframe to long format
df_long_new_micros_dim_j <- new_micros_dim_j_scaled %>%
  pivot_longer(cols = c("CIDH920105_norm", "CHOP780101_norm", "CHOP780201_norm", "CHOP780202_norm","KLEP840101_norm"),names_to = "property",
               values_to = "score")

# Function to create and adjust violin plot for a given property
create_violin_plot_new_micros_dim_j <- function(property_name, y_limits = NULL) {
  p <- ggplot(subset(df_long_new_micros_dim_j, property == property_name), aes(x = type, y = score, fill = type)) +
    geom_violin(trim = FALSE, adjust = 1.5) +  # adjust parameter smooths the violin plot
    geom_boxplot(width=0.05, fill="white", outlier.shape = NA, position=position_dodge(width=0.25)) + # Adjust width and position
    scale_fill_manual(values = my_colors_new_micros_dim_j1) +
    theme_minimal() +
    theme(axis.text.x = element_text(angle = 45, hjust = 1),
          legend.position = "none") +
    labs(x = "Protein_Type", y = "Normalized physico-chemical property score", title = property_name)

  # Adjust y-axis limits if provided
  if (!is.null(y_limits)) {
    p <- p + ylim(y_limits)
  }

  return(p)
}

# Generating plot for the CIDH920105_norm property with adjusted limits
p_CIDH920105_norm_new_micros_dim_j <- create_violin_plot_new_micros_dim_j("CIDH920105_norm", c(-0.8, 0.8))
print(p_CIDH920105_norm_new_micros_dim_j)
```
```{r}
p_CHOP780101_norm_new_micros_dim_j <- create_violin_plot_new_micros_dim_j("CHOP780101_norm",c(-0.8, 1))
print(p_CHOP780101_norm_new_micros_dim_j)
```
```{r}
p_CHOP780201_norm_new_micros_dim_j <- create_violin_plot_new_micros_dim_j("CHOP780201_norm",c(-0.8, 1))
print(p_CHOP780201_norm_new_micros_dim_j)
```

```{r}
p_CHOP780202_norm_new_micros_dim_j <- create_violin_plot_new_micros_dim_j("CHOP780202_norm",c(-0.8, 1))
print(p_CHOP780202_norm_new_micros_dim_j)
```

```{r}
p_KLEP840101_norm_new_micros_dim_j <- create_violin_plot_new_micros_dim_j("KLEP840101_norm",c(-0.8, 0.7))
print(p_KLEP840101_norm_new_micros_dim_j)
```
# Script for reading and length normalizing data for different human protrein types : microprotein (Chen et al.), IDP (DisProt), globular protein (SCOPe), membrane protein (mpstruc database) and peptides(NCBI) and physiochemcial properties of IDs (CIDH920105	CHOP780101	CHOP780201	CHOP780202	KLEP840101) followed by UMAP, t-SNE, Violin plots. All the canonical proteins are above 100 aa and peptide <= 75.
```{r}
# Reading normalized data and prepapring for UMAP analysis
normalized_human_uprot_weismann_8physpropsids <- read.table("/Users/namrataxxx/Desktop/Master_Thesis_material/Thesis_data_script_result/Weismann_Scope_MObiDB_Mpstruc_DimRed_JoostIDs/8physpropIDs_dataset/normalized_human_uprot_weismann_8physpropsids.txt", header=TRUE, sep="\t")
dim(normalized_human_uprot_weismann_8physpropsids) # 10694  x  11
#View(normalized_human_uprot_weismann_8physpropsids)

normalized_human_membprot_mpstruc_8physpropsids <- read.table("/Users/namrataxxx/Desktop/Master_Thesis_material/Thesis_data_script_result/Weismann_Scope_MObiDB_Mpstruc_DimRed_JoostIDs/8physpropIDs_dataset/normalized_human_membprot_mpstruc_8physpropsids.txt", header=TRUE, sep="\t")
dim(normalized_human_membprot_mpstruc_8physpropsids) # 1705 x 11
#View(normalized_human_membprot_mpstruc_8physpropsids)

# Filtering for membrane proteins larger than 100 amino acids
normalized_human_membprot_mpstruc_8physpropsids_longerthan100 <- normalized_human_membprot_mpstruc_8physpropsids %>% filter(length > 100)
dim(normalized_human_membprot_mpstruc_8physpropsids_longerthan100) # 1428 x 11
#View(normalized_human_membprot_mpstruc_8physpropsids_longerthan100)

normalized_human_globprot_scopeastral40_8physpropids <- read.table("/Users/namrataxxx/Desktop/Master_Thesis_material/Thesis_data_script_result/Weismann_Scope_MObiDB_Mpstruc_DimRed_JoostIDs/8physpropIDs_dataset/normalized_human_globprot_scopeastral40_8physpropids.txt", header=TRUE, sep="\t")
dim(normalized_human_globprot_scopeastral40_8physpropids) # 2741 x  11

# Filtering for globular proteins larger than 100 amino acids
normalized_human_globprot_scopeastral40_8physpropsids_longerthan100 <- normalized_human_globprot_scopeastral40_8physpropids %>% filter(length > 100)
dim(normalized_human_globprot_scopeastral40_8physpropsids_longerthan100) # 1718 x 11
#View(normalized_human_globprot_scopeastral40_8physpropsids_longerthan100)

normalized_human_peptideSeq_NCBI_new_8physphrosids <- read.table("/Users/namrataxxx/Desktop/Master_Thesis_material/Thesis_data_script_result/Weismann_Scope_MObiDB_Mpstruc_DimRed_JoostIDs/8physpropIDs_dataset/normalized_human_peptideSeq_NCBI_new_8physphrosids.txt", header=TRUE, sep="\t")
dim(normalized_human_peptideSeq_NCBI_new_8physphrosids) # 2212 x  11

# Filtering peptides with length <=75 aa
normalized_human_peptideSeq_NCBI_new_8pp_smallerORequal75 <- normalized_human_peptideSeq_NCBI_new_8physphrosids %>% filter(length <= 75)
dim(normalized_human_peptideSeq_NCBI_new_8pp_smallerORequal75) # 1381 x 8
#View(normalized_human_peptideSeq_NCBI_new_8pp_smallerORequal75)

normalized_human_uprot_weismann_8physpropsids_5000 <- normalized_human_uprot_weismann_8physpropsids[sample(nrow(normalized_human_uprot_weismann_8physpropsids), 5000),]  #subsampling to reduce microprotein set size 
dim(normalized_human_uprot_weismann_8physpropsids_5000) # 5000 x  11
#head(normalized_human_uprot_weismann_8physpropsids_5000)

New_Disprot_dim_j <- fread("/Users/namrataxxx/Desktop/Master_Thesis_material/Thesis_data_script_result/Joost_new_data/normalized_newData_disprot_joost.txt", header = TRUE, fill = TRUE, sep = "\t")
dim(New_Disprot_dim_j) # 4587 x  8

# Filtering for disordered proteins larger than 100 amino acids
normalized_human_disprot_Disprot_dim_j_longerthan100 <- New_Disprot_dim_j[length > 100]
dim(normalized_human_disprot_Disprot_dim_j_longerthan100) # 1069 x 8
#View(normalized_human_disprot_Disprot_dim_j_longerthan100) 

control2_8PP_t <- rbind(normalized_human_uprot_weismann_8physpropsids_5000,normalized_human_membprot_mpstruc_8physpropsids_longerthan100)
control2_8PP_tt <- rbind(control2_8PP_t,normalized_human_globprot_scopeastral40_8physpropsids_longerthan100)
control2_8PP_ttt <- rbind(control2_8PP_tt,normalized_human_peptideSeq_NCBI_new_8pp_smallerORequal75)
dim(control2_8PP_ttt) # 9527 x 11
head(control2_8PP_ttt)
control2_5PP_J_tttt <- control2_8PP_ttt[c(1:8)]
head(control2_5PP_J_tttt)

# Adding IDP data from DisProt
combined_disport_control2_5PP_J <- rbind(control2_5PP_J_tttt,normalized_human_disprot_Disprot_dim_j_longerthan100)
dim(combined_disport_control2_5PP_J) # 10596 x 8
head(combined_disport_control2_5PP_J)
View(combined_disport_control2_5PP_J)
sum(is.na(combined_disport_control2_5PP_J))
combined_disport_control2_5PP_J <- na.omit(combined_disport_control2_5PP_J)

# Correcting the script to update 'type' column with new names
combined_disport_control2_5PP_J <- combined_disport_control2_5PP_J %>%
  mutate(type = case_when(
    type == "micro" ~ "Microprotein",
    type == "disprot" ~ "Disordered protein",
    type == "globular_prot_scope" ~ "Globular protein",
    type == "membrane_prot" ~ "Membrane protein",
    type == "peptide" ~ "Peptide",
    TRUE ~ type  # Preserves original type if none of the conditions above are met
  ))

```
# Script to plot length distribution for different protein types from the dataset (microprotein (Chen et al.), IDP (DisProt), globular protein (SCOPe), membrane protein (mpstruc database) and peptides(NCBI))
```{r}
# Filtering data for each protein type to make plot for length distribution
micro_proteins_combined_disport_control2_5PP_J <- combined_disport_control2_5PP_J[combined_disport_control2_5PP_J$type == 'Microprotein', ]
disprot_combined_disport_control2_5PP_J <- combined_disport_control2_5PP_J[combined_disport_control2_5PP_J$type == 'Disordered protein', ]
membrane_combined_disport_control2_5PP_J <- combined_disport_control2_5PP_J[combined_disport_control2_5PP_J$type == 'Membrane protein', ]
globular_combined_disport_control2_5PP_J <- combined_disport_control2_5PP_J[combined_disport_control2_5PP_J$type == 'Globular protein', ]
peptides_combined_disport_control2_5PP_J <- combined_disport_control2_5PP_J[combined_disport_control2_5PP_J$type == 'Peptide', ]

# Function to plot length distribution for a given protein type
plot_length_distribution <- function(protein_data, protein_type) {
  ggplot(protein_data, aes(x=length)) +
    geom_histogram(bins = 30, fill = 'orange', color = 'black') +
    labs(title = paste('Length Distribution of', protein_type),
         x = 'Length',
         y = 'Frequency') +
    theme_minimal()
}
```

```{r}
# Plotting length distribution for microproteins
plotMicro_combined_disport_control2_5PP_J <- plot_length_distribution(micro_proteins_combined_disport_control2_5PP_J, 'Microproteins')
print(plotMicro_combined_disport_control2_5PP_J)

```

```{r}
# Plotting length distribution for disordered proteins
plotDisprot_combined_disport_control2_5PP_J <- plot_length_distribution(disprot_combined_disport_control2_5PP_J, 'Disordered_proteins_Disprot')
print(plotDisprot_combined_disport_control2_5PP_J)
```

```{r}
# Plotting length distribution for globular proteins
plotGlobprot_combined_disport_control2_5PP_J <- plot_length_distribution(globular_combined_disport_control2_5PP_J, 'Globular_protein_Scope')
print(plotGlobprot_combined_disport_control2_5PP_J)
```

```{r}
# Plotting length distribution for membrane proteins
plotMembprot_combined_disport_control2_5PP_J <- plot_length_distribution(membrane_combined_disport_control2_5PP_J, 'Membrane_protein_mpStruc')
print(plotMembprot_combined_disport_control2_5PP_J)
```

```{r}
# Plotting length distribution for peptides
plotPeptide_combined_disport_control2_5PP_J <- plot_length_distribution(peptides_combined_disport_control2_5PP_J, 'Peptides_NCBI')
print(plotPeptide_combined_disport_control2_5PP_J)
```

```{r}

# Filtering data for each protein type to make plot for length distribution
micro_proteins_combined_disport_control2_5PP_J <- combined_disport_control2_5PP_J %>% filter(type == 'Microprotein')
disprot_combined_disport_control2_5PP_J <- combined_disport_control2_5PP_J %>% filter(type == 'Disordered protein')
membrane_combined_disport_control2_5PP_J <- combined_disport_control2_5PP_J %>% filter(type == 'Membrane protein')
globular_combined_disport_control2_5PP_J <- combined_disport_control2_5PP_J %>% filter(type == 'Globular protein')
peptides_combined_disport_control2_5PP_J <- combined_disport_control2_5PP_J %>% filter(type == 'Peptide')

# Function to plot length distribution for a given protein type
plot_length_distribution <- function(protein_data, protein_type) {
  protein_data <- protein_data %>%
    mutate(length = ifelse(length > 1000, 1001, length))
  
  ggplot(protein_data, aes(x=length)) +
    geom_histogram(binwidth=50, fill = 'orange', color = 'black', boundary=0, closed="right") +
    scale_x_continuous(limits = c(0, 1050), breaks = c(seq(0, 1000, by=50), 1050), labels = c(seq(0, 1000, by=50), ">1000")) +
    labs(title = paste('Length Distribution of', protein_type),
         x = 'Length',
         y = 'Frequency') +
    theme_minimal() +
    theme(
      axis.title = element_text(face="bold", size=14),
      axis.text = element_text(face="bold", size=12)
    ) +
    scale_y_continuous(expand = expansion(mult = c(0, 0.1))) # Ensures y-axis starts at 0 and has some space at the top
}

# Plotting length distribution for microproteins
plotMicro_combined_disport_control2_5PP_J <- plot_length_distribution(micro_proteins_combined_disport_control2_5PP_J, 'Microproteins')
print(plotMicro_combined_disport_control2_5PP_J)

# Plotting length distribution for disordered proteins
plotDisprot_combined_disport_control2_5PP_J <- plot_length_distribution(disprot_combined_disport_control2_5PP_J, 'Disordered Proteins')
print(plotDisprot_combined_disport_control2_5PP_J)

# Plotting length distribution for globular proteins
plotGlobprot_combined_disport_control2_5PP_J <- plot_length_distribution(globular_combined_disport_control2_5PP_J, 'Globular Proteins')
print(plotGlobprot_combined_disport_control2_5PP_J)

# Plotting length distribution for membrane proteins
plotMembprot_combined_disport_control2_5PP_J <- plot_length_distribution(membrane_combined_disport_control2_5PP_J, 'Membrane Proteins')
print(plotMembprot_combined_disport_control2_5PP_J)

# Plotting length distribution for peptides
plotPeptide_combined_disport_control2_5PP_J <- plot_length_distribution(peptides_combined_disport_control2_5PP_J, 'Peptides')
print(plotPeptide_combined_disport_control2_5PP_J)

```

# Script for reading and length normalizing data for different human protrein types : microproteins (chen et al. paper),  globular protein (SCOPe), membrane protein (mpstruc database) , human IDPs (DisProt) and human peptides (NCBI) and physiochemcial properties of randomly selected IDs :CIDH920105	CHOP780101 KLEP840101 CHAM830105 ONEK900101) followed by UMAP, t-SNE. All the canonical proteins are above 100 aa and peptide <= 75.
```{r}
# The disordered proteins are taken from DisProt database (Human, non-ambiguous, non-obsolete).
New_disprot_SIDs <- fread('/Users/namrataxxx/Desktop/Master_Thesis_material/Thesis_data_script_result/Weismann_Scope_MObiDB_Mpstruc_DimRed_JoostIDs/human_disprot_DisprotDB_5PP_SIDs.txt', header = TRUE, fill = TRUE, sep = "\t")
head(New_disprot_SIDs)
View(New_disprot_SIDs)

# Removing last column
New_disprot_SIDs$V8 <- NULL

# Extracting the substring between "|" and "pos" for each entry in the 'protein' column
New_disprot_SIDs[, protein_extracted := sub(".*\\|(.*)pos.*", "\\1", protein)]

# Replace the original 'protein' column with the extracted data
New_disprot_SIDs[, protein := protein_extracted]
New_disprot_SIDs[, protein_extracted := NULL]  # Remove the temporary column if it's not needed

# Viewing the first few rows to verify the changes
head(New_disprot_SIDs)

# Selecting only the necessary columns
New_disprot_SIDs <- New_disprot_SIDs[, .(protein, length, CIDH920105,	CHOP780101,	KLEP840101, CHAM830105,ONEK900101)]
View(New_disprot_SIDs)

# Adding a new column named "type" with all values as "Disordered protein"
New_disprot_SIDs$type <- "Disordered protein"

# Placing the new column at the second position
New_disprot_SIDs <- New_disprot_SIDs %>% select(1, type, everything())
head(New_disprot_SIDs)

# Standardizing/normalizing the physico-cehmical property scores by length of the sequence.
# List of physicochemical property columns to length normalize
properties <- c("CIDH920105","CHOP780101","KLEP840101", "CHAM830105","ONEK900101")

# Normalizing each property by the length
for (property in properties) {
  New_disprot_SIDs[[paste0(property, "_norm")]] <- New_disprot_SIDs[[property]] / New_disprot_SIDs$length
}
View(New_disprot_SIDs)
dim(New_disprot_SIDs) # 4587 x 13

# Specifying the columns of interest
selected_columns <- c("protein", "type", "length", "CIDH920105_norm", "CHOP780101_norm", "KLEP840101_norm", "CHAM830105_norm","ONEK900101_norm")

# Selecting the specified columns
selected_data <- New_disprot_SIDs[, ..selected_columns]

# Writing 'selected_data' to a text file as follows:
write.table(selected_data, "normalized_IDPs_Disprot_SIDs.txt", sep = "\t", row.names = FALSE, quote = FALSE)

normalized_human_IDPs_Disprot_SIDs <- fread("/Users/namrataxxx/Desktop/Master_Thesis_material/Thesis_data_script_result/Weismann_Scope_MObiDB_Mpstruc_DimRed_JoostIDs/normalized_human_IDPs_Disprot_SIDs.txt", header = TRUE, fill = TRUE, sep = "\t")
dim(normalized_human_IDPs_Disprot_SIDs) # 4587 x  8

# Filtering for disordered proteins larger than 100 amino acids
normalized_human_IDPs_Disprot_SIDs_longerthan100 <- normalized_human_IDPs_Disprot_SIDs[length > 100]
dim(normalized_human_IDPs_Disprot_SIDs_longerthan100) # 1069 x 8
#View(normalized_human_IDPs_Disprot_SIDs_longerthan100)
```

```{r}
head(control2_8PP_ttt)
control2_5PP_SIDs_tttt <- control2_8PP_ttt[c(1:5,8,9,11)]
head(control2_5PP_SIDs_tttt)

# Adding IDP data from disprot
combined_Disport_control2_5PP_SIDs <- rbind(control2_5PP_SIDs_tttt,normalized_human_IDPs_Disprot_SIDs_longerthan100)
dim(combined_Disport_control2_5PP_SIDs) # 10596 x 8
View(combined_Disport_control2_5PP_SIDs)

# Correcting the script to update 'type' column with new names
combined_Disport_control2_5PP_SIDs <- combined_Disport_control2_5PP_SIDs %>%
  mutate(type = case_when(
    type == "micro" ~ "Microprotein",
    type == "IDP_Disprot" ~ "Disordered protein",
    type == "globular_prot_scope" ~ "Globular protein",
    type == "membrane_prot" ~ "Membrane protein",
    type == "peptide" ~ "Peptide",
    TRUE ~ type  # Preserves original type if none of the conditions above are met
  ))

```

```{r}
# Preparing the data for UMAP, selecting only the columns with the physical property values
umap_data_combined_Disport_control2_5PP_SIDs <- combined_Disport_control2_5PP_SIDs[, c("CIDH920105_norm", "CHOP780101_norm", "KLEP840101_norm", "CHAM830105_norm","ONEK900101_norm")]
head(umap_data_combined_Disport_control2_5PP_SIDs)
# Running UMAP
set.seed(48) # Set a random seed for reproducibility
umap_result_combined_Disport_control2_5PP_SIDs <- umap(umap_data_combined_Disport_control2_5PP_SIDs,n_neighbors=15, min_dist=0.3)

# Creating a data frame for plotting that includes the UMAP dimensions and the protein type
plot_data_combined_Disport_control2_5PP_SIDs <- data.frame(UMAP1 = umap_result_combined_Disport_control2_5PP_SIDs$layout[,1], UMAP2 = umap_result_combined_Disport_control2_5PP_SIDs$layout[,2], Type = combined_Disport_control2_5PP_SIDs$type)
head(plot_data_combined_Disport_control2_5PP_SIDs)

my_colors_Disprot_SIDs <- c("Disordered protein" = "red", "Globular protein" = "green", "Membrane protein" = "blue", "Microprotein" = "yellow", "Peptide" = "pink")

# Plotting using ggplot2
p1_combined_Disport_control2_5PP_SIDs <- ggplot(plot_data_combined_Disport_control2_5PP_SIDs, aes(x = UMAP1, y = UMAP2, color = Type)) +
  geom_point(size=0.3, alpha=1) + # Adjust point transparency with the alpha parameter
    scale_color_manual(values = my_colors_Disprot_SIDs) + # Use the custom colors
  labs(title = "UMAP Visualization of Protein Clusters_Weismann_Disprot_Scope_mpStruc_NCBI_DB(5PP_SIDs)",
       x = "UMAP Dimension 1",
       y = "UMAP Dimension 2",
       color = "Protein Type") +
  theme_minimal()
p1_combined_Disport_control2_5PP_SIDs
```

```{r}
# Performing t-SNE
set.seed(42) # Set a random seed for reproducibility
tsne_result_combined_Disport_control2_5PP_SIDs <- Rtsne(dist(umap_data_combined_Disport_control2_5PP_SIDs), dims = 2, perplexity = 15, theta = 0.0, max_iter= 1000, verbose = FALSE )

# Creating a data frame for plotting that includes the t-SNE dimensions and the protein type
tsne_data_combined_Disport_control2_5PP_SIDs <- data.frame(TSNE1 = tsne_result_combined_Disport_control2_5PP_SIDs$Y[,1], TSNE2 = tsne_result_combined_Disport_control2_5PP_SIDs$Y[,2], Type = combined_Disport_control2_5PP_SIDs$type)

my_colors_Disprot_SIDs <- c("Disordered protein" = "red", "Globular protein" = "green", "Membrane protein" = "blue", "Microprotein" = "yellow", "Peptide" = "pink")

# Plottin using ggplot2
p3_combined_Disport_control2_5PP_SIDs <- ggplot(tsne_data_combined_Disport_control2_5PP_SIDs, aes(x = TSNE1, y = TSNE2, color = Type)) +
  geom_point(size=0.65, alpha=0.75) +
  scale_color_manual(values = my_colors_Disprot_SIDs) + # Use the custom colors
  labs(title = "t-SNE Visualization of Protein Clusters_Weismann_Disprot_Scope_mpStruc_NCBI_DB(5PP_SIDs)",
       x = "t-SNE Dimension 1",
       y = "t-SNE Dimension 2",
       color = "Protein Type") +
  theme_minimal()
p3_combined_Disport_control2_5PP_SIDs
```

```{r}
# t-SNE on scaled physical property scores of IDs: CIDH920105	CHOP780101 KLEP840101 CHAM830105 ONEK900101.
combined_Disport_control2_5PP_SIDs_properties <- combined_Disport_control2_5PP_SIDs[, c(4:8)]
head(combined_Disport_control2_5PP_SIDs_properties)

# Standardize the properties_combined_disport_control2_5PP_J
combined_Disport_control2_5PP_SIDs_scaled <- scale(combined_Disport_control2_5PP_SIDs_properties)
head(combined_Disport_control2_5PP_SIDs_scaled)

umap_data_combined_Disport_control2_5PP_SIDs_scaled <- combined_Disport_control2_5PP_SIDs_scaled[, c("CIDH920105_norm", "CHOP780101_norm", "KLEP840101_norm", "CHAM830105_norm","ONEK900101_norm")]
head(umap_data_combined_Disport_control2_5PP_SIDs_scaled)

set.seed(42) # Set a random seed for reproducibility
tsne_result_combined_Disport_control2_5PP_SIDs_scaled <- Rtsne(dist(umap_data_combined_Disport_control2_5PP_SIDs_scaled), dims = 2, perplexity = 15, theta = 0.0, max_iter= 1000, verbose = FALSE )

# Create a data frame for plotting that includes the t-SNE dimensions and the protein type
tsne_data_combined_Disport_control2_5PP_SIDs_scaled <- data.frame(TSNE1 = tsne_result_combined_Disport_control2_5PP_SIDs_scaled$Y[,1], TSNE2 = tsne_result_combined_Disport_control2_5PP_SIDs_scaled$Y[,2], Type = combined_Disport_control2_5PP_SIDs$type)

my_colors_Disprot_SIDs <- c("Disordered protein" = "red", "Globular protein" = "green", "Membrane protein" = "blue", "Microprotein" = "yellow", "Peptide" = "pink")

# Plot using ggplot2
p3_combined_Disport_control2_5PP_SIDs_scaled <- ggplot(tsne_data_combined_Disport_control2_5PP_SIDs_scaled, aes(x = TSNE1, y = TSNE2, color = Type)) +
  geom_point(size=0.65, alpha=0.75) +
  scale_color_manual(values = my_colors_Disprot_SIDs) + # Use the custom colors
  labs(title = "t-SNE Visualization of Protein Clusters_Weismann_Disprot_Scope_mpStruc_NCBI_DB(5PP_SIDs)_scaled",
       x = "t-SNE Dimension 1",
       y = "t-SNE Dimension 2",
       color = "Protein Type") +
  theme_minimal()
p3_combined_Disport_control2_5PP_SIDs_scaled
```
# Script for reading length normalized data for different human protrein types : microproteins (chen et al. paper), human Globular (SCOPe) and membrane protein (mpstruc), human IDPs (DisProt) and human peptides (NCBI) and physiochemcial properties of IDs (CIDH920105	CHOP780101	CHOP780201	CHOP780202	KLEP840101) followed by UMAP, t-SNE, Violin plots. All the canonical proteins are above 100 aa and peptide <= 75.

```{r}
# Reading normalized data and prepapring for UMAP analysis
normalized_human_uprot_weismann_8physpropsids <- read.table("/Users/namrataxxx/Desktop/Master_Thesis_material/Thesis_data_script_result/Weismann_Scope_MObiDB_Mpstruc_DimRed_JoostIDs/8physpropIDs_dataset/normalized_human_uprot_weismann_8physpropsids.txt", header=TRUE, sep="\t")
dim(normalized_human_uprot_weismann_8physpropsids) # 10694  x  11
#View(normalized_human_uprot_weismann_8physpropsids)

normalized_human_membprot_mpstruc_8physpropsids <- read.table("/Users/namrataxxx/Desktop/Master_Thesis_material/Thesis_data_script_result/Weismann_Scope_MObiDB_Mpstruc_DimRed_JoostIDs/8physpropIDs_dataset/normalized_human_membprot_mpstruc_8physpropsids.txt", header=TRUE, sep="\t")
dim(normalized_human_membprot_mpstruc_8physpropsids) # 1705 x 11
#View(normalized_human_membprot_mpstruc_8physpropsids)

# Filter for membrane proteins larger than 100 amino acids
normalized_human_membprot_mpstruc_8physpropsids_longerthan100 <- normalized_human_membprot_mpstruc_8physpropsids %>% filter(length > 100)
dim(normalized_human_membprot_mpstruc_8physpropsids_longerthan100) # 1428 x 11
#View(normalized_human_membprot_mpstruc_8physpropsids_longerthan100)

normalized_human_globprot_scopeastral40_8physpropids <- read.table("/Users/namrataxxx/Desktop/Master_Thesis_material/Thesis_data_script_result/Weismann_Scope_MObiDB_Mpstruc_DimRed_JoostIDs/8physpropIDs_dataset/normalized_human_globprot_scopeastral40_8physpropids.txt", header=TRUE, sep="\t")
dim(normalized_human_globprot_scopeastral40_8physpropids) # 2741 x  11

# Filter for globular proteins larger than 100 amino acids
normalized_human_globprot_scopeastral40_8physpropsids_longerthan100 <- normalized_human_globprot_scopeastral40_8physpropids %>% filter(length > 100)
dim(normalized_human_globprot_scopeastral40_8physpropsids_longerthan100) # 1718 x 11
#View(normalized_human_globprot_scopeastral40_8physpropsids_longerthan100)

normalized_human_peptideSeq_NCBI_new_8physphrosids <- read.table("/Users/namrataxxx/Desktop/Master_Thesis_material/Thesis_data_script_result/Weismann_Scope_MObiDB_Mpstruc_DimRed_JoostIDs/8physpropIDs_dataset/normalized_human_peptideSeq_NCBI_new_8physphrosids.txt", header=TRUE, sep="\t")
dim(normalized_human_peptideSeq_NCBI_new_8physphrosids) # 2212 x  11

# Filtering peptides pnly below 80 aa
normalized_human_peptideSeq_NCBI_new_8physphrosids_smallerORequal75 <- normalized_human_peptideSeq_NCBI_new_8physphrosids %>% filter(length <= 75)
dim(normalized_human_peptideSeq_NCBI_new_8physphrosids_smallerORequal75) # 1381 x 11
#View(normalized_human_peptideSeq_NCBI_new_8physphrosids_smallerORequal75)

normalized_human_uprot_weismann_8physpropsids_5000 <- normalized_human_uprot_weismann_8physpropsids[sample(nrow(normalized_human_uprot_weismann_8physpropsids), 5000),]  #subsampling to reduce microprot set size 
dim(normalized_human_uprot_weismann_8physpropsids_5000) # 5000 x  11
#head(normalized_human_uprot_weismann_8physpropsids_5000)

# normalized IDP from Disport
New_Disprot_dim_j <- fread("/Users/namrataxxx/Desktop/Master_Thesis_material/Thesis_data_script_result/Joost_new_data/normalized_newData_disprot_joost.txt", header = TRUE, fill = TRUE, sep = "\t")
dim(New_Disprot_dim_j) # 4587 x  8

# Filter for disordered proteins larger than 100 amino acids
normalized_human_disprot_Disprot_dim_j_longerthan100 <-  New_Disprot_dim_j %>% filter(length > 100)
dim(normalized_human_disprot_Disprot_dim_j_longerthan100) # 1069 x 8
#View(normalized_human_disprot_Disprot_dim_j_longerthan100) 

control6_8PP_t <- rbind(normalized_human_uprot_weismann_8physpropsids_5000,normalized_human_membprot_mpstruc_8physpropsids_longerthan100)
control6_8PP_tt <- rbind(control6_8PP_t,normalized_human_globprot_scopeastral40_8physpropsids_longerthan100)
control6_8PP_ttt <- rbind(control6_8PP_tt,normalized_human_peptideSeq_NCBI_new_8physphrosids_smallerORequal75)
head(control6_8PP_ttt)
control6_5PP_J_tttt <- control6_8PP_ttt[c(1:8)]
head(control6_5PP_J_tttt)

# Adding IDP data from disprot
combined_disport_control6_5PP_J <- rbind(control6_5PP_J_tttt,normalized_human_disprot_Disprot_dim_j_longerthan100)
dim(combined_disport_control6_5PP_J) # 10596 x 8
head(combined_disport_control6_5PP_J)
View(combined_disport_control6_5PP_J)
sum(is.na(combined_disport_control6_5PP_J))
combined_disport_control6_5PP_J <- na.omit(combined_disport_control6_5PP_J)

# Correcting the script to update 'type' column with new names
combined_disport_control6_5PP_J <- combined_disport_control6_5PP_J %>%
  mutate(type = case_when(
    type == "micro" ~ "Microprotein",
    type == "disprot" ~ "Disordered protein",
    type == "globular_prot_scope" ~ "Globular protein",
    type == "membrane_prot" ~ "Membrane protein",
    type == "peptide" ~ "Peptide",
    TRUE ~ type  # Preserves original type if none of the conditions above are met
  ))

```

```{r}
# Preparing the data for UMAP, selecting only the columns with the physical property values
umap_data_combined_disport_control6_5PP_J <- combined_disport_control6_5PP_J[, c("CIDH920105_norm", "CHOP780101_norm", "CHOP780201_norm", "CHOP780202_norm", "KLEP840101_norm")]
head(umap_data_combined_disport_control6_5PP_J)
# Running UMAP
set.seed(48) # Set a random seed for reproducibility
umap_result_combined_disport_control6_5PP_J <- umap(umap_data_combined_disport_control6_5PP_J,n_neighbors=15, min_dist=0.3)

# Creating a data frame for plotting that includes the UMAP dimensions and the protein type
plot_data_j_combined_disport_control6_5PP_J <- data.frame(UMAP1 = umap_result_combined_disport_control6_5PP_J$layout[,1], UMAP2 = umap_result_combined_disport_control6_5PP_J$layout[,2], Type = combined_disport_control6_5PP_J$type)
head(plot_data_j_combined_disport_control6_5PP_J)

my_colors_combined_disport_control6_5PP_J <- c("Disordered protein" = "red", "Globular protein" = "green", "Membrane protein" = "blue", "Microprotein" = "yellow", "Peptide" = "pink")

# Plotting using ggplot2
p1_combined_disport_control6_5PP_J <- ggplot(plot_data_j_combined_disport_control6_5PP_J, aes(x = UMAP1, y = UMAP2, color = Type)) +
  geom_point(size=0.3, alpha=1) + # Adjust point transparency with the alpha parameter
    scale_color_manual(values = my_colors_combined_disport_control6_5PP_J) + # Use the custom colors
  labs(title = "UMAP Visualization of Protein Clusters_Weismann_Disprot_Scope_mpStruc_NCBI(< 80aa)_DB(5PP_JIDs)",
       x = "UMAP Dimension 1",
       y = "UMAP Dimension 2",
       color = "Protein Type") +
  theme_minimal()
p1_combined_disport_control6_5PP_J
```

```{r}
# Performing t-SNE
set.seed(42) # Set a random seed for reproducibility
tsne_result_combined_disport_control6_5PP_J <- Rtsne(dist(umap_data_combined_disport_control6_5PP_J), dims = 2, perplexity = 15, theta = 0.0, max_iter= 1000, verbose = FALSE )

# Creating a data frame for plotting that includes the t-SNE dimensions and the protein type
tsne_data_combined_disport_control6_5PP_J <- data.frame(TSNE1 = tsne_result_combined_disport_control6_5PP_J$Y[,1], TSNE2 = tsne_result_combined_disport_control6_5PP_J$Y[,2], Type = combined_disport_control6_5PP_J$type)

my_colors_combined_disport_control6_5PP_J <- c("Disordered protein" = "red", "Globular protein" = "green", "Membrane protein" = "blue", "Microprotein" = "yellow", "Peptide" = "pink")

# Plotting using ggplot2
p3_combined_disport_control6_5PP_J <- ggplot(tsne_data_combined_disport_control6_5PP_J, aes(x = TSNE1, y = TSNE2, color = Type)) +
  geom_point(size=0.65, alpha=0.75) +
  scale_color_manual(values = my_colors_combined_disport_control6_5PP_J) + # Use the custom colors
  labs(title = "t-SNE Visualization of Protein Clusters_Weismann_Disprot_Scope_mpStruc_NCBI(< 75aa)_DB(5PP_JIDs)",
       x = "t-SNE Dimension 1",
       y = "t-SNE Dimension 2",
       color = "Protein Type") +
  theme_minimal()

p3_combined_disport_control6_5PP_J
```

```{r}
# t-SNE on scaled physical property scores
combined_disport_control6_5PP_J_properties <- combined_disport_control6_5PP_J[, c(4:8)]
head(combined_disport_control6_5PP_J_properties)

# Standardize the properties_combined_disport_control2_5PP_J
combined_disport_control6_5PP_J_scaled <- scale(combined_disport_control6_5PP_J_properties)
head(combined_disport_control6_5PP_J_scaled)


umap_data_combined_disport_control6_5PP_J_scaled <- combined_disport_control6_5PP_J_scaled[, c("CIDH920105_norm", "CHOP780101_norm", "CHOP780201_norm", "CHOP780202_norm", "KLEP840101_norm")]

# Perform t-SNE
set.seed(42) # Set a random seed for reproducibility
tsne_result_combined_disport_control6_5PP_J_scaled <- Rtsne(dist(umap_data_combined_disport_control6_5PP_J_scaled), dims = 2, perplexity = 15, theta = 0.0, max_iter= 1000, verbose = FALSE )

# Create a data frame for plotting that includes the t-SNE dimensions and the protein type
tsne_data_combined_disport_control6_5PP_J_scaled <- data.frame(TSNE1 = tsne_result_combined_disport_control6_5PP_J_scaled$Y[,1], TSNE2 = tsne_result_combined_disport_control6_5PP_J_scaled$Y[,2], Type = combined_disport_control6_5PP_J$type)

my_colors_combined_disport_control6_5PP_J <- c("Disordered protein" = "red", "Globular protein" = "green", "Membrane protein" = "blue", "Microprotein" = "yellow", "Peptide" = "pink")

# Plot using ggplot2
p3_combined_disport_control6_5PP_J_scaled <- ggplot(tsne_data_combined_disport_control6_5PP_J_scaled, aes(x = TSNE1, y = TSNE2, color = Type)) +
  geom_point(size=0.65, alpha=0.75) +
  scale_color_manual(values = my_colors_combined_disport_control6_5PP_J) + # Use the custom colors
  labs(title = "t-SNE Visualization of Protein Clusters_Weismann_Disprot_Scope_mpStruc_NCBI(< 75aa)_DB(5PP_JIDs)_scaled",
       x = "t-SNE Dimension 1",
       y = "t-SNE Dimension 2",
       color = "Protein Type") +
  theme_minimal()

p3_combined_disport_control6_5PP_J_scaled

```

```{r}
# Making violin plots to check the distribution of the physico-chemical property scores on the above dataset (microproteins (chen et al. paper), human Globular (SCOPe) and membrane protein (mpstruc), human IDPs (DisProt) and human peptides (NCBI)) 

# Custom colors as you've defined
my_colors_new_micros_dim_j <- c("Disordered protein" = "red", "Globular protein" = "green", "Membrane protein" = "blue", "Microprotein" = "yellow", "Peptide" = "pink")

# Selecting the first 3 columns of combined_disport_control6_5PP_J
columns_to_add <- combined_disport_control6_5PP_J[, 1:3]

# Adding selected columns to combined_disport_control6_5PP_J_scaled
combined_disport_control6_5PP_J_scaled <- cbind(columns_to_add,combined_disport_control6_5PP_J_scaled)
head(combined_disport_control6_5PP_J_scaled)

# Reshaping the dataframe to long format
df_long_combined_disport_control6_5PP_J_scaled <- combined_disport_control6_5PP_J_scaled %>%
  pivot_longer(cols = c("CIDH920105_norm", "CHOP780101_norm", "CHOP780201_norm", "CHOP780202_norm","KLEP840101_norm"),names_to = "property",
               values_to = "score")

# Function to create and adjust violin plot for a given property
create_violin_plot_combined_disport_control6_5PP_J_scaled <- function(property_name, y_limits = NULL) {
  p <- ggplot(subset(df_long_combined_disport_control6_5PP_J_scaled, property == property_name), aes(x = type, y = score, fill = type)) +
    geom_violin(trim = FALSE, adjust = 1.5) +  # adjust parameter smooths the violin plot
    geom_boxplot(width=0.05, fill="white", outlier.shape = NA, position=position_dodge(width=0.25)) + # Adjust width and position
    scale_fill_manual(values = my_colors_new_micros_dim_j) +
    theme_minimal() +
    theme(axis.text.x = element_text(angle = 45, hjust = 1),
          legend.position = "none") +
    labs(x = "Protein_Type", y = "Normalized_Physicochemical_property_Score", title = property_name)

  # Adjusting y-axis limits 
  if (!is.null(y_limits)) {
    p <- p + ylim(y_limits)
  }

  return(p)
}

# Generating plot for the CIDH920105_norm property with adjusted limits
p_CIDH920105_norm_combined_disport_control6_5PP_J_scaled <- create_violin_plot_combined_disport_control6_5PP_J_scaled("CIDH920105_norm", c(-0.8, 0.5))
print(p_CIDH920105_norm_combined_disport_control6_5PP_J_scaled)
```
```{r}
p_CHOP780101_norm_combined_disport_control6_5PP_J_scaled <- create_violin_plot_combined_disport_control6_5PP_J_scaled("CHOP780101_norm",c(-1, 1.2))
print(p_CHOP780101_norm_combined_disport_control6_5PP_J_scaled)
```
```{r}
p_CHOP780201_norm_combined_disport_control6_5PP_J_scaled <- create_violin_plot_combined_disport_control6_5PP_J_scaled("CHOP780201_norm",c(-1, 1.2))
print(p_CHOP780201_norm_combined_disport_control6_5PP_J_scaled)
```

```{r}
p_CHOP780202_combined_disport_control6_5PP_J_scaled <- create_violin_plot_combined_disport_control6_5PP_J_scaled("CHOP780202_norm",c(-1, 1.2))
print(p_CHOP780202_combined_disport_control6_5PP_J_scaled)
```

```{r}
p_KLEP840101_norm_combined_disport_control6_5PP_J_scaled <- create_violin_plot_combined_disport_control6_5PP_J_scaled("KLEP840101_norm",c(-0.7, 0.8))
print(p_KLEP840101_norm_combined_disport_control6_5PP_J_scaled)
```

# Script for reading length normalized data for different human protrein types : microproteins (Mudge et al. paper), human Globular (SCOPe) and membrane protein (mpstruc), human IDPs (DisProt) and human peptides (NCBI) and physiochemcial properties of IDs (CIDH920105	CHOP780101	CHOP780201	CHOP780202	KLEP840101) followed by UMAP, t-SNE, Violin plots. All the canonical proteins are above 100 aa and peptide <= 75.

```{r}
# These datasets for microprotein (3085 seq from J.Mudge paper) contains physico-chemical properties specific to IDs  ("CIDH920105","CHOP780101","CHOP780201",	"CHOP780202", "KLEP840101","CHAM830105","KARP850103","ONEK900101")

Human_uprot_JMudge_8pp<- read.table("/Users/namrataxxx/Desktop/Master_Thesis_material/Thesis_data_script_result/Weismann_Scope_MObiDB_Mpstruc_DimRed_JoostIDs/8physpropIDs_dataset/human_uprot_JMudge_8physproIDs.txt", header=TRUE, sep="\t")
head(Human_uprot_JMudge_8pp)
# Removing last column
Human_uprot_JMudge_8pp$X <- NULL
# Add a new column named "type" with all values as "micro"
Human_uprot_JMudge_8pp$type <- "microprotein"
# To place the new column at the second position
Human_uprot_JMudge_8pp <- Human_uprot_JMudge_8pp[c(1, ncol(Human_uprot_JMudge_8pp), 2:(ncol(Human_uprot_JMudge_8pp)-1))]
#View(Human_uprot_JMudge_8pp)
dim(Human_uprot_JMudge_8pp) # 3085 x  11

# Standardizing/normalizing the physico-cehmical property scores by length of the sequence.
# List of physicochemical property columns to length normalize
properties <- c("CIDH920105","CHOP780101","CHOP780201",	"CHOP780202", "KLEP840101","CHAM830105","KARP850103","ONEK900101")

# Normalizing each property by the length
for (property in properties) {
  Human_uprot_JMudge_8pp[[paste0(property, "_norm")]] <- Human_uprot_JMudge_8pp[[property]] / Human_uprot_JMudge_8pp$length
}
#head(Human_uprot_JMudge_8pp)

# Selecting only the columnsof interest
selected_data <- Human_uprot_JMudge_8pp[c(1,2,3,12:19)]

# Writing the selected columns to a new TXT file named 'normalized_human_uprot_JMudge_8physpropsids.txt'
write.table(selected_data, 'normalized_human_uprot_JMudge_8physpropsids.txt', row.names = FALSE, quote = FALSE, sep = "\t")
```

```{r}
# Reading normalized data and prepapring for UMAP analysis
normalized_human_uprot_Jmudge_8physpropsids <- read.table("/Users/namrataxxx/Desktop/Master_Thesis_material/Thesis_data_script_result/Weismann_Scope_MObiDB_Mpstruc_DimRed_JoostIDs/8physpropIDs_dataset/normalized_human_uprot_JMudge_8physpropsids.txt", header=TRUE, sep="\t")
dim(normalized_human_uprot_Jmudge_8physpropsids) # 3085  x  11
View(normalized_human_uprot_Jmudge_8physpropsids)

control_JM_8PP_t <- rbind(normalized_human_uprot_Jmudge_8physpropsids,normalized_human_membprot_mpstruc_8physpropsids_longerthan100)
control_JM_8PP_tt <- rbind(control_JM_8PP_t,normalized_human_globprot_scopeastral40_8physpropsids_longerthan100)
control_JM_8PP_ttt <- rbind(control_JM_8PP_tt,normalized_human_peptideSeq_NCBI_new_8physphrosids_smallerORequal75)
head(control_JM_8PP_ttt)
control_JM_5PP_J_tttt <- control_JM_8PP_ttt[c(1:8)]
head(control_JM_5PP_J_tttt)

# Adding IDP data from Disprot
combined_control_JM_5PP_J_tttt <- rbind(control_JM_5PP_J_tttt,normalized_human_disprot_Disprot_dim_j_longerthan100)
dim(combined_control_JM_5PP_J_tttt) # 8681 x 8
head(combined_control_JM_5PP_J_tttt)
View(combined_control_JM_5PP_J_tttt)
sum(is.na(combined_control_JM_5PP_J_tttt))
combined_control_JM_5PP_J_tttt <- na.omit(combined_control_JM_5PP_J_tttt)

# Correcting the script to update 'type' column with new names
combined_control_JM_5PP_J_tttt <- combined_control_JM_5PP_J_tttt %>%
  mutate(type = case_when(
    type == "microprotein" ~ "Microprotein",
    type == "globular_prot_scope" ~ "Globular protein",
    type == "membrane_prot" ~ "Membrane protein",
    type == "peptide" ~ "Peptide",
    TRUE ~ type  # Preserves original type if none of the conditions above are met
  ))

```

```{r}
# Performing t-SNE on scaled physical property scores from J.Mudge paper
combined_control_JM_5PP_J_tttt_properties <- combined_control_JM_5PP_J_tttt[, c(4:8)]
head(combined_control_JM_5PP_J_tttt_properties)

# Standardizing the properties in combined_disport_control2_5PP_J dataframe
combined_control_JM_5PP_J_tttt_scaled <- scale(combined_control_JM_5PP_J_tttt_properties)
head(combined_control_JM_5PP_J_tttt_scaled)

umap_data_combined_control_JM_5PP_J_tttt_scaled <- combined_control_JM_5PP_J_tttt_scaled[, c("CIDH920105_norm", "CHOP780101_norm", "CHOP780201_norm", "CHOP780202_norm", "KLEP840101_norm")]

# Performing t-SNE
set.seed(42) # Set a random seed for reproducibility
tsne_result_combined_control_JM_5PP_J_tttt_scaled <- Rtsne(dist(umap_data_combined_control_JM_5PP_J_tttt_scaled), dims = 2, perplexity = 15, theta = 0.0, max_iter= 1000, verbose = FALSE )

# Creating a data frame for plotting that includes the t-SNE dimensions and the protein type
tsne_data_combined_control_JM_5PP_J_tttt_scaled <- data.frame(TSNE1 = tsne_result_combined_control_JM_5PP_J_tttt_scaled$Y[,1], TSNE2 = tsne_result_combined_control_JM_5PP_J_tttt_scaled$Y[,2], Type = combined_control_JM_5PP_J_tttt$type)

my_colors_combined_disport_control6_5PP_J <- c("Disordered protein" = "red", "Globular protein" = "green", "Membrane protein" = "blue", "Microprotein" = "yellow", "Peptide" = "pink")

# Plotting using ggplot2
p3_combined_control_JM_5PP_J_tttt_scaled <- ggplot(tsne_data_combined_control_JM_5PP_J_tttt_scaled, aes(x = TSNE1, y = TSNE2, color = Type)) +
  geom_point(size=0.65, alpha=0.75) +
  scale_color_manual(values = my_colors_combined_disport_control6_5PP_J) + # Use the custom colors
  labs(title = "t-SNE Visualization of Protein Clusters_JMudge_Disprot_Scope_mpStruc_NCBI(< 75aa)_DB(5PP_JIDs)_scaled",
       x = "t-SNE Dimension 1",
       y = "t-SNE Dimension 2",
       color = "Protein Type") +
  theme_minimal()

p3_combined_control_JM_5PP_J_tttt_scaled
```
# Script for reading length normalized data for different human protrein types : microproteins (chen et al. paper), human Globular (SCOPe) and membrane protein (mpstruc), human IDPs (DisProt) and human peptides (NCBI) and physiochemcial properties of 8 IDs (CIDH920105	CHOP780101	CHOP780201	CHOP780202	KLEP840101 CHAM830105 KARP850103 ONEK900101) followed by UMAP, t-SNE plots. All the canonical proteins are above 100 aa and peptide <= 75.

```{r}
# Disordered protein dataset (DisProt database; filter options: non-ambiguous, non-obsolete ) with sequence IDs in rows and physico-cehmical property IDs (CIDH920105	CHOP780101	CHOP780201	CHOP780202	KLEP840101 CHAM830105 KARP850103 ONEK900101)  in columns. 

New_disprot_8pp <- fread('/Users/namrataxxx/Desktop/Master_Thesis_material/Thesis_data_script_result/Weismann_Scope_MObiDB_Mpstruc_DimRed_JoostIDs/8physpropIDs_dataset/human_IDP_DisProt_8physpropsIDs.txt', header = TRUE, fill = TRUE, sep = "\t")
head(New_disprot_8pp)
View(New_disprot_8pp)

# Removing last column
New_disprot_8pp$V11 <- NULL

# Extracting the substring between "|" and "pos" for each entry in the 'protein' column
New_disprot_8pp[, protein_extracted := sub(".*\\|(.*)pos.*", "\\1", protein)]

# Replacing the original 'protein' column with the extracted data
New_disprot_8pp[, protein := protein_extracted]
New_disprot_8pp[, protein_extracted := NULL]  

# Viewing the first few rows to verify the changes
head(New_disprot_8pp)

# Selecting only the necessary columns
New_disprot_8pp <- New_disprot_8pp[, .(protein, length, CIDH920105,CHOP780101,CHOP780201,	CHOP780202, KLEP840101,CHAM830105,KARP850103,ONEK900101)]
View(New_disprot_8pp)

# Adding a new column named "type" with all values as "Disordered protein"
New_disprot_8pp$type <- "Disordered protein"

# Placing the new column at the second position
New_disprot_8pp <- New_disprot_8pp %>%
  select(1, type, everything())
head(New_disprot_8pp)

# Standardizing/normalizing the physico-cehmical property scores by length of the sequence.
# List of physicochemical property columns to length normalize
properties <- c("CIDH920105","CHOP780101","CHOP780201",	"CHOP780202", "KLEP840101","CHAM830105","KARP850103","ONEK900101")

# Normalizing each property by the length
for (property in properties) {
  New_disprot_8pp[[paste0(property, "_norm")]] <- New_disprot_8pp[[property]] / New_disprot_8pp$length
}
#View(New_disprot)
dim(New_disprot_8pp) # 4587 x 19

# Specifying the columns of interest
selected_columns_New_disprot_8pp <- c("protein", "type", "length", "CIDH920105_norm", 
                     "CHOP780101_norm", "CHOP780201_norm", "CHOP780202_norm", "KLEP840101_norm","CHAM830105_norm","KARP850103_norm","ONEK900101_norm" )
head(selected_columns_New_disprot_8pp)

# Selecting the specified columns
selected_data_New_disprot_8pp <- New_disprot_8pp[, ..selected_columns_New_disprot_8pp]
head(selected_data_New_disprot_8pp)
dim(selected_data_New_disprot_8pp) # 4587 x 11

# Writing 'selected_data' to a text file as follows:
write.table(selected_data_New_disprot_8pp, "normalized_disordered_Disprot_8pp.txt", sep = "\t", row.names = FALSE, quote = FALSE)

```

```{r}
# Combinig the datasets for other protein types
control8_8PP_t <- rbind(normalized_human_uprot_weismann_8physpropsids_5000,normalized_human_membprot_mpstruc_8physpropsids_longerthan100)
control8_8PP_tt <- rbind(control6_8PP_t,normalized_human_globprot_scopeastral40_8physpropsids_longerthan100)
control8_8PP_ttt <- rbind(control6_8PP_tt,normalized_human_peptideSeq_NCBI_new_8physphrosids_smallerORequal75)
head(control8_8PP_ttt)

# normalized IDP from Disport
New_Disprot_control8 <- fread("/Users/namrataxxx/Desktop/Master_Thesis_material/Thesis_data_script_result/Weismann_Scope_MObiDB_Mpstruc_DimRed_JoostIDs/8physpropIDs_dataset/normalized_disordered_Disprot_8pp.txt", header = TRUE, fill = TRUE, sep = "\t")
dim(New_Disprot_control8) # 4587 x  11

# Filtering for disordered proteins larger than 100 amino acids
normalized_human_disprot_Disprot_control8_longerthan100 <-  New_Disprot_control8 %>% filter(length > 100)
dim(normalized_human_disprot_Disprot_control8_longerthan100) # 1069 x 11
View(normalized_human_disprot_Disprot_control8_longerthan100) 

# Adding IDP data from disprot
combined_disport_control8_8PP_J <- rbind(control8_8PP_ttt,normalized_human_disprot_Disprot_control8_longerthan100)
dim(combined_disport_control8_8PP_J) # 10596 x 11
head(combined_disport_control8_8PP_J)
View(combined_disport_control8_8PP_J)
sum(is.na(combined_disport_control8_8PP_J))
combined_disport_control8_8PP_J <- na.omit(combined_disport_control8_8PP_J)

# Correcting the script to update 'type' column with new names
combined_disport_control8_8PP_J <- combined_disport_control8_8PP_J %>%
  mutate(type = case_when(
    type == "micro" ~ "Microprotein",
    type == "globular_prot_scope" ~ "Globular protein",
    type == "membrane_prot" ~ "Membrane protein",
    type == "peptide" ~ "Peptide",
    TRUE ~ type  # Preserves original type if none of the conditions above are met
  ))

```

```{r}
# Running t-SNE on combined data (microprotein:weismann, globular protein:SCOPe, membrane protein:mpstruc, disordered protein:DisProt, peptides:NCBI) with 8 physico-chemical properties.

umap_data_combined_disport_control8_8PP_J <- combined_disport_control8_8PP_J[, c("CIDH920105_norm", "CHOP780101_norm", "CHOP780201_norm", "CHOP780202_norm", "KLEP840101_norm","CHAM830105_norm","KARP850103_norm","ONEK900101_norm")]

# Performing t-SNE
set.seed(42) # Set a random seed for reproducibility
tsne_result_combined_disport_control8_8PP_J <- Rtsne(dist(umap_data_combined_disport_control8_8PP_J), dims = 2, perplexity = 15, theta = 0.0, max_iter= 1000, verbose = FALSE )

# Creating a data frame for plotting that includes the t-SNE dimensions and the protein type
tsne_data_combined_disport_control8_8PP_J <- data.frame(TSNE1 = tsne_result_combined_disport_control8_8PP_J$Y[,1], TSNE2 = tsne_result_combined_disport_control8_8PP_J$Y[,2], Type = combined_disport_control8_8PP_J$type)

my_colors_combined_disport_control6_5PP_J <- c("Disordered protein" = "red", "Globular protein" = "green", "Membrane protein" = "blue", "Microprotein" = "yellow", "Peptide" = "pink")

# Plotting using ggplot2
p3_combined_disport_control8_8PP_J<- ggplot(tsne_data_combined_disport_control8_8PP_J, aes(x = TSNE1, y = TSNE2, color = Type)) +
  geom_point(size=0.65, alpha=0.75) +
  scale_color_manual(values = my_colors_combined_disport_control6_5PP_J) + # Use the custom colors
  labs(title = "t-SNE Visualization of Protein Clusters_Weismann_Disprot_Scope_mpStruc_NCBI(< 75aa)_DB(8PP_JIDs)",
       x = "t-SNE Dimension 1",
       y = "t-SNE Dimension 2",
       color = "Protein Type") +
  theme_minimal()

p3_combined_disport_control8_8PP_J
```


```{r}
# t-SNE on scaled physical property scores on combined data (microprotein:weismann, globular protein:SCOPe, membrane protein:mpstruc, disordered protein:DisProt, peptides:NCBI) with 8 physico-chemical properties.

combined_disport_control8_8PP_J_properties <- combined_disport_control8_8PP_J[, c(4:11)]
head(combined_disport_control8_8PP_J_properties)

# Standardize the properties_combined_disport_control2_5PP_J
combined_disport_control8_8PP_J_scaled <- scale(combined_disport_control8_8PP_J_properties)
head(combined_disport_control8_8PP_J_scaled)

umap_data_combined_disport_control8_8PP_J_scaled <- combined_disport_control8_8PP_J_scaled[, c("CIDH920105_norm", "CHOP780101_norm", "CHOP780201_norm", "CHOP780202_norm", "KLEP840101_norm","CHAM830105_norm","KARP850103_norm","ONEK900101_norm")]

# Performing t-SNE
set.seed(42) # Set a random seed for reproducibility
tsne_result_combined_disport_control8_8PP_J_scaled <- Rtsne(dist(umap_data_combined_disport_control8_8PP_J_scaled), dims = 2, perplexity = 15, theta = 0.0, max_iter= 1000, verbose = FALSE )

# Creating a data frame for plotting that includes the t-SNE dimensions and the protein type
tsne_data_combined_disport_control8_8PP_J_scaled <- data.frame(TSNE1 = tsne_result_combined_disport_control8_8PP_J_scaled$Y[,1], TSNE2 = tsne_result_combined_disport_control8_8PP_J_scaled$Y[,2], Type = combined_disport_control8_8PP_J$type)

my_colors_combined_disport_control6_5PP_J <- c("Disordered protein" = "red", "Globular protein" = "green", "Membrane protein" = "blue", "Microprotein" = "yellow", "Peptide" = "pink")

# Plottin using ggplot2
p3_combined_disport_control8_8PP_J_scaled <- ggplot(tsne_data_combined_disport_control8_8PP_J_scaled, aes(x = TSNE1, y = TSNE2, color = Type)) +
  geom_point(size=0.65, alpha=0.75) +
  scale_color_manual(values = my_colors_combined_disport_control6_5PP_J) + # Use the custom colors
  labs(title = "t-SNE Visualization of Protein Clusters_Weismann_Disprot_Scope_mpStruc_NCBI(< 75aa)_DB(8PP_JIDs)_scaled",
       x = "t-SNE Dimension 1",
       y = "t-SNE Dimension 2",
       color = "Protein Type") +
  theme_minimal()

p3_combined_disport_control8_8PP_J_scaled
```
# Statistical tests.
# Performing subsampling (100 sequences for each protein type) for statistical significance testing. Another apporach to address the issue of overpowered dataset.
# First testing for normality with Shapiro-Wilk test and length distribution.
```{r}
# Loading the dataset
df_combined_disport_control6_5PP_J_scaled <- combined_disport_control6_5PP_J_scaled

# Inspecting the dataset
head(df_combined_disport_control6_5PP_J_scaled)

# Defining the properties to test
properties <- c("CIDH920105_norm", "CHOP780101_norm", "CHOP780201_norm", "CHOP780202_norm", "KLEP840101_norm")

# Function to perform subsampling
subsample_proteins <- function(data, sample_size = 100) {
  data %>%
    group_by(type) %>%
    sample_n(sample_size, replace = FALSE)
}

# Performing subsampling
subsampled_df <- subsample_proteins(df_combined_disport_control6_5PP_J_scaled)

# Checking the length distribution of the subsampled dataset
length_distribution <- subsampled_df %>%
  group_by(type) %>%
  summarise(mean_length = mean(length), sd_length = sd(length), count = n())

# Printing length distribution
cat("\nLength distribution of subsampled dataset:\n")
print(length_distribution)

# Plotting length distribution
ggplot(subsampled_df, aes(x = type, y = length, fill = type)) +
  geom_boxplot() +
  labs(title = "Length Distribution of Subsampled Dataset", x = "Protein Type", y = "Length") +
  theme_minimal()

```

```{r}
# Checking normality for each property
normality_results <- list()
for (property in properties) {
  normality_test <- shapiro.test(subsampled_df[[property]])
  normality_results[[property]] <- normality_test
}

# Printing normality test results
for (property in properties) {
  cat("\nNormality test results for", property, ":\n")
  print(normality_results[[property]])
}
```

# Visualizations using histograms,box,QQ,density plots on sub-sampled dataset.
```{r}
# Create a combined histogram plot for each property
for (property in properties) {
  ggplot(subsampled_df, aes_string(x = property, fill = 'type')) + 
    geom_histogram(binwidth = 0.1, alpha = 0.6, position = 'identity') + # adjust binwidth as needed
    facet_wrap(~type, scales = "free") + 
    theme_bw() +
    labs(title = paste("Histogram for", property), x = property, y = "Count") +
    theme(legend.position = "bottom") -> p
  
  print(p)
}

```

```{r}
# Create Q-Q plots for each property
for (property in properties) {
  ggplot(subsampled_df, aes_string(sample = property)) + 
    stat_qq() +
    stat_qq_line() +
    facet_wrap(~type, scales = "free") +
    theme_bw() +
    labs(title = paste("Q-Q Plot for", property)) -> p
  
  print(p)
}

# In the case of KLEP840101, the deviations from the line in the Q-Q plots suggest that the physicochemical properties for these protein types do not follow a normal distribution. This is particularly true for the tails of the distributions (both light and heavy tails) and is most pronounced in the "micro" and "peptide" protein types. If the points in the QQ plot fall approximately along a straight line, it suggests that the two distributions being compared are similar.
#If the points deviate systematically from a straight line, it indicates that the distributions differ. Deviations towards the ends of the line indicate that one distribution is more spread out than the other.
```

```{r}
# Create a density plot for each property
for (property in properties) {
  ggplot(subsampled_df, aes_string(x = property, fill = 'type')) + 
    geom_density(alpha = 0.6) +
    facet_wrap(~type, scales = "free") +
    theme_bw() +
    labs(title = paste("Density Plot for", property), x = property, y = "Density") +
    theme(legend.position = "bottom") -> p
  
  print(p)
}

# Conclusion: Overall, the plots suggest that the physicochemical property scores are not normally distributed. There are significant variations among the protein types, with some showing a sharp peak indicating that most proteins have similar physicochemical property scores, while others have a broader distribution.

#The skewness and multiple peaks in some protein types suggest that the underlying biological processes may produce these properties in a non-uniform manner, or there could be subgroups within the types that have different characteristics. These observations suggest caution when applying statistical tests that assume normal distributions, and they also provide insight into the biological variability inherent in these protein types.
```

# Performing Kruskal-Wallis test followed by pairwise comparison using dunn test (if  Kruskal-Wallis test results are found significant)
```{r}
# Performing Kruskal-Wallis test for each property
kruskal_results <- list()
for (property in properties) {
  formula <- as.formula(paste(property, "~ type"))
  kruskal_test <- kruskal.test(formula, data = subsampled_df)
  kruskal_results[[property]] <- kruskal_test
}

# Print Kruskal-Wallis results
for (property in properties) {
  cat("\nKruskal-Wallis test results for", property, ":\n")
  print(kruskal_results[[property]])
}
```

```{r}
# Performing post-hoc Dunn's test for each property
dunn_results <- list()
for (property in properties) {
  dunn_test <- dunnTest(subsampled_df[[property]] ~ subsampled_df$type, method = "bonferroni")
  dunn_results[[property]] <- dunn_test
}

# Print Dunn's test results
for (property in properties) {
  cat("\nDunn's test results for", property, ":\n")
  print(dunn_results[[property]])
}
```

# Selecting microprotein IDs (Chen et al. paper) randomly from the microprtoein dataframe for AlphaFold run.
```{r}
# Setting the seed for reproducibility
set.seed(44)
# Function to read fasta file using seqinr
read.fasta.file <- function(file) {
  fasta <- read.fasta(file = file, seqtype = "AA", as.string = TRUE)
  return(fasta)
}

# Loading the FASTA file
fasta_data <- read.fasta.file("/Users/namrataxxx/Desktop/Master_Thesis_material/Thesis_data_script_result/Fasta_files/uprots_weissman_riboseq_11_100.fasta")

# Checking if fasta_data has sequences
if (length(fasta_data) < 500) {
  stop("The fasta file contains fewer than 500 sequences.")
}

# Randomly sample 500 unique sequences from the FASTA data
set.seed(44) 
sampled_fasta <- sample(fasta_data, size = 500, replace = FALSE)

# Writing the sampled sequences to a new FASTA file
write.fasta(sequences = sampled_fasta, 
            names = names(sampled_fasta), 
            file.out = "/Users/namrataxxx/Desktop/Master_Thesis_material/Thesis_data_script_result/Fasta_files/sample.fasta")

sampled_sequences <- sapply(sampled_fasta, as.character)

# Creating a dataframe for the sampled IDs and lengths
results <- data.frame(ID = names(sampled_fasta), Length = sapply(sampled_fasta, nchar))

# Printing the head of the results dataframe
print(head(results))

# Plotting the length distribution
ggplot(results, aes(x = Length)) +
  geom_histogram(binwidth = 1, fill = "blue", color = "black") +
  labs(title = "Length Distribution of Sampled 500 microprotein FASTA Sequences",
       x = "Sequence Length",
       y = "Frequency") +
  theme_minimal()

```
# Script to make random snippets from canonical proteins following the same length distribution as microproteins from chen et al. paper. All peptides are <= 75 and all canonical complete length proetins are > 100. The canonical protein source is :human globular (SCOPe), membrane protein (mpstruc), human IDPs (DisProt) and human peptides (NCBI). Physiochemcial properties IDs used are (CIDH920105	CHOP780101	CHOP780201	CHOP780202	KLEP840101). PLots inlcude UMAP, t-SNE, histograms, violin plots.

```{r}
# Directly take the lengths of microproteins to create a matching length distribution for canonical proteins.
micro_protein_lengths <- micro_proteins_control1$length # 'micro_proteins_control1' is a data frame with 'length' as one of its columns.

# Read the fasta files
read_fasta <- function(file_path) {
  readAAStringSet(filepath = file_path, format = "fasta")
}

# Function to generate random snippets with matching lengths
generate_matching_snippets <- function(protein_sequences, length_distribution) {
  # Prepare a list to hold the snippets
  snippets <- vector("list", length(protein_sequences))
  
  for (i in seq_along(protein_sequences)) {
    seq <- protein_sequences[[i]]
    seq_length <- length(seq)
    
    # Randomly choose a length from the microproteins length distribution
    target_length <- sample(length_distribution, 1)
    
    # If sequence is shorter than the target length, store it as is
    if (seq_length < target_length) {
      snippet <- seq
    } else {
      # If sequence is long enough, choose a random start position for the snippet
      start_pos <- sample(1:(seq_length - target_length + 1), 1)
      snippet <- subseq(seq, start = start_pos, end = start_pos + target_length - 1)
    }
    
    # Store the snippet in the list using the sequence name as the key
    snippets[[i]] <- snippet
    names(snippets)[i] <- names(protein_sequences)[i]
  }
  
  # Remove NULL elements in case some sequences were skipped
  snippets <- snippets[!sapply(snippets, is.null)]
  
  # Convert the list to an AAStringSet object and set the names
  snippet_set <- AAStringSet(unlist(snippets, use.names = FALSE))
  names(snippet_set) <- unlist(names(snippets))
  snippet_set
}

# Function to write sequences to a fasta file
write_fasta <- function(snippets, file_name) {
  writeXStringSet(snippets, filepath = file_name)
}

# Read the fasta files
globular_proteins <- read_fasta("/Users/namrataxxx/Desktop/Master_Thesis_material/Thesis_data_script_result/Fasta_files/human_globular_protein_scope_astral_40.fasta")
membrane_proteins <- read_fasta("/Users/namrataxxx/Desktop/Master_Thesis_material/Thesis_data_script_result/Fasta_files/human_membprot_mpstrucDB.fasta")
disordered_proteins <- read_fasta("/Users/namrataxxx/Desktop/Master_Thesis_material/Thesis_data_script_result/Fasta_files/DisProt release_2023_06.fasta")

# Generate random snippets for each protein type
globular_snippets_correct <- generate_matching_snippets(globular_proteins, micro_protein_lengths)
membrane_snippets_correct <- generate_matching_snippets(membrane_proteins, micro_protein_lengths)
disordered_snippets_correct <- generate_matching_snippets(disordered_proteins, micro_protein_lengths)

# Write the snippets to new fasta files
write_fasta(globular_snippets_correct, "human_globProt_Scope40_R_randomSnippets_correct.fasta")
write_fasta(membrane_snippets_correct, "human_membProt_mpStruc_R_randomSnippets_correct.fasta")
write_fasta(disordered_snippets_correct, "human_IDPProt_Disprot_R_randomSnippets_correct.fasta")

```

```{r}
# Reading the physiochemical properties dataset of random snippets generated in R from IDP proteins (Disprot database) for 5 PP JIds.
# Read the data
human_IDPProt_Disprot_R_randomSnippets_5PP_JIDs_correct <- fread('/Users/namrataxxx/Desktop/Master_Thesis_material/Thesis_data_script_result/Weismann_Scope_MObiDB_Mpstruc_DimRed_JoostIDs/5physpropsIDS_Joost_R_randomSnippets_dataset/human_IDPProt_Disprot_R_randomSnippets_5PP_JIDs_correct.txt', header = TRUE, fill = TRUE, sep = "\t")
head(human_IDPProt_Disprot_R_randomSnippets_5PP_JIDs_correct)
#View(human_IDPProt_Disprot_R_randomSnippets_5PP_JIDs_correct )

# Removing last column
human_IDPProt_Disprot_R_randomSnippets_5PP_JIDs_correct $V8 <- NULL

# Select only the necessary columns
human_IDPProt_Disprot_R_randomSnippets_5PP_JIDs_correct  <- human_IDPProt_Disprot_R_randomSnippets_5PP_JIDs_correct [, .(protein, length, CIDH920105,	CHOP780101,	CHOP780201,	CHOP780202,	KLEP840101)]
View(human_IDPProt_Disprot_R_randomSnippets_5PP_JIDs_correct)

# Add a new column named "type" with all values as "Disordered_proteins"
human_IDPProt_Disprot_R_randomSnippets_5PP_JIDs_correct$type <- "Disordered_proteins_randomSnippets_R"
# To place the new column at the second position
human_IDPProt_Disprot_R_randomSnippets_5PP_JIDs_correct  <- human_IDPProt_Disprot_R_randomSnippets_5PP_JIDs_correct  %>%
  select(1, type, everything())
head(human_IDPProt_Disprot_R_randomSnippets_5PP_JIDs_correct)

# List of physicochemical property columns to normalize
properties <- c("CIDH920105","CHOP780101","CHOP780201",	"CHOP780202",	"KLEP840101")

# Normalize each property by the length
for (property in properties) {
  human_IDPProt_Disprot_R_randomSnippets_5PP_JIDs_correct[[paste0(property, "_norm")]] <- human_IDPProt_Disprot_R_randomSnippets_5PP_JIDs_correct[[property]] / human_IDPProt_Disprot_R_randomSnippets_5PP_JIDs_correct$length
}
tail(human_IDPProt_Disprot_R_randomSnippets_5PP_JIDs_correct)
View(human_IDPProt_Disprot_R_randomSnippets_5PP_JIDs_correct)
dim(human_IDPProt_Disprot_R_randomSnippets_5PP_JIDs_correct) # 4587 x 13

# Specify the columns you want to keep
selected_columns <- c("protein", "type", "length", "CIDH920105_norm", 
                    "CHOP780101_norm", "CHOP780201_norm", "CHOP780202_norm", "KLEP840101_norm")

# Select the specified columns
selected_data <- human_IDPProt_Disprot_R_randomSnippets_5PP_JIDs_correct[, ..selected_columns]

# Now, if the 'selected_data' is your final data.table, you can write it to a text file as follows:
#write.table(selected_data, "normalized_human_IDPProt_Disprot_R_randomSnippets_5PP_JIDs_correct.txt", sep = "\t", row.names = FALSE, quote = FALSE)

```


```{r}
# Reading the physiochemical properties dataset of random snippets generated from membrane proteins (mpStruc database) for 5 PP Ids.
human_membProt_mpStruc_R_randomSnippets_5PP_JIDs_correct <- fread('/Users/namrataxxx/Desktop/Master_Thesis_material/Thesis_data_script_result/Weismann_Scope_MObiDB_Mpstruc_DimRed_JoostIDs/5physpropsIDS_Joost_R_randomSnippets_dataset/human_membProt_mpStruc_R_randomSnippets_5PP_JIDs_correct.txt', header = TRUE, fill = TRUE, sep = "\t")
head(human_membProt_mpStruc_R_randomSnippets_5PP_JIDs_correct)
#View(human_membProt_mpStruc_R_randomSnippets_5PP_JIDs_correct )

# Removing last column
human_membProt_mpStruc_R_randomSnippets_5PP_JIDs_correct$V8 <- NULL

# Select only the necessary columns
human_membProt_mpStruc_R_randomSnippets_5PP_JIDs_correct  <- human_membProt_mpStruc_R_randomSnippets_5PP_JIDs_correct [, .(protein, length, CIDH920105,	CHOP780101,	CHOP780201, CHOP780202,KLEP840101)]
#View(human_membProt_mpStruc_R_randomSnippets_5PP_JIDs_correct)

# Add a new column named "type" with all values as "Membrane_proteins"
human_membProt_mpStruc_R_randomSnippets_5PP_JIDs_correct$type <- "Membrane_proteins_randomSnippets_R"
# To place the new column at the second position
human_membProt_mpStruc_R_randomSnippets_5PP_JIDs_correct  <- human_membProt_mpStruc_R_randomSnippets_5PP_JIDs_correct  %>%
  select(1, type, everything())
head(human_membProt_mpStruc_R_randomSnippets_5PP_JIDs_correct)

# List of physicochemical property columns to normalize
properties <- c("CIDH920105","CHOP780101","CHOP780201",	"CHOP780202",	"KLEP840101")

# Normalize each property by the length
for (property in properties) {
  human_membProt_mpStruc_R_randomSnippets_5PP_JIDs_correct[[paste0(property, "_norm")]] <- human_membProt_mpStruc_R_randomSnippets_5PP_JIDs_correct[[property]] / human_membProt_mpStruc_R_randomSnippets_5PP_JIDs_correct$length
}
tail(human_membProt_mpStruc_R_randomSnippets_5PP_JIDs_correct)
#View(human_membProt_mpStruc_R_randomSnippets_5PP_JIDs_correct)
dim(human_membProt_mpStruc_R_randomSnippets_5PP_JIDs_correct) # 1719 x 13

# Specify the columns you want to keep
selected_columns <- c("protein", "type", "length", "CIDH920105_norm", 
                     "CHOP780101_norm", "CHOP780201_norm", "CHOP780202_norm", "KLEP840101_norm")

# Select the specified columns
selected_data <- human_membProt_mpStruc_R_randomSnippets_5PP_JIDs_correct[, ..selected_columns]

# Now, if the 'selected_data' is your final data.table, you can write it to a text file as follows:
#write.table(selected_data, "normalized_human_membProt_mpStruc_R_randomSnippets_5PP_JIDs_correct.txt", sep = "\t", row.names = FALSE, quote = FALSE)
```

```{r}
# Reading the physiochemical properties dataset of random snippets generated from globular proteins (Scope database) for 5 PP Ids.
human_globProt_Scope40_R_randomSnippets_5PP_JIDs_correct <- fread('/Users/namrataxxx/Desktop/Master_Thesis_material/Thesis_data_script_result/Weismann_Scope_MObiDB_Mpstruc_DimRed_JoostIDs/5physpropsIDS_Joost_R_randomSnippets_dataset/human_globProt_Scope40_R_randomSnippets_5PP_JIDs_correct.txt', header = TRUE, fill = TRUE, sep = "\t")
head(human_globProt_Scope40_R_randomSnippets_5PP_JIDs_correct)
#View(human_globProt_Scope40_R_randomSnippets_5PP_JIDs_correct )

# Removing last column
human_globProt_Scope40_R_randomSnippets_5PP_JIDs_correct$V8 <- NULL

# Select only the necessary columns
human_globProt_Scope40_R_randomSnippets_5PP_JIDs_correct  <- human_globProt_Scope40_R_randomSnippets_5PP_JIDs_correct [, .(protein, length, CIDH920105,	CHOP780101,	CHOP780201, CHOP780202,KLEP840101)]
#View(human_globProt_Scope40_R_randomSnippets_5PP_JIDs_correct)

# Add a new column named "type" with all values as "Membrane_proteins"
human_globProt_Scope40_R_randomSnippets_5PP_JIDs_correct$type <- "Globular_proteins_randomSnippets_R"
# To place the new column at the second position
human_globProt_Scope40_R_randomSnippets_5PP_JIDs_correct  <- human_globProt_Scope40_R_randomSnippets_5PP_JIDs_correct  %>%
  select(1, type, everything())
head(human_globProt_Scope40_R_randomSnippets_5PP_JIDs_correct)

# List of physicochemical property columns to normalize
properties <- c("CIDH920105","CHOP780101","CHOP780201",	"CHOP780202",	"KLEP840101")

# Normalize each property by the length
for (property in properties) {
  human_globProt_Scope40_R_randomSnippets_5PP_JIDs_correct[[paste0(property, "_norm")]] <- human_globProt_Scope40_R_randomSnippets_5PP_JIDs_correct[[property]] / human_globProt_Scope40_R_randomSnippets_5PP_JIDs_correct$length
}
tail(human_globProt_Scope40_R_randomSnippets_5PP_JIDs_correct)
#View(human_globProt_Scope40_R_randomSnippets_5PP_JIDs_correct)
dim(human_globProt_Scope40_R_randomSnippets_5PP_JIDs_correct) # 2778 x 13

# Specify the columns you want to keep
selected_columns <- c("protein", "type", "length", "CIDH920105_norm", 
                     "CHOP780101_norm", "CHOP780201_norm", "CHOP780202_norm", "KLEP840101_norm")

# Select the specified columns
selected_data <- human_globProt_Scope40_R_randomSnippets_5PP_JIDs_correct[, ..selected_columns]

# Now, if the 'selected_data' is your final data.table, you can write it to a text file as follows:
#write.table(selected_data, "normalized_human_globProt_Scope40_R_randomSnippets_5PP_JIDs_correct.txt", sep = "\t", row.names = FALSE, quote = FALSE)
```

```{r}
### Dataset with NCBI peptide + uprot + random snippets of canonical proteins generated in R for 5PP JIDs.
# Reading normalized data and prepapring for UMAP analysis

normalized_human_uprot_weismann_8physpropsids <- read.table("/Users/namrataxxx/Desktop/Master_Thesis_material/Thesis_data_script_result/Weismann_Scope_MObiDB_Mpstruc_DimRed_JoostIDs/8physpropIDs_dataset/normalized_human_uprot_weismann_8physpropsids.txt", header=TRUE, sep="\t")
dim(normalized_human_uprot_weismann_8physpropsids) # 10694  x  11
#View(normalized_human_uprot_weismann_8physpropsids)

normalized_human_IDPProt_Disprot_R_randomSnippets_5PP_JIDs_correct <- fread("/Users/namrataxxx/Desktop/Master_Thesis_material/Thesis_data_script_result/Weismann_Scope_MObiDB_Mpstruc_DimRed_JoostIDs/5physpropsIDS_Joost_R_randomSnippets_dataset/normalized_human_IDPProt_Disprot_R_randomSnippets_5PP_JIDs_correct.txt", header = TRUE, fill = TRUE, sep = "\t")
dim(normalized_human_IDPProt_Disprot_R_randomSnippets_5PP_JIDs_correct) # 4587 x  8

normalized_human_membProt_mpStruc_R_randomSnippets_5PP_JIDs_correct <- read.table("/Users/namrataxxx/Desktop/Master_Thesis_material/Thesis_data_script_result/Weismann_Scope_MObiDB_Mpstruc_DimRed_JoostIDs/5physpropsIDS_Joost_R_randomSnippets_dataset/normalized_human_membProt_mpStruc_R_randomSnippets_5PP_JIDs_correct.txt", header=TRUE, sep="\t")
dim(normalized_human_membProt_mpStruc_R_randomSnippets_5PP_JIDs_correct) # 1719 x 8
#View(normalized_human_membProt_mpStruc_R_randomSnippets_5PP_JIDs_correct)

# Select only the rows with unique protein IDs
#normalized_human_membProt_mpStruc_R_randomSnippets_5PP_JIDs_correct <- normalized_human_membProt_mpStruc_R_randomSnippets_5PP_JIDs_correct %>% distinct(protein, .keep_all = TRUE)

normalized_human_globProt_Scope40_R_randomSnippets_5PP_JIDs_correct <- read.table("/Users/namrataxxx/Desktop/Master_Thesis_material/Thesis_data_script_result/Weismann_Scope_MObiDB_Mpstruc_DimRed_JoostIDs/5physpropsIDS_Joost_R_randomSnippets_dataset/normalized_human_globProt_Scope40_R_randomSnippets_5PP_JIDs_correct.txt", header=TRUE, sep="\t")
dim(normalized_human_globProt_Scope40_R_randomSnippets_5PP_JIDs_correct) # 2778 x  8

# Select only the rows with unique protein IDs
normalized_human_globProt_Scope40_R_randomSnippets_5PP_JIDs_correct <- normalized_human_globProt_Scope40_R_randomSnippets_5PP_JIDs_correct %>% distinct(protein, .keep_all = TRUE)
dim(normalized_human_globProt_Scope40_R_randomSnippets_5PP_JIDs_correct) # 2380 x  8

normalized_human_peptideSeq_NCBI_new_8physphrosids <- read.table("/Users/namrataxxx/Desktop/Master_Thesis_material/Thesis_data_script_result/Weismann_Scope_MObiDB_Mpstruc_DimRed_JoostIDs/8physpropIDs_dataset/normalized_human_peptideSeq_NCBI_new_8physphrosids.txt", header=TRUE, sep="\t")
dim(normalized_human_peptideSeq_NCBI_new_8physphrosids) # 2212 x  11

# Filtering peptides pnly <=75 aa
normalized_human_peptideSeq_NCBI_new_8physphrosids_smallerORequal75 <- normalized_human_peptideSeq_NCBI_new_8physphrosids %>% filter(length <= 75)
dim(normalized_human_peptideSeq_NCBI_new_8physphrosids_smallerORequal75) # 1381 x 11
#View(normalized_human_peptideSeq_NCBI_new_8physphrosids_smallerORequal75)


normalized_human_uprot_weismann_8physpropsids_5000 <- normalized_human_uprot_weismann_8physpropsids[sample(nrow(normalized_human_uprot_weismann_8physpropsids), 5000),]  #subsampling to reduce microprot set size 
dim(normalized_human_uprot_weismann_8physpropsids_5000) # 5000 x  11
#head(normalized_human_uprot_weismann_8physpropsids_5000)


uprot_peptide_8PP <- rbind(normalized_human_uprot_weismann_8physpropsids_5000,normalized_human_peptideSeq_NCBI_new_8physphrosids_smallerORequal75)
head(uprot_peptide_8PP)
uprot_peptide_5PP_JID <- uprot_peptide_8PP[c(1:8)]
dim(uprot_peptide_5PP_JID)
random_snippet_r_t_5PP_JTD_correct <- rbind(uprot_peptide_5PP_JID, normalized_human_IDPProt_Disprot_R_randomSnippets_5PP_JIDs_correct)

random_snippet_r_tt_5PP_JTD_correct <- rbind(random_snippet_r_t_5PP_JTD_correct,normalized_human_membProt_mpStruc_R_randomSnippets_5PP_JIDs_correct)
combined_random_snippet_R_5PP_JID_correct <- rbind(random_snippet_r_tt_5PP_JTD_correct,normalized_human_globProt_Scope40_R_randomSnippets_5PP_JIDs_correct)
dim(combined_random_snippet_R_5PP_JID_correct) # 15067  x  8
head(combined_random_snippet_R_5PP_JID_correct)
#View(combined_random_snippet_R_5PP_JID_correct)
sum(is.na(combined_random_snippet_R_5PP_JID_correct))
combined_random_snippet_R_5PP_JID_correct <- na.omit(combined_random_snippet_R_5PP_JID_correct)

# Correcting the script to update 'type' column with new names
combined_random_snippet_R_5PP_JID_correct <- combined_random_snippet_R_5PP_JID_correct %>%
  mutate(type = case_when(
    type == "micro" ~ "Microprotein",
    type == "Disordered_proteins_randomSnippets_R" ~ "Disordered protein random snippets",
    type == "Globular_proteins_randomSnippets_R" ~ "Globular protein random snippets",
    type == "Membrane_proteins_randomSnippets_R" ~ "Membrane protein random snippets",
    type == "peptide" ~ "Peptide",
    TRUE ~ type  # Preserves original type if none of the conditions above are met
  ))
``` 

```{r}
# Prepare the data for UMAP, selecting only the columns with the physical property values
umap_data_combined_random_snippet_R_5PP_JTD_correct <- combined_random_snippet_R_5PP_JID_correct[, c("CIDH920105_norm", "CHOP780101_norm", "CHOP780201_norm", "CHOP780202_norm", "KLEP840101_norm")]
head(umap_data_combined_random_snippet_R_5PP_JTD_correct)
# Run UMAP
set.seed(48) # Set a random seed for reproducibility
umap_result_combined_random_snippet_R_5PP_JTD_correct <- umap(umap_data_combined_random_snippet_R_5PP_JTD_correct,n_neighbors=15, min_dist=0.3)

# Create a data frame for plotting that includes the UMAP dimensions and the protein type
plot_data_j_combined_random_snippet_R_5PP_JTD_correct <- data.frame(UMAP1 = umap_result_combined_random_snippet_R_5PP_JTD_correct$layout[,1], UMAP2 = umap_result_combined_random_snippet_R_5PP_JTD_correct$layout[,2], Type = combined_random_snippet_R_5PP_JID_correct$type)
head(plot_data_j_combined_random_snippet_R_5PP_JTD_correct)


# Define custom colors for the plot
my_colors_combined_random_snippet_R_5PP_JTD_correct <- c("Disordered protein random snippets" = "#800080","Globular protein random snippets" = "#98FB98","Membrane protein random snippets" = "cyan","Microprotein" ="yellow", "Peptide" = "pink")

# Plot using ggplot2
p1_combined_combined_random_snippet_R_5PP_JTD_correct <- ggplot(plot_data_j_combined_random_snippet_R_5PP_JTD_correct, aes(x = UMAP1, y = UMAP2, color = Type)) +
  geom_point(size=0.65, alpha=0.75) + # Adjust point transparency with the alpha parameter
    scale_color_manual(values = my_colors_combined_random_snippet_R_5PP_JTD_correct) + # Use the custom colors
  labs(title = "UMAP Visualization of Protein Clusters_Weismann_Disprot_Scope_mpStruc_NCBI_DB_Random_Snippets_R(5PP_JIDs)_correct",
       x = "UMAP Dimension 1",
       y = "UMAP Dimension 2",
       color = "Protein Type") +
  theme_minimal()
p1_combined_combined_random_snippet_R_5PP_JTD_correct
```

```{r}
# Perform t-SNE
set.seed(42) # Set a random seed for reproducibility
tsne_result_combined_random_snippet_R_5PP_JTD_correct <- Rtsne(dist(umap_data_combined_random_snippet_R_5PP_JTD_correct), dims = 2, perplexity = 15, theta = 0.0, max_iter= 1000, verbose = FALSE )

# Create a data frame for plotting that includes the t-SNE dimensions and the protein type
tsne_data_combined_random_snippet_R_5PP_JTD_correct <- data.frame(TSNE1 = tsne_result_combined_random_snippet_R_5PP_JTD_correct$Y[,1], TSNE2 = tsne_result_combined_random_snippet_R_5PP_JTD_correct$Y[,2], Type = combined_random_snippet_R_5PP_JID_correct$type)

my_colors_combined_random_snippet_R_5PP_JTD_correct <- c("Disordered protein random snippets" = "#800080","Globular protein random snippets" = "#98FB98","Membrane protein random snippets" = "cyan","Microprotein" ="yellow", "Peptide" = "pink")

# Plot using ggplot2
p3_combined_combined_random_snippet_R_5PP_JTD_correct <- ggplot(tsne_data_combined_random_snippet_R_5PP_JTD_correct, aes(x = TSNE1, y = TSNE2, color = Type)) +
  geom_point(size=0.65, alpha=0.75) +
  scale_color_manual(values = my_colors_combined_random_snippet_R_5PP_JTD_correct) + # Use the custom colors
  labs(title = "t-SNE Visualization of Protein  Clusters_Weismann_Disprot_Scope_mpStruc_NCBI_DB_RandSnippets_R(5PP_JIDs)_correct",
       x = "t-SNE Dimension 1",
       y = "t-SNE Dimension 2",
       color = "Protein Type") +
  theme_minimal()
p3_combined_combined_random_snippet_R_5PP_JTD_correct
```

```{r}
# t-SNE on scaled physical property scores
combined_random_snippet_R_5PP_JID_correct_properties <- combined_random_snippet_R_5PP_JID_correct[, c(4:8)]
head(combined_random_snippet_R_5PP_JID_correct_properties)

# Standardize the properties_combined_disport_control2_5PP_J
combined_random_snippet_R_5PP_JID_correct_scaled <- scale(combined_random_snippet_R_5PP_JID_correct_properties)
head(combined_random_snippet_R_5PP_JID_correct_scaled)


umap_data_combined_random_snippet_R_5PP_JID_correct_scaled <- combined_random_snippet_R_5PP_JID_correct_scaled[, c("CIDH920105_norm", "CHOP780101_norm", "CHOP780201_norm", "CHOP780202_norm", "KLEP840101_norm")]

# Perform t-SNE
set.seed(42) # Set a random seed for reproducibility
tsne_result_combined_random_snippet_R_5PP_JTD_correct_scaled <- Rtsne(dist(umap_data_combined_random_snippet_R_5PP_JID_correct_scaled), dims = 2, perplexity = 15, theta = 0.0, max_iter= 1000, verbose = FALSE )

# Create a data frame for plotting that includes the t-SNE dimensions and the protein type
tsne_data_combined_random_snippet_R_5PP_JTD_correct_scaled <- data.frame(TSNE1 = tsne_result_combined_random_snippet_R_5PP_JTD_correct_scaled$Y[,1], TSNE2 = tsne_result_combined_random_snippet_R_5PP_JTD_correct_scaled$Y[,2], Type = combined_random_snippet_R_5PP_JID_correct$type)

my_colors_combined_random_snippet_R_5PP_JTD_correct <- c("Disordered protein random snippets" = "#800080","Globular protein random snippets" = "#98FB98","Membrane protein random snippets" = "cyan","Microprotein" ="yellow", "Peptide" = "pink")


# Plot using ggplot2
p3_combined_combined_random_snippet_R_5PP_JTD_correct_scaled <- ggplot(tsne_data_combined_random_snippet_R_5PP_JTD_correct_scaled, aes(x = TSNE1, y = TSNE2, color = Type)) +
  geom_point(size=0.65, alpha=0.75) +
  scale_color_manual(values = my_colors_combined_random_snippet_R_5PP_JTD_correct) + # Use the custom colors
  labs(title = "t-SNE Visualization of Protein  Clusters_Weismann_Disprot_Scope_mpStruc_NCBI_DB_RandSnippets_R(5PP_JIDs)_correct_scaled",
       x = "t-SNE Dimension 1",
       y = "t-SNE Dimension 2",
       color = "Protein Type") +
  theme_minimal()
p3_combined_combined_random_snippet_R_5PP_JTD_correct_scaled
```


```{r}
# Filter data for each protein type to make plot for length distribution
micro_proteins_randomSnippets_R_correct <- combined_random_snippet_R_5PP_JID_correct[combined_random_snippet_R_5PP_JID_correct$type == 'Microprotein', ]
disprot_proteins_randomSnippets_R_correct <- combined_random_snippet_R_5PP_JID_correct[combined_random_snippet_R_5PP_JID_correct$type == 'Disordered protein random snippets', ]
membrane_randomSnippets_R_correct <- combined_random_snippet_R_5PP_JID_correct[combined_random_snippet_R_5PP_JID_correct$type == 'Membrane protein random snippets', ]
globular_randomSnippets_R_correct <- combined_random_snippet_R_5PP_JID_correct[combined_random_snippet_R_5PP_JID_correct$type == 'Globular protein random snippets', ]
peptides_randomSnippets_R_correct <- combined_random_snippet_R_5PP_JID_correct[combined_random_snippet_R_5PP_JID_correct$type == 'Peptide', ]

# Function to plot length distribution for a given protein type
plot_length_distribution <- function(protein_data, protein_type) {
  ggplot(protein_data, aes(x=length)) +
    geom_histogram(bins = 30, fill = 'skyblue', color = 'black') +
    labs(title = paste('Length Distribution of', protein_type),
         x = 'Length',
         y = 'Frequency') +
    theme_minimal()
}

```

```{r}
# Plotting length distribution for microproteins
plotMicro_randomSnippets_R_correct <- plot_length_distribution(micro_proteins_randomSnippets_R_correct, 'Microproteins')
print(plotMicro_randomSnippets_R_correct)
```

```{r}
# Plotting length distribution for disordered prpteins
plotDisprot_proteins_randomSnippets_R_correct <- plot_length_distribution(disprot_proteins_randomSnippets_R_correct, 'Disordered protein random snippets')
print(plotDisprot_proteins_randomSnippets_R_correct)
```

```{r}
# Plotting length distribution for globular proteins
plotGlobprot_randomSnippets_R_correct <- plot_length_distribution(globular_randomSnippets_R_correct, 'Globular protein random snippets')
print(plotGlobprot_randomSnippets_R_correct)
```

```{r}
# Plotting length distribution for membrane proteins
plotMembprot_randomSnippets_R_correct <- plot_length_distribution(membrane_randomSnippets_R_correct, 'Membrane protein random snippets')
print(plotMembprot_randomSnippets_R_correct)
```

```{r}
# Plotting length distribution for globular proteins
plotPeptide_correct <- plot_length_distribution(peptides_randomSnippets_R_correct, 'Peptide')
print(plotPeptide_correct)
```

```{r}
# combined datset (complete length proteins, random snippets, uprot and peptides) of uprot (weismann), IDP (disprot), globular prot (scope), membrane prot (mpstruc) and peptides from NCBI. All the standard proteins are above 100 aa and peptides <= 75. All the plots are made using 5 PP IDs.

normalized_human_membprot_mpstruc_8physpropsids <- read.table("/Users/namrataxxx/Desktop/Master_Thesis_material/Thesis_data_script_result/Weismann_Scope_MObiDB_Mpstruc_DimRed_JoostIDs/8physpropIDs_dataset/normalized_human_membprot_mpstruc_8physpropsids.txt", header=TRUE, sep="\t")
dim(normalized_human_membprot_mpstruc_8physpropsids) # 1705 x 11
#View(normalized_human_membprot_mpstruc_8physpropsids)

# Filter for membrane proteins larger than 100 amino acids
normalized_human_membprot_mpstruc_8physpropsids_longerthan100 <- normalized_human_membprot_mpstruc_8physpropsids %>% filter(length > 100)
dim(normalized_human_membprot_mpstruc_8physpropsids_longerthan100) # 1428 x 11
#View(normalized_human_membprot_mpstruc_8physpropsids_longerthan100)

normalized_human_membprot_mpstruc_5physpropsids_longerthan100 <- normalized_human_membprot_mpstruc_8physpropsids_longerthan100[c(1:8)]
dim(normalized_human_membprot_mpstruc_5physpropsids_longerthan100) #1428 x 8

normalized_human_globprot_scopeastral40_8physpropids <- read.table("/Users/namrataxxx/Desktop/Master_Thesis_material/Thesis_data_script_result/Weismann_Scope_MObiDB_Mpstruc_DimRed_JoostIDs/8physpropIDs_dataset/normalized_human_globprot_scopeastral40_8physpropids.txt", header=TRUE, sep="\t")
dim(normalized_human_globprot_scopeastral40_8physpropids) # 2741 x  11

# Filter for globular proteins larger than 100 amino acids
normalized_human_globprot_scopeastral40_8physpropsids_longerthan100 <- normalized_human_globprot_scopeastral40_8physpropids %>% filter(length > 100)
dim(normalized_human_globprot_scopeastral40_8physpropsids_longerthan100) # 1718 x 11
#View(normalized_human_globprot_scopeastral40_8physpropsids_longerthan100)

normalized_human_globprot_scopeastral40_5physpropsids_longerthan100 <- normalized_human_globprot_scopeastral40_8physpropsids_longerthan100[c(1:8)]
dim(normalized_human_globprot_scopeastral40_5physpropsids_longerthan100) #1718 x 8

New_Disprot_dim_j <- fread("/Users/namrataxxx/Desktop/Master_Thesis_material/Thesis_data_script_result/Joost_new_data/normalized_newData_disprot_joost.txt", header = TRUE, fill = TRUE, sep = "\t")
dim(New_Disprot_dim_j) # 4587 x  8

# Filter for disordered proteins larger than 100 amino acids
normalized_human_disprot_Disprot_dim_j_longerthan100 <- New_Disprot_dim_j[length > 100]
dim(normalized_human_disprot_Disprot_dim_j_longerthan100) # 1069 x 8
View(normalized_human_disprot_Disprot_dim_j_longerthan100) 

combined_random_snippet_R_5PP_JID_complete1_correct <- rbind(combined_random_snippet_R_5PP_JID_correct,normalized_human_disprot_Disprot_dim_j_longerthan100 )
combined_random_snippet_R_5PP_JID_complete2_correct <- rbind(combined_random_snippet_R_5PP_JID_complete1_correct,normalized_human_globprot_scopeastral40_5physpropsids_longerthan100 )
combined_random_snippet_R_5PP_JID_complete_correct <- rbind(combined_random_snippet_R_5PP_JID_complete2_correct,normalized_human_membprot_mpstruc_5physpropsids_longerthan100 )

dim(combined_random_snippet_R_5PP_JID_complete_correct) # 20113  x  8
head(combined_random_snippet_R_5PP_JID_complete_correct)
#View(combined_random_snippet_R_5PP_JID_complete_correct)
sum(is.na(combined_random_snippet_R_5PP_JID_complete_correct))
combined_random_snippet_R_5PP_JID_complete_correct <- na.omit(combined_random_snippet_R_5PP_JID_complete_correct)

# Correcting the script to update 'type' column with new names
combined_random_snippet_R_5PP_JID_complete_correct <- combined_random_snippet_R_5PP_JID_complete_correct %>%
  mutate(type = case_when(
    type == "micro" ~ "Microprotein",
    type == "disprot" ~ "Disordered protein",
    type == "globular_prot_scope" ~ "Globular protein",
    type == "membrane_prot" ~ "Membrane protein",
    type == "Disordered_proteins_randomSnippets_R" ~ "Disordered protein random snippets",
    type == "Globular_proteins_randomSnippets_R" ~ "Globular protein random snippets",
    type == "Membrane_proteins_randomSnippets_R" ~ "Membrane protein random snippets",
    type == "peptide" ~ "Peptide",
    TRUE ~ type  # Preserves original type if none of the conditions above are met
  ))

```

```{r}
# Making violin plots of scaled complete length combined proteins, uprot, peptides and random_snippets_R to compare the distribution of scores

# Combined dataset of PP properties of complete length proteins,random_snippets_R length, microproteins and peptides
combined_random_snippet_R_5PP_JID_complete_correct
dim(combined_random_snippet_R_5PP_JID_complete_correct) # 20113  x   8
#View(combined_random_snippet_R_5PP_JID_complete_correct)

# Scaling the properties for this combined dataset
combined_random_snippet_R_5PP_JID_complete_correct_properties <- combined_random_snippet_R_5PP_JID_complete_correct[, c(4:8)]
head(combined_random_snippet_R_5PP_JID_complete_correct_properties)

# Standardize the properties_combined_disport_control2_5PP_J
combined_random_snippet_R_5PP_JID_complete_correct_scaled <- scale(combined_random_snippet_R_5PP_JID_complete_correct_properties)
head(combined_random_snippet_R_5PP_JID_complete_correct_scaled)

# Selecting the first 3 columns of combined_disport_control6_5PP_J
columns_to_add_random_complete <- combined_random_snippet_R_5PP_JID_complete_correct[, 1:3]

# Adding selected columns to combined_disport_control6_5PP_J_scaled
combined_random_snippet_R_5PP_JID_complete_correct_scaled <- cbind(columns_to_add_random_complete,combined_random_snippet_R_5PP_JID_complete_correct_scaled)
head(combined_random_snippet_R_5PP_JID_complete_correct_scaled)


# Define custom colors for the plot
my_colors_randSnippet_R_combined_complete <- c("Disordered protein random snippets" = "#800080",
               "Globular protein random snippets" = "#98FB98",
               "Membrane protein random snippets" = "cyan",
               "Microprotein" = "yellow",
               "Peptide" = "pink",
               "Globular protein" = "green",
               "Disordered protein" = "red",
               "Membrane protein" = "blue")



# Reshape the dataframe to long format
df_long_combined_random_snippet_R_5PP_JTD_complete_correct_scaled <- combined_random_snippet_R_5PP_JID_complete_correct_scaled %>%
  pivot_longer(cols = c("CIDH920105_norm", "CHOP780101_norm", "CHOP780201_norm", "CHOP780202_norm","KLEP840101_norm"),names_to = "property", values_to = "score")

# Generate violin plots
ggplot(df_long_combined_random_snippet_R_5PP_JTD_complete_correct_scaled, aes(x = type, y = score, fill = type)) +
  geom_violin(trim = FALSE) +
  scale_fill_manual(values = my_colors_randSnippet_R_combined_complete) +
  facet_wrap(~property, scales = 'free_y') + # Create a separate violin plot for each property
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1), # Adjust text angle for x axis labels
        legend.position = "none") + # Hide the legend, uncomment this line if legend is needed
  labs(x = "Type", y = "Normalized physico-chemical property score", title = "Violin Plots of Physicochemical Properties") +
  guides(fill=guide_legend(title="Type")) # Include this line to add the legend back if needed

```


```{r}

# Define custom colors for the plot
my_colors_randSnippet_R_combined_complete <- c("Disordered protein random snippets" = "#800080",
               "Globular protein random snippets" = "#98FB98",
               "Membrane protein random snippets" = "cyan",
               "Microprotein" = "yellow",
               "Peptide" = "pink",
               "Globular protein" = "green",
               "Disordered protein" = "red",
               "Membrane protein" = "blue")

# Reshape the dataframe to long format
df_long_combined_random_snippet_R_5PP_JTD_complete_correct_scaled <- combined_random_snippet_R_5PP_JID_complete_correct_scaled %>%
  pivot_longer(cols = c("CIDH920105_norm", "CHOP780101_norm", "CHOP780201_norm", "CHOP780202_norm","KLEP840101_norm"),names_to = "property", values_to = "score")


for (prop in properties) {
  p <- ggplot(subset(df_long_combined_random_snippet_R_5PP_JTD_complete_correct_scaled, property == prop), aes(x = type, y = score, fill = type)) +
    geom_violin(trim = FALSE, adjust = 1.5, width = 1) +  # Increase 'adjust' for smoother violins and 'width' for wider violins
    scale_fill_manual(values = my_colors_randSnippet_R_combined_complete) +
    theme_minimal() +
    theme(axis.text.x = element_text(angle = 45, hjust = 1), 
          legend.position = "none") +
    labs(x = "Protein/Snippet Type", y = "Normalized physico-chemical property score", title = prop) +
    ylim(quantile(df_long_combined_random_snippet_R_5PP_JTD_complete_correct_scaled$score, probs = c(0.01, 0.99)))  # Adjust the limits of y-axis to avoid extreme outliers
  
  print(p)  # This will print the plot to the RStudio Plots pane or your graphics device
}
```

```{r}
# Function to create and adjust violin plot for a given property
create_violin_plot_combined_random_snippet_R_5PP_JTD_complete_correct_scaled <- function(property_name, y_limits = NULL) {
  p <- ggplot(subset(df_long_combined_random_snippet_R_5PP_JTD_complete_correct_scaled, property == property_name), aes(x = type, y = score, fill = type)) +
    geom_violin(trim = FALSE, adjust = 1.5) +  # adjust parameter smooths the violin plot
    geom_boxplot(width=0.05, fill="white", outlier.shape = NA, position=position_dodge(width=0.25)) + # Adjust width and position
    scale_fill_manual(values = my_colors_randSnippet_R_combined_complete) +
    theme_minimal() +
    theme(axis.text.x = element_text(angle = 45, hjust = 1),
          legend.position = "none") +
    labs(x = "Protein/Random snippet Type", y = "Normalized physico-chemical property score", title = property_name)

  # Adjust y-axis limits if provided
  if (!is.null(y_limits)) {
    p <- p + ylim(y_limits)
  }

  return(p)
}

# Generate plot for the CIDH920105_norm property with adjusted limits
p_CIDH920105_norm_combined_random_snippet_R_5PP_JTD_complete_correct_scaled <- create_violin_plot_combined_random_snippet_R_5PP_JTD_complete_correct_scaled("CIDH920105_norm", c(-1, 2))
print(p_CIDH920105_norm_combined_random_snippet_R_5PP_JTD_complete_correct_scaled)

```

```{r}
p_CHOP780101_norm_combined_random_snippet_R_5PP_JTD_complete_correct_scaled <- create_violin_plot_combined_random_snippet_R_5PP_JTD_complete_correct_scaled("CHOP780101_norm",c(-1.5, 2.5))
print(p_CHOP780101_norm_combined_random_snippet_R_5PP_JTD_complete_correct_scaled)
```

```{r}
p_CHOP780201_norm_combined_random_snippet_R_5PP_JTD_complete_correct_scaled <- create_violin_plot_combined_random_snippet_R_5PP_JTD_complete_correct_scaled("CHOP780201_norm",c(-1.5, 2.5))
print(p_CHOP780201_norm_combined_random_snippet_R_5PP_JTD_complete_correct_scaled)
```

```{r}
p_CHOP780202_norm_combined_random_snippet_R_5PP_JTD_complete_correct_scaled <- create_violin_plot_combined_random_snippet_R_5PP_JTD_complete_correct_scaled("CHOP780202_norm",c(-1.5, 2.5))
print(p_CHOP780202_norm_combined_random_snippet_R_5PP_JTD_complete_correct_scaled)
```

```{r}
p_KLEP840101_norm_combined_random_snippet_R_5PP_JTD_complete_correct_scaled <- create_violin_plot_combined_random_snippet_R_5PP_JTD_complete_correct_scaled("KLEP840101_norm",c(-1, 1))
print(p_KLEP840101_norm_combined_random_snippet_R_5PP_JTD_complete_correct_scaled)
```

# Statistical significance testing on random snippets generated in R.
```{r}
combined_random_snippet_R_5PP_JID_correct_properties <- combined_random_snippet_R_5PP_JID_correct[, c(4:8)]
head(combined_random_snippet_R_5PP_JID_correct_properties)

# Standardize the properties_combined_disport_control2_5PP_J
combined_random_snippet_R_5PP_JID_correct_scaled <- scale(combined_random_snippet_R_5PP_JID_correct_properties)
head(combined_random_snippet_R_5PP_JID_correct_scaled)

# Selecting the first 3 columns of combined_disport_control6_5PP_J
columns_to_add_combined_random_snippet_R_5PP_JID_correct <- combined_random_snippet_R_5PP_JID_correct[, 1:3]

# Adding selected columns to combined_disport_control6_5PP_J_scaled
combined_random_snippet_R_5PP_JID_correct_scaled <- cbind(columns_to_add_combined_random_snippet_R_5PP_JID_correct,combined_random_snippet_R_5PP_JID_correct_scaled)
head(combined_random_snippet_R_5PP_JID_correct_scaled)

# Loading the dataset
df_combined_random_snippet_R_5PP_JID_correct_scaled <- combined_random_snippet_R_5PP_JID_correct_scaled

# Inspecting the dataset
head(df_combined_random_snippet_R_5PP_JID_correct_scaled)

# Defining the properties to test
properties <- c("CIDH920105_norm", "CHOP780101_norm", "CHOP780201_norm", "CHOP780202_norm", "KLEP840101_norm")

# Function to perform subsampling
subsample_proteins <- function(data, sample_size = 100) {
  data %>%
    group_by(type) %>%
    sample_n(sample_size, replace = FALSE)
}

# Performing subsampling
subsampled_df_combined_random_snippet_R_5PP_JID_correct_scaled <- subsample_proteins(df_combined_random_snippet_R_5PP_JID_correct_scaled)

# Checking the length distribution of the subsampled dataset
length_distribution <- subsampled_df_combined_random_snippet_R_5PP_JID_correct_scaled %>%
  group_by(type) %>%
  summarise(mean_length = mean(length), sd_length = sd(length), count = n())

# Printing length distribution
cat("\nLength distribution of subsampled dataset:\n")
print(length_distribution)

# Plotting length distribution
ggplot(subsampled_df_combined_random_snippet_R_5PP_JID_correct_scaled, aes(x = type, y = length, fill = type)) +
  geom_boxplot() +
  labs(title = "Length Distribution of Subsampled Dataset", x = "Protein Type", y = "Length") +
  theme_minimal()

```

```{r}
# Checking normality for each property
normality_results <- list()
for (property in properties) {
  normality_test <- shapiro.test(subsampled_df_combined_random_snippet_R_5PP_JID_correct_scaled[[property]])
  normality_results[[property]] <- normality_test
}

# Printing normality test results
for (property in properties) {
  cat("\nNormality test results for", property, ":\n")
  print(normality_results[[property]])
}
```

# Visualizations using histograms,box,QQ,density plots on complete dataset.
```{r}

# Create a combined histogram plot for each property
for (property in properties) {
  ggplot(subsampled_df_combined_random_snippet_R_5PP_JID_correct_scaled, aes_string(x = property, fill = 'type')) + 
    geom_histogram(binwidth = 0.1, alpha = 0.6, position = 'identity') + # adjust binwidth as needed
    facet_wrap(~type, scales = "free") + 
    theme_bw() +
    labs(title = paste("Histogram for", property), x = property, y = "Count") +
    theme(legend.position = "bottom") -> p
  
  print(p)
}

```

```{r}
# Create Q-Q plots for each property
for (property in properties) {
  ggplot(subsampled_df_combined_random_snippet_R_5PP_JID_correct_scaled, aes_string(sample = property)) + 
    stat_qq() +
    stat_qq_line() +
    facet_wrap(~type, scales = "free") +
    theme_bw() +
    labs(title = paste("Q-Q Plot for", property)) -> p
  
  print(p)
}

# In the case of KLEP840101, the deviations from the line in the Q-Q plots suggest that the physicochemical properties for these protein types do not follow a normal distribution. This is particularly true for the tails of the distributions (both light and heavy tails) and is most pronounced in the "micro" and "peptide" protein types. If the points in the QQ plot fall approximately along a straight line, it suggests that the two distributions being compared are similar.
#If the points deviate systematically from a straight line, it indicates that the distributions differ. Deviations towards the ends of the line indicate that one distribution is more spread out than the other.
```

```{r}
# Create a density plot for each property
for (property in properties) {
  ggplot(subsampled_df_combined_random_snippet_R_5PP_JID_correct_scaled, aes_string(x = property, fill = 'type')) + 
    geom_density(alpha = 0.6) +
    facet_wrap(~type, scales = "free") +
    theme_bw() +
    labs(title = paste("Density Plot for", property), x = property, y = "Density") +
    theme(legend.position = "bottom") -> p
  
  print(p)
}

# Conclusion: Overall, the plots suggest that the physicochemical property scores are not normally distributed. There are significant variations among the protein types, with some showing a sharp peak indicating that most proteins have similar physicochemical property scores, while others have a broader distribution.

#The skewness and multiple peaks in some protein types suggest that the underlying biological processes may produce these properties in a non-uniform manner, or there could be subgroups within the types that have different characteristics. These observations suggest caution when applying statistical tests that assume normal distributions, and they also provide insight into the biological variability inherent in these protein types.
```


# Performing Kruskal-Wallis test followed by pairwise comparison using dunn test (if  Kruskal-Wallis test results are found significant)
```{r}
# Performing Kruskal-Wallis test for each property
kruskal_results <- list()
for (property in properties) {
  formula <- as.formula(paste(property, "~ type"))
  kruskal_test <- kruskal.test(formula, data = subsampled_df_combined_random_snippet_R_5PP_JID_correct_scaled)
  kruskal_results[[property]] <- kruskal_test
}

# Print Kruskal-Wallis results
for (property in properties) {
  cat("\nKruskal-Wallis test results for", property, ":\n")
  print(kruskal_results[[property]])
}
```

```{r}
# Performing post-hoc Dunn's test for each property
dunn_results <- list()
for (property in properties) {
  dunn_test <- dunnTest(subsampled_df_combined_random_snippet_R_5PP_JID_correct_scaled[[property]] ~ subsampled_df_combined_random_snippet_R_5PP_JID_correct_scaled$type, method = "bonferroni")
  dunn_results[[property]] <- dunn_test
}

# Print Dunn's test results
for (property in properties) {
  cat("\nDunn's test results for", property, ":\n")
  print(dunn_results[[property]])
}
```

# Script to make Dimensionality reduction plots using random peptide snippets generated for globular, membrane and disrdered proteins in excel following the same length distribution as microproteins from chen et al. paper. All peptides are <= 75 and all canonical complete length proetins are > 100. The canonical protein source is :human globular (SCOPe), membrane protein (mpstruc), human IDPs (DisProt) and human peptides (NCBI). Physiochemcial properties IDs used are (CIDH920105	CHOP780101	CHOP780201	CHOP780202	KLEP840101). PLots inlcude UMAP, t-SNE, histograms, violin plots.

```{r}
# Reading the physiochemical properties dataset of random peptide snippets generated from disordered proteins (mobiDb database) for 8 PP Ids.
# Read the data
Human_Disprot_mobiDB_randExcel_snippets <- fread('/Users/namrataxxx/Desktop/Master_Thesis_material/Thesis_data_script_result/Weismann_Scope_MObiDB_Mpstruc_DimRed_JoostIDs/8physpropIDs_dataset/human_disprot_randomExcel_snippets_mobiDB_8physpropsIDs.txt', header = TRUE, fill = TRUE, sep = "\t")
head(Human_Disprot_mobiDB_randExcel_snippets)
View(Human_Disprot_mobiDB_randExcel_snippets )

# Removing last column
Human_Disprot_mobiDB_randExcel_snippets $V11 <- NULL

# Select only the necessary columns
Human_Disprot_mobiDB_randExcel_snippets  <- Human_Disprot_mobiDB_randExcel_snippets [, .(protein, length, CIDH920105,	CHOP780101,	CHOP780201,	CHOP780202,	KLEP840101,CHAM830105,KARP850103,ONEK900101)]
View(Human_Disprot_mobiDB_randExcel_snippets)

# Add a new column named "type" with all values as "Disordered_proteins"
Human_Disprot_mobiDB_randExcel_snippets$type <- "Disordered_proteins_randomSnippets"
# To place the new column at the second position
Human_Disprot_mobiDB_randExcel_snippets  <- Human_Disprot_mobiDB_randExcel_snippets  %>%
  select(1, type, everything())
#head(Human_Disprot_mobiDB_randExcel_snippets)

# List of physicochemical property columns to normalize
properties <- c("CIDH920105","CHOP780101","CHOP780201",	"CHOP780202",	"KLEP840101", "CHAM830105","KARP850103","ONEK900101")

# Normalize each property by the length
for (property in properties) {
  Human_Disprot_mobiDB_randExcel_snippets[[paste0(property, "_norm")]] <- Human_Disprot_mobiDB_randExcel_snippets[[property]] / Human_Disprot_mobiDB_randExcel_snippets$length
}
tail(Human_Disprot_mobiDB_randExcel_snippets)
View(Human_Disprot_mobiDB_randExcel_snippets)
dim(Human_Disprot_mobiDB_randExcel_snippets) # 76716 x 19

# Specify the columns you want to keep
selected_columns <- c("protein", "type", "length", "CIDH920105_norm", 
                    "CHOP780101_norm", "CHOP780201_norm", "CHOP780202_norm", "KLEP840101_norm","CHAM830105_norm","KARP850103_norm","ONEK900101_norm")

# Select the specified columns
selected_data <- Human_Disprot_mobiDB_randExcel_snippets[, ..selected_columns]

# Now, if the 'selected_data' is your final data.table, you can write it to a text file as follows:
#write.table(selected_data, "normalized_human_disprot_randomExcel_snippets_mobiDB_8physpropsIDs.txt", sep = "\t", row.names = FALSE, quote = FALSE)

```


```{r}
# Reading the physiochemical properties dataset of random peptide snippets generated from membrane proteins (mpStruc database) for 8 PP Ids.
Human_membprot_mobiDB_randExcel_snippets <- fread('/Users/namrataxxx/Desktop/Master_Thesis_material/Thesis_data_script_result/Weismann_Scope_MObiDB_Mpstruc_DimRed_JoostIDs/8physpropIDs_dataset/human_membprot_randomExcel_snippets_mpstruc_8physpropsIDs.txt', header = TRUE, fill = TRUE, sep = "\t")
#head(Human_membprot_mobiDB_randExcel_snippets)
#View(Human_membprot_mobiDB_randExcel_snippets )

# Removing last column
Human_membprot_mobiDB_randExcel_snippets$V11 <- NULL

# Select only the necessary columns
Human_membprot_mobiDB_randExcel_snippets  <- Human_membprot_mobiDB_randExcel_snippets [, .(protein, length, CIDH920105,	CHOP780101,	CHOP780201,	CHOP780202,	KLEP840101,CHAM830105,KARP850103,ONEK900101)]
#View(Human_membprot_mobiDB_randExcel_snippets)

# Add a new column named "type" with all values as "Membrane_proteins"
Human_membprot_mobiDB_randExcel_snippets$type <- "Membrane_proteins_randomSnippets"
# To place the new column at the second position
Human_membprot_mobiDB_randExcel_snippets  <- Human_membprot_mobiDB_randExcel_snippets  %>%
  select(1, type, everything())
#head(Human_membprot_mobiDB_randExcel_snippets)

# List of physicochemical property columns to normalize
properties <- c("CIDH920105","CHOP780101","CHOP780201",	"CHOP780202",	"KLEP840101", "CHAM830105","KARP850103","ONEK900101")

# Normalize each property by the length
for (property in properties) {
  Human_membprot_mobiDB_randExcel_snippets[[paste0(property, "_norm")]] <- Human_membprot_mobiDB_randExcel_snippets[[property]] / Human_membprot_mobiDB_randExcel_snippets$length
}
tail(Human_membprot_mobiDB_randExcel_snippets)
#View(Human_membprot_mobiDB_randExcel_snippets)
dim(Human_membprot_mobiDB_randExcel_snippets) # 1717 x 19

# Specify the columns you want to keep
selected_columns <- c("protein", "type", "length", "CIDH920105_norm", 
                     "CHOP780101_norm", "CHOP780201_norm", "CHOP780202_norm", "KLEP840101_norm","CHAM830105_norm","KARP850103_norm","ONEK900101_norm")

# Select the specified columns
selected_data <- Human_membprot_mobiDB_randExcel_snippets[, ..selected_columns]

# Now, if the 'selected_data' is your final data.table, you can write it to a text file as follows:
#write.table(selected_data, "normalized_human_membprot_randomExcel_snippets_mpStruc_8physpropsIDs.txt", sep = "\t", row.names = FALSE, quote = FALSE)
```

```{r}
# Reading the physiochemical properties dataset of random peptide snippets generated from globular proteins (Scope Astral sequnces (40%) database) for 8 PP Ids.
Human_globprot_ScopeAstral40_randExcel_snippets <- fread('/Users/namrataxxx/Desktop/Master_Thesis_material/Thesis_data_script_result/Weismann_Scope_MObiDB_Mpstruc_DimRed_JoostIDs/8physpropIDs_dataset/human_globprot_randomExcel_snippets_scopeastral40_8physpropIDs.txt', header = TRUE, fill = TRUE, sep = "\t")
#head(Human_globprot_ScopeAstral40_randExcel_snippets)
#View(Human_globprot_ScopeAstral40_randExcel_snippets )

# Removing last column
Human_globprot_ScopeAstral40_randExcel_snippets$V11 <- NULL

# Select only the necessary columns
Human_globprot_ScopeAstral40_randExcel_snippets  <- Human_globprot_ScopeAstral40_randExcel_snippets [, .(protein, length, CIDH920105,	CHOP780101,	CHOP780201,	CHOP780202,	KLEP840101,CHAM830105,KARP850103,ONEK900101)]
#View(Human_globprot_ScopeAstral40_randExcel_snippets)

# Add a new column named "type" with all values as "Globular_proteins"
Human_globprot_ScopeAstral40_randExcel_snippets$type <- "Globular_proteins_randomSnippets"
# To place the new column at the second position
Human_globprot_ScopeAstral40_randExcel_snippets  <- Human_globprot_ScopeAstral40_randExcel_snippets  %>%
  select(1, type, everything())
head(Human_globprot_ScopeAstral40_randExcel_snippets)

# List of physicochemical property columns to normalize
properties <- c("CIDH920105","CHOP780101","CHOP780201",	"CHOP780202",	"KLEP840101", "CHAM830105","KARP850103","ONEK900101")

# Normalize each property by the length
for (property in properties) {
  Human_globprot_ScopeAstral40_randExcel_snippets[[paste0(property, "_norm")]] <- Human_globprot_ScopeAstral40_randExcel_snippets[[property]] / Human_globprot_ScopeAstral40_randExcel_snippets$length
}
tail(Human_globprot_ScopeAstral40_randExcel_snippets)
#View(Human_globprot_ScopeAstral40_randExcel_snippets)
dim(Human_globprot_ScopeAstral40_randExcel_snippets) # 2777 x 19

# Specify the columns you want to keep
selected_columns <- c("protein", "type", "length", "CIDH920105_norm", 
                     "CHOP780101_norm", "CHOP780201_norm", "CHOP780202_norm", "KLEP840101_norm","CHAM830105_norm","KARP850103_norm","ONEK900101_norm")

# Select the specified columns
selected_data <- Human_globprot_ScopeAstral40_randExcel_snippets[, ..selected_columns]

# Now, if the 'selected_data' is your final data.table, you can write it to a text file as follows:
#write.table(selected_data, "normalized_human_globprot_randomExcel_snippets_ScopeAstral40_8physpropsIDs.txt", sep = "\t", row.names = FALSE, quote = FALSE)
```

```{r}
### Dataset with new NCBI peptide seq combined with normalized uprot, and random peptide snippets of canonical proteins generated in excel fro 8 PP IDs.
# Reading normalized data and prepapring for UMAP analysis

normalized_human_uprot_weismann_8physpropsids <- read.table("/Users/namrataxxx/Desktop/Master_Thesis_material/Thesis_data_script_result/Weismann_Scope_MObiDB_Mpstruc_DimRed_JoostIDs/8physpropIDs_dataset/normalized_human_uprot_weismann_8physpropsids.txt", header=TRUE, sep="\t")
dim(normalized_human_uprot_weismann_8physpropsids) # 10694  x  11
#View(normalized_human_uprot_weismann_8physpropsids)

normalized_human_disprot_randomExcel_snippets_mobiDB_8physpropsIDs <- fread("/Users/namrataxxx/Desktop/Master_Thesis_material/Thesis_data_script_result/Weismann_Scope_MObiDB_Mpstruc_DimRed_JoostIDs/8physpropIDs_dataset/normalized_human_disprot_randomExcel_snippets_mobiDB_8physpropsIDs.txt", header = TRUE, fill = TRUE, sep = "\t")
dim(normalized_human_disprot_randomExcel_snippets_mobiDB_8physpropsIDs) # 76716 x  11

normalized_human_membprot_randomExcel_snippets_mpStruc_8physpropsIDs <- read.table("/Users/namrataxxx/Desktop/Master_Thesis_material/Thesis_data_script_result/Weismann_Scope_MObiDB_Mpstruc_DimRed_JoostIDs/8physpropIDs_dataset/normalized_human_membprot_randomExcel_snippets_mpStruc_8physpropsIDs.txt", header=TRUE, sep="\t")
dim(normalized_human_membprot_randomExcel_snippets_mpStruc_8physpropsIDs) # 1717 x 11
#View(normalized_human_membprot_randomExcel_snippets_mpStruc_8physpropsIDs)

normalized_human_globprot_randomExcel_snippets_ScopeAstral40_8physpropsIDs <- read.table("/Users/namrataxxx/Desktop/Master_Thesis_material/Thesis_data_script_result/Weismann_Scope_MObiDB_Mpstruc_DimRed_JoostIDs/8physpropIDs_dataset/normalized_human_globprot_randomExcel_snippets_ScopeAstral40_8physpropsIDs.txt", header=TRUE, sep="\t")
dim(normalized_human_globprot_randomExcel_snippets_ScopeAstral40_8physpropsIDs) # 2777 x  11

normalized_human_peptideSeq_NCBI_new_8physphrosids <- read.table("/Users/namrataxxx/Desktop/Master_Thesis_material/Thesis_data_script_result/Weismann_Scope_MObiDB_Mpstruc_DimRed_JoostIDs/8physpropIDs_dataset/normalized_human_peptideSeq_NCBI_new_8physphrosids.txt", header=TRUE, sep="\t")
dim(normalized_human_peptideSeq_NCBI_new_8physphrosids) # 2212 x  11

# Filtering peptides pnly <=75 aa
normalized_human_peptideSeq_NCBI_new_8physphrosids_smallerORequal75 <- normalized_human_peptideSeq_NCBI_new_8physphrosids %>% filter(length <= 75)
dim(normalized_human_peptideSeq_NCBI_new_8physphrosids_smallerORequal75) # 1381 x 11
#View(normalized_human_peptideSeq_NCBI_new_8physphrosids_smallerORequal75)

normalized_human_uprot_weismann_8physpropsids_5000 <- normalized_human_uprot_weismann_8physpropsids[sample(nrow(normalized_human_uprot_weismann_8physpropsids), 5000),]  #subsampling to reduce microprot set size 
dim(normalized_human_uprot_weismann_8physpropsids_5000) # 5000 x  11
#head(normalized_human_uprot_weismann_8physpropsids_5000)

normalized_human_disprot_randomExcel_snippets_mobiDB_8physpropsIDs_5000 <- normalized_human_disprot_randomExcel_snippets_mobiDB_8physpropsIDs[sample(nrow(normalized_human_disprot_randomExcel_snippets_mobiDB_8physpropsIDs), 5000),] #subsampling to reduce IDP prot set size
dim(normalized_human_disprot_randomExcel_snippets_mobiDB_8physpropsIDs_5000) # 5000 x  11

new_micros_tt_8_control1 <- rbind(normalized_human_uprot_weismann_8physpropsids_5000,normalized_human_disprot_randomExcel_snippets_mobiDB_8physpropsIDs_5000)
#head(new_micros_tt_8_control2)
new_micros_ttt_8_control1 <- rbind(new_micros_tt_8_control1, normalized_human_membprot_randomExcel_snippets_mpStruc_8physpropsIDs)
new_micros_tttt_8_control1 <- rbind(new_micros_ttt_8_control1,normalized_human_peptideSeq_NCBI_new_8physphrosids_smallerORequal75)
combined_protein_dataset_8_Peptide_NCBI_new_control1 <- rbind(new_micros_tttt_8_control1,normalized_human_globprot_randomExcel_snippets_ScopeAstral40_8physpropsIDs)
dim(combined_protein_dataset_8_Peptide_NCBI_new_control1) # 15875  x  11
head(combined_protein_dataset_8_Peptide_NCBI_new_control1)
#View(combined_protein_dataset_8_Peptide_NCBI_new_control1)
sum(is.na(combined_protein_dataset_8_Peptide_NCBI_new_control1))
combined_protein_dataset_8_Peptide_NCBI_new_control1 <- na.omit(combined_protein_dataset_8_Peptide_NCBI_new_control1)

# Correcting the script to update 'type' column with new names
combined_protein_dataset_8_Peptide_NCBI_new_control1 <- combined_protein_dataset_8_Peptide_NCBI_new_control1 %>%
  mutate(type = case_when(
    type == "micro" ~ "Microprotein",
    type == "Disordered_proteins_randomSnippets" ~ "Disordered protein random snippets_excel",
    type == "Globular_proteins_randomSnippets" ~ "Globular protein random snippets_excel",
    type == "Membrane_proteins_randomSnippets" ~ "Membrane protein random snippets_excel",
    type == "peptide" ~ "Peptide",
    TRUE ~ type  # Preserves original type if none of the conditions above are met
  ))

combined_protein_dataset_8_Peptide_NCBI_new_control1 <- combined_protein_dataset_8_Peptide_NCBI_new_control1[c(1:8)]
```

```{r}
# Prepare the data for UMAP, selecting only the columns with the physical property values
umap_data_8pp_Peptide_NCBI_new_control1 <- combined_protein_dataset_8_Peptide_NCBI_new_control1[, c("CIDH920105_norm","CHOP780101_norm","CHOP780201_norm","CHOP780202_norm","KLEP840101_norm")]
head(umap_data_8pp_Peptide_NCBI_new_control1)
# Run UMAP
set.seed(7) # Set a random seed for reproducibility
umap_result_8pp_Peptide_NCBI_new_control1 <- umap(umap_data_8pp_Peptide_NCBI_new_control1)

# Create a data frame for plotting that includes the UMAP dimensions and the protein type
plot_data_8pp_Peptide_NCBI_new_control1 <- data.frame(UMAP1 = umap_result_8pp_Peptide_NCBI_new_control1$layout[,1], UMAP2 = umap_result_8pp_Peptide_NCBI_new_control1$layout[,2], Type = combined_protein_dataset_8_Peptide_NCBI_new_control1$type)
# Define custom colors for the plot

my_colors <- c("Disordered protein random snippets_excel" = "#800080","Globular protein random snippets_excel" = "#98FB98","Membrane protein random snippets_excel" = "cyan","Microprotein" ="yellow","Peptide" = "pink")

# Plot using ggplot2
p8_pp_Peptide_NCBI_new_control1 <- ggplot(plot_data_8pp_Peptide_NCBI_new_control1, aes(x = UMAP1, y = UMAP2, color = Type)) +
  geom_point(size=0.75, alpha=0.75) + # Adjust point transparency with the alpha parameter
  scale_color_manual(values = my_colors) + # Use the custom colors
  labs(title = "UMAP Visualization of Human Protein Clusters_Weismann_mobiDB_Scope_mpstruc_NCBI(new)_random_snippets(canonical_prots)_scaled_5PP_IDs",
       x = "UMAP Dimension 1",
       y = "UMAP Dimension 2",
       color = "Protein Type") +
  theme_minimal()
p8_pp_Peptide_NCBI_new_control1
```


```{r}
# Perform t-SNE
set.seed(49) # Set a random seed for reproducibility
tsne_result_8_with_peptide_NCBI_new_control1 <- Rtsne(dist(umap_data_8pp_Peptide_NCBI_new_control1), dims = 2, perplexity = 15, theta = 0.0, max_iter= 1000, verbose = FALSE )

# Create a data frame for plotting that includes the t-SNE dimensions and the protein type
tsne_data_8_with_peptide_NCBI_new_control1 <- data.frame(TSNE1 = tsne_result_8_with_peptide_NCBI_new_control1$Y[,1], TSNE2 = tsne_result_8_with_peptide_NCBI_new_control1$Y[,2], Type = combined_protein_dataset_8_Peptide_NCBI_new_control1$type)

# Define custom colors for the plot
my_colors <- c("Disordered protein random snippets_excel" = "#800080","Globular protein random snippets_excel" = "#98FB98","Membrane protein random snippets_excel" = "cyan","Microprotein" ="yellow","Peptide" = "pink")

# Plot using ggplot2
p8_pp_tSNE_peptide_NCBI_new_control1 <- ggplot(tsne_data_8_with_peptide_NCBI_new_control1, aes(x = TSNE1, y = TSNE2, color = Type)) +
   geom_point(size=0.75, alpha=0.75) + # Adjust point transparency with the alpha parameter
  scale_color_manual(values = my_colors) + # Use the custom colors
  labs(title = "t-SNE Visualization of Human Protein Clusters_Weismann_mobiDB_Scope_mpstruc_NCBI_random_snippets(canonical_prots)5PP_IDs",
       x = "t-SNE Dimension 1",
       y = "t-SNE Dimension 2",
       color = "Protein Type") +
  theme_minimal()
p8_pp_tSNE_peptide_NCBI_new_control1
```

```{r}
# Filter data for each protein type to make plot for length distribution
micro_proteins_control1 <- combined_protein_dataset_8_Peptide_NCBI_new_control1[combined_protein_dataset_8_Peptide_NCBI_new_control1$type == 'Microprotein', ]
disprot_proteins_control1 <- combined_protein_dataset_8_Peptide_NCBI_new_control1[combined_protein_dataset_8_Peptide_NCBI_new_control1$type == 'Disordered protein random snippets_excel', ]
membrane_proteins_control1 <- combined_protein_dataset_8_Peptide_NCBI_new_control1[combined_protein_dataset_8_Peptide_NCBI_new_control1$type == 'Membrane protein random snippets_excel', ]
globular_proteins_control1 <- combined_protein_dataset_8_Peptide_NCBI_new_control1[combined_protein_dataset_8_Peptide_NCBI_new_control1$type == 'Globular protein random snippets_excel', ]
peptides_control1 <- combined_protein_dataset_8_Peptide_NCBI_new_control1[combined_protein_dataset_8_Peptide_NCBI_new_control1$type == 'Peptide', ]

# Function to plot length distribution for a given protein type
plot_length_distribution <- function(protein_data, protein_type) {
  ggplot(protein_data, aes(x=length)) +
    geom_histogram(bins = 30, fill = 'light green', color = 'black') +
    labs(title = paste('Length Distribution of', protein_type),
         x = 'Length',
         y = 'Frequency') +
    theme_minimal()
}
```

```{r}
# Plotting length distribution for microproteins
plotMicro_control1 <- plot_length_distribution(micro_proteins_control1, 'Microproteins')
print(plotMicro_control1)
```


```{r}
# Plotting length distribution for disordered proteins
plotDisprot_control1 <- plot_length_distribution(disprot_proteins_control1, 'Disordered_protein_random_snippets_Excel_Disprot')
print(plotDisprot_control1)
```

```{r}
# Plotting length distribution for globular proteins
plotGlobprot_control1 <- plot_length_distribution(globular_proteins_control1, 'Globular_protein_random_snippets_Excel_Scope')
print(plotGlobprot_control1)
```

```{r}
# Plotting length distribution for membrane proteins
plotMembprot_control1 <- plot_length_distribution(membrane_proteins_control1, 'Membrane_protein_random_snippets_Excel_mpStruc')
print(plotMembprot_control1)
```

```{r}
# Plotting length distribution for globular proteins
plotPeptide_control1 <- plot_length_distribution(peptides_control1, 'Peptides')
print(plotPeptide_control1)
```


# Script for dimensionality reduction on dataset of human microproteins taken from weismman paper,human Globular protein from SCOPE (Astral with less than 40% identity) and human membrane protein from mpStruc and human IDPs from Disprot, human peptides from NCBI(new) and physiochemcial properties of all 545 IDs. Then a t-SNE plot is made using the first few PCs that explain the maximum variance. PLots also include scree plot, loading plot.

```{r}
# Human Microprotein dataset (Weismann_paper) physical property score (545 IDs).
# Read the data
Human_uprot_weismann_AllPPs <- fread('/Users/namrataxxx/Desktop/Master_Thesis_material/Thesis_data_script_result/Weismann_Scope_MObiDB_Mpstruc_DimRed_JoostIDs/545physpropIDS/human_uprot_weismann_545physpropsIDs.txt', header = TRUE, fill = TRUE, sep = "\t")
#head(Human_uprot_weismann_AllPPs)
View(Human_uprot_weismann_AllPPs)
dim(Human_uprot_weismann_AllPPs) # 10694 x 548

# Removing last column
Human_uprot_weismann_AllPPs$V548 <- NULL

# Select only the necessary columns
Human_uprot_weismann_AllPPs <- Human_uprot_weismann_AllPPs[, c(1, 2, 3:547)]
#View(Human_uprot_weismann_AllPPs)

# Add a new column named "type" with all values as "disprot"
Human_uprot_weismann_AllPPs$type <- "Microprotein"
# To place the new column at the second position
Human_uprot_weismann_AllPPs <- Human_uprot_weismann_AllPPs %>%
  select(1, type, everything())
head(Human_uprot_weismann_AllPPs)
dim(Human_uprot_weismann_AllPPs) 

# List of physicochemical property columns to normalize
properties <- colnames(Human_uprot_weismann_AllPPs)[4:548]

# Normalize each property by the length
for (property in properties) {
  Human_uprot_weismann_AllPPs[[paste0(property, "_norm")]] <- Human_uprot_weismann_AllPPs[[property]] / Human_uprot_weismann_AllPPs$length
}
View(Human_uprot_weismann_AllPPs)
dim(Human_uprot_weismann_AllPPs) # 69642 x 1093

# Specify the columns you want to keep
selected_columns <- Human_uprot_weismann_AllPPs[, c(1:3, 549:1093)]

# Now, if the 'selected_data' is your final data.table, you can write it to a text file as follows:
write.table(selected_columns, "normalized_Human_uprot_weismann_AllPPs.txt", sep = "\t", row.names = FALSE, quote = FALSE)

```

```{r}
# Human IDP dataset (Disprot) physical property score (545 IDs).
# Read the data
Human_IDP_Disprot_AllPPs <- fread('/Users/namrataxxx/Desktop/Master_Thesis_material/Thesis_data_script_result/Weismann_Scope_MObiDB_Mpstruc_DimRed_JoostIDs/545physpropIDS/human_IDP_Disprot_545physpropIDs.txt', header = TRUE, fill = TRUE, sep = "\t")
#head(Human_IDP_Disprot_AllPPs)
View(Human_IDP_Disprot_AllPPs)
dim(Human_IDP_Disprot_AllPPs) # 4587 x 548

# Removing last column
Human_IDP_Disprot_AllPPs$V548 <- NULL

# Select only the necessary columns
Human_IDP_Disprot_AllPPs <- Human_IDP_Disprot_AllPPs[, c(1, 2, 3:547)]
#View(Human_IDP_Disprot_AllPPs)

# Add a new column named "type" with all values as "disprot"
Human_IDP_Disprot_AllPPs$type <- "Disordered protein"
# To place the new column at the second position
Human_IDP_Disprot_AllPPs <- Human_IDP_Disprot_AllPPs %>%
  select(1, type, everything())
#head(Human_IDP_Disprot_AllPPs)

# List of physicochemical property columns to normalize
properties <- colnames(Human_IDP_Disprot_AllPPs)[4:548]

# Normalize each property by the length
for (property in properties) {
  Human_IDP_Disprot_AllPPs[[paste0(property, "_norm")]] <- Human_IDP_Disprot_AllPPs[[property]] / Human_IDP_Disprot_AllPPs$length
}
#View(Human_IDP_Disprot_AllPPs)
dim(Human_IDP_Disprot_AllPPs) # 4587 x 1093

# Specify the columns you want to keep
selected_columns <- Human_IDP_Disprot_AllPPs[, c(1:3, 549:1093)]

# Now, if the 'selected_data' is your final data.table, you can write it to a text file as follows:
write.table(selected_columns, "normalized_Human_IDP_Disprot_AllPPs.txt", sep = "\t", row.names = FALSE, quote = FALSE)

```


```{r}
# Human membrane protein dataset (mpStruc) physical property score (545 IDs).
# Read the data
Human_membraneProt_mpStruc_AllPPs <- fread('/Users/namrataxxx/Desktop/Master_Thesis_material/Thesis_data_script_result/Weismann_Scope_MObiDB_Mpstruc_DimRed_JoostIDs/545physpropIDS/human_membProt_mpStruc_545physpropIDs.txt', header = TRUE, fill = TRUE, sep = "\t")
#head(Human_membraneProt_mpStruc_AllPPs)
View(Human_membraneProt_mpStruc_AllPPs)
dim(Human_membraneProt_mpStruc_AllPPs) # 1705 x 548

# Removing last column
Human_membraneProt_mpStruc_AllPPs$V548 <- NULL

# Select only the necessary columns
Human_membraneProt_mpStruc_AllPPs <- Human_membraneProt_mpStruc_AllPPs[, c(1, 2, 3:547)]
#View(Human_membraneProt_mpStruc_AllPPs)

# Add a new column named "type" with all values as "disprot"
Human_membraneProt_mpStruc_AllPPs$type <- "Membrane protein"
# To place the new column at the second position
Human_membraneProt_mpStruc_AllPPs <- Human_membraneProt_mpStruc_AllPPs %>%
  select(1, type, everything())
head(Human_membraneProt_mpStruc_AllPPs)

# List of physicochemical property columns to normalize
properties <- colnames(Human_membraneProt_mpStruc_AllPPs)[4:548]

# Normalize each property by the length
for (property in properties) {
  Human_membraneProt_mpStruc_AllPPs[[paste0(property, "_norm")]] <- Human_membraneProt_mpStruc_AllPPs[[property]] / Human_membraneProt_mpStruc_AllPPs$length
}
#View(Human_membraneProt_mpStruc_AllPPs)
dim(Human_membraneProt_mpStruc_AllPPs) # 1705 x 1093

# Specify the columns you want to keep
selected_columns <- Human_membraneProt_mpStruc_AllPPs[, c(1:3, 549:1093)]

# Now, if the 'selected_data' is your final data.table, you can write it to a text file as follows:
write.table(selected_columns, "normalized_Human_membraneProt_mpStruc_AllPPs.txt", sep = "\t", row.names = FALSE, quote = FALSE)

```

```{r}
# Human globular protein dataset (Scope 40) physical property score (545 IDs).

# Read the data
Human_globProt_Scope40_AllPPs <- fread('/Users/namrataxxx/Desktop/Master_Thesis_material/Thesis_data_script_result/Weismann_Scope_MObiDB_Mpstruc_DimRed_JoostIDs/545physpropIDS/human_globProt_Scope40_545physpropIDs.txt', header = TRUE, fill = TRUE, sep = "\t")
#head(Human_globProt_Scope40_AllPPs)
View(Human_globProt_Scope40_AllPPs)
dim(Human_globProt_Scope40_AllPPs) # 2741 x 548

# Removing last column
Human_globProt_Scope40_AllPPs$V548 <- NULL

# Select only the necessary columns
Human_globProt_Scope40_AllPPs <- Human_globProt_Scope40_AllPPs[, c(1, 2, 3:547)]
#View(Human_globProt_Scope40_AllPPs)

# Add a new column named "type" with all values as "disprot"
Human_globProt_Scope40_AllPPs$type <- "Globular protein"
# To place the new column at the second position
Human_globProt_Scope40_AllPPs <- Human_globProt_Scope40_AllPPs %>%
  select(1, type, everything())
#head(Human_globProt_Scope40_AllPPs)

# List of physicochemical property columns to normalize
properties <- colnames(Human_globProt_Scope40_AllPPs)[4:548]

# Normalize each property by the length
for (property in properties) {
  Human_globProt_Scope40_AllPPs[[paste0(property, "_norm")]] <- Human_globProt_Scope40_AllPPs[[property]] / Human_globProt_Scope40_AllPPs$length
}
#View(Human_globProt_Scope40_AllPPs)
dim(Human_globProt_Scope40_AllPPs) # 2741 x 1093

# Specify the columns you want to keep
selected_columns <- Human_globProt_Scope40_AllPPs[, c(1:3, 549:1093)]


# Now, if the 'selected_data' is your final data.table, you can write it to a text file as follows:
write.table(selected_columns, "normalized_Human_globProt_Scope40_AllPPs.txt", sep = "\t", row.names = FALSE, quote = FALSE)

```

```{r}
# Human peptide dataset (NCBI_new) physical property score (545 IDs).

# Read the data
Human_peptide_NCBI_new_AllPPs <- fread('/Users/namrataxxx/Desktop/Master_Thesis_material/Thesis_data_script_result/Weismann_Scope_MObiDB_Mpstruc_DimRed_JoostIDs/545physpropIDS/human_peptide_NCBI_new_545physpropIDs.txt', header = TRUE, fill = TRUE, sep = "\t")
#head(Human_peptide_NCBI_new_AllPPs)
View(Human_peptide_NCBI_new_AllPPs)
dim(Human_peptide_NCBI_new_AllPPs) # 2212 x 548

# Removing last column
Human_peptide_NCBI_new_AllPPs$V548 <- NULL

# Select only the necessary columns
Human_peptide_NCBI_new_AllPPs <- Human_peptide_NCBI_new_AllPPs[, c(1, 2, 3:547)]
#View(Human_peptide_NCBI_new_AllPPs)

# Add a new column named "type" with all values as "disprot"
Human_peptide_NCBI_new_AllPPs$type <- "Peptide"
# To place the new column at the second position
Human_peptide_NCBI_new_AllPPs <- Human_peptide_NCBI_new_AllPPs %>%
  select(1, type, everything())
head(Human_peptide_NCBI_new_AllPPs)

# List of physicochemical property columns to normalize
properties <- colnames(Human_peptide_NCBI_new_AllPPs)[4:548]

# Normalize each property by the length
for (property in properties) {
  Human_peptide_NCBI_new_AllPPs[[paste0(property, "_norm")]] <- Human_peptide_NCBI_new_AllPPs[[property]] / Human_peptide_NCBI_new_AllPPs$length
}
#View(Human_peptide_NCBI_new_AllPPs)
dim(Human_peptide_NCBI_new_AllPPs) # 2212 x 1093

# Specify the columns you want to keep
selected_columns <- Human_peptide_NCBI_new_AllPPs[, c(1:3, 549:1093)]

# Now, if the 'selected_data' is your final data.table, you can write it to a text file as follows:
write.table(selected_columns, "normalized_Human_peptide_NCBI_new_AllPPs.txt", sep = "\t", row.names = FALSE, quote = FALSE)

```


```{r}
# Now I am going to make a dataset of uprot (weismann), IDP (disprot), globular prot (scope), membrane prot (mpstruc) and peptides from NCBI. All the standard proteins are above 100 aa. All the physical property (545 IDs) scores are normalized.

# Reading normalized data and prepapring for UMAP analysis
normalized_Human_uprot_weismann_AllPPs <- read.table("/Users/namrataxxx/Desktop/Master_Thesis_material/Thesis_data_script_result/Weismann_Scope_MObiDB_Mpstruc_DimRed_JoostIDs/545physpropIDS/normalized_Human_uprot_weismann_AllPPs.txt", header=TRUE, sep="\t")
dim(normalized_Human_uprot_weismann_AllPPs) # 10694  x  548
#View(normalized_Human_uprot_weismann_AllPPs)

normalized_Human_membraneProt_mpStruc_AllPPs <- read.table("/Users/namrataxxx/Desktop/Master_Thesis_material/Thesis_data_script_result/Weismann_Scope_MObiDB_Mpstruc_DimRed_JoostIDs/545physpropIDS/normalized_Human_membraneProt_mpStruc_AllPPs.txt", header=TRUE, sep="\t")
dim(normalized_Human_membraneProt_mpStruc_AllPPs) # 1705 x 548
#View(normalized_Human_membraneProt_mpStruc_AllPPs)

# Filter for membrane proteins larger than 100 amino acids
normalized_Human_membraneProt_mpStruc_AllPPs_longerthan100 <- normalized_Human_membraneProt_mpStruc_AllPPs %>% filter(length > 100)
dim(normalized_Human_membraneProt_mpStruc_AllPPs_longerthan100) # 1428 x 548
#View(normalized_Human_membraneProt_mpStruc_AllPPs_longerthan100)

normalized_Human_globProt_Scope40_AllPPs <- read.table("/Users/namrataxxx/Desktop/Master_Thesis_material/Thesis_data_script_result/Weismann_Scope_MObiDB_Mpstruc_DimRed_JoostIDs/545physpropIDS/normalized_Human_globProt_Scope40_AllPPs.txt", header=TRUE, sep="\t")
dim(normalized_Human_globProt_Scope40_AllPPs) # 2741 x  548

# Filter for globular proteins larger than 100 amino acids
normalized_Human_globProt_Scope40_AllPPs_longerthan100 <- normalized_Human_globProt_Scope40_AllPPs %>% filter(length > 100)
dim(normalized_Human_globProt_Scope40_AllPPs_longerthan100) # 1718 x 548
#View(normalized_Human_globProt_Scope40_AllPPs_longerthan100)

normalized_Human_IDP_Disprot_AllPPs <- fread("/Users/namrataxxx/Desktop/Master_Thesis_material/Thesis_data_script_result/Weismann_Scope_MObiDB_Mpstruc_DimRed_JoostIDs/545physpropIDS/normalized_Human_IDP_Disprot_AllPPs.txt", header = TRUE, fill = TRUE, sep = "\t")
dim(normalized_Human_IDP_Disprot_AllPPs) # 4587 x  548

# Filter for disordered proteins larger than 100 amino acids
normalized_Human_IDP_Disprot_AllPPs_longerthan100 <- normalized_Human_IDP_Disprot_AllPPs %>% filter(length > 100)
dim(normalized_Human_IDP_Disprot_AllPPs_longerthan100) # 1069 x 548
#View(normalized_Human_IDP_Disprot_AllPPs_longerthan100) 

normalized_Human_peptide_NCBI_new_AllPPs <- read.table("/Users/namrataxxx/Desktop/Master_Thesis_material/Thesis_data_script_result/Weismann_Scope_MObiDB_Mpstruc_DimRed_JoostIDs/545physpropIDS/normalized_Human_peptide_NCBI_new_AllPPs.txt", header=TRUE, sep="\t")
dim(normalized_Human_peptide_NCBI_new_AllPPs) # 2212 x  548

# Filtering peptides only below 75 aa
normalized_human_peptideSeq_NCBI_new_AllPPs_smallerORequal75 <- normalized_Human_peptide_NCBI_new_AllPPs %>% filter(length <= 75)
dim(normalized_human_peptideSeq_NCBI_new_AllPPs_smallerORequal75) # 1381 x 548
#View(normalized_human_peptideSeq_NCBI_new_AllPPs_smallerORequal75)

normalized_Human_uprot_weismann_AllPPs_5000 <- normalized_Human_uprot_weismann_AllPPs[sample(nrow(normalized_Human_uprot_weismann_AllPPs), 5000),]  #subsampling to reduce microprot set size 
dim(normalized_Human_uprot_weismann_AllPPs_5000) # 5000 x  548
#head(normalized_Human_uprot_weismann_AllPPs_5000)


control5_AllPP_t <- rbind(normalized_Human_uprot_weismann_AllPPs_5000,normalized_Human_membraneProt_mpStruc_AllPPs_longerthan100)
control5_AllPP_tt <- rbind(control5_AllPP_t,normalized_Human_globProt_Scope40_AllPPs_longerthan100)
control5_AllPP_ttt <- rbind(control5_AllPP_tt,normalized_human_peptideSeq_NCBI_new_AllPPs_smallerORequal75)
head(control5_AllPP_ttt)
# Adding IDP data from disprot
combined_control5_AllPPs <- rbind(control5_AllPP_ttt,normalized_Human_IDP_Disprot_AllPPs_longerthan100)
dim(combined_control5_AllPPs) # 10596 x 548
head(combined_control5_AllPPs)
View(combined_control5_AllPPs)
sum(is.na(combined_control5_AllPPs))
combined_control5_AllPPs <- na.omit(combined_control5_AllPPs)
```


```{r}
# PCA analysis to find which PCs to select 
# Select only the columns relevant for PCA
properties_combined_control5_AllPPs <- combined_control5_AllPPs[, c(4:548)]
head(properties_combined_control5_AllPPs)

# Standardize the properties_combined_disport_control2_5PP_J
properties_combined_control5_AllPPs_scaled <- scale(properties_combined_control5_AllPPs)
head(properties_combined_control5_AllPPs_scaled)

# Perform PCA
pca_result_combined_control5_AllPPs <- prcomp(properties_combined_control5_AllPPs_scaled, center = TRUE, scale. = TRUE)

# Summarize the PCA result
summary_pca <- summary(pca_result_combined_control5_AllPPs)

# Extract the proportion of variance explained
explained_variance_summary <- summary_pca$importance[2, 1:6]

# Print the proportion of variance explained by the first 6 PCs
explained_variance_summary

# Extract the cumulative proportion of variance explained
cumulative_explained_variance_summary <- summary_pca$importance[3, 1:6]

# Print the cumulative proportion of variance explained by the first 6 PCs
cumulative_explained_variance_summary
```

```{r}
# Calculate the variance explained by each principal component
var_explained <- pca_result_combined_control5_AllPPs$sdev^2
var_explained <- var_explained / sum(var_explained)

# Create a scree plot
plot(var_explained, xlab = "Principal Component",
     ylab = "Proportion of Variance Explained",
     type = "b", pch = 19, frame = FALSE,
     main = "Scree Plot")

```
```{r}
# Calculate the variance explained by each principal component
var_explained <- pca_result_combined_control5_AllPPs$sdev^2
var_explained <- var_explained / sum(var_explained)

# Create a scree plot
plot(var_explained, xlab = "Principal Component", 
     ylab = "Proportion of Variance Explained", 
     type = "b", pch = 19, frame = FALSE, 
     main = "Scree Plot")

# Add a cumulative line
cum_var <- cumsum(var_explained)
# The error occurs here, to fix this, make sure that plot has been successfully created.
lines(cum_var, col = "red", lty = 2)

# Add a cutoff line at 0.01 (1%) to visualize the components explaining at least 1% of the variance
abline(h = 0.01, col = "blue", lty = 3)

# Annotate the cutoff line
legend("topright", legend = c("Cumulative", "1% Cutoff"), 
       col = c("red", "blue"), lty = c(2, 3), cex = 0.8)
```
```{r}
# Zooming in near the cut off line
# Create a scree plot with adjusted x-axis limits to zoom in on the first 50 PCs
plot(var_explained[1:15], xlab = "Principal Component", 
     ylab = "Proportion of Variance Explained", 
     type = "b", pch = 19, frame = FALSE, 
     main = "Scree Plot - Zoomed In")

# Add a cumulative line
cum_var <- cumsum(var_explained)
lines(cum_var[1:15], col = "red", lty = 2)

# Add a cutoff line at 0.01 (1%) to visualize the components explaining at least 1% of the variance
abline(h = 0.01, col = "blue", lty = 3)

# Annotate the cutoff line
legend("topright", legend = c("Cumulative", "1% Cutoff"), 
       col = c("red", "blue"), lty = c(2, 3), cex = 0.8)
```

```{r}
# Calculate loadings_combined_control5_AllPPs for the PCA result
loadings_combined_control5_AllPPs <- pca_result_combined_control5_AllPPs$rotation

# Loadings for PC1 and PC2
pc1_loadings_combined_control5_AllPPs <- loadings_combined_control5_AllPPs[, "PC1"]
pc2_loadings_combined_control5_AllPPs <- loadings_combined_control5_AllPPs[, "PC2"]
pc3_loadings_combined_control5_AllPPs <- loadings_combined_control5_AllPPs[, "PC3"]
pc4_loadings_combined_control5_AllPPs <- loadings_combined_control5_AllPPs[, "PC4"]
pc5_loadings_combined_control5_AllPPs <- loadings_combined_control5_AllPPs[, "PC5"]
pc5_loadings_combined_control5_AllPPs <- loadings_combined_control5_AllPPs[, "PC6"]

# Print the loadings_combined_control5_AllPPs for PC1 and PC2
print("Loadings for PC1:")
print(pc1_loadings_combined_control5_AllPPs)
print("Loadings for PC2:")
print(pc2_loadings_combined_control5_AllPPs)
print("Loadings for PC3:")
print(pc3_loadings_combined_control5_AllPPs)

# To view the loadings_combined_control5_AllPPs in a more readable format as a dataframe:
loadings_df_combined_control5_AllPPs <- as.data.frame(loadings_combined_control5_AllPPs[, 1:6])
print(loadings_df_combined_control5_AllPPs)
loadings_df_combined_control5_AllPPs
```

```{r}
# Convert the loadings to a long format dataframe for plotting
loadings_long_combined_control5_AllPPs <- loadings_combined_control5_AllPPs[, 1:6] %>%
  as.data.frame() %>%
  rownames_to_column(var = "Property") %>%
  pivot_longer(cols = -Property, names_to = "PC", values_to = "Loading")

# Create the bar plot for PCA loadings_combined_control5_AllPPs
ggplot(loadings_long_combined_control5_AllPPs, aes(x = Property, y = Loading, fill = PC)) +
  geom_bar(stat = "identity", position = position_dodge(), width = 0.7) +
  theme_minimal() +
  labs(x = "Property", y = "Loading", title = "PCA Loadings for PC1,PC2,PC3,PC4,PC5 and PC6") +
  coord_flip() 


# In PCA, both strong positive and strong negative loadings indicate that a property is important in defining the principal component.Large absolute values (either positive or negative) indicate variables that have a strong influence on the component. Loadings close to 0 suggest that the variable has little to no influence on the component.

# Try to make a plot of top ten properties with highest contribution in the PCA loading.
```

```{r}
# t-SNE on Principal components:

# First, extract the first three principal components from the PCA results
pca_scores_combined_control5_AllPPs <- pca_result_combined_control5_AllPPs$x[, 1:6]
head(pca_scores_combined_control5_AllPPs)

# Perform t-SNE on the first three PCs
set.seed(48) # Set a random seed for reproducibility
tsne_result_pca_combined_control5_AllPPs <- Rtsne(dist(pca_scores_combined_control5_AllPPs), dims = 2, perplexity = 15, theta = 0.0, max_iter= 1000, verbose = FALSE )

# Assuming 'combined_disport_control2_5PP_J' includes a column 'type' for protein types
tsne_data_pca_combined_control5_AllPPs <- data.frame(TSNE1 = tsne_result_pca_combined_control5_AllPPs$Y[,1], TSNE2 = tsne_result_pca_combined_control5_AllPPs$Y[,2], Type = combined_control5_AllPPs$type)

my_colors_combined_control5_AllPPs <- c("Disordered protein" = "red", "Globular protein" = "green", "Membrane protein" = "blue", "Microprotein" = "yellow", "Peptide" = "pink")

# Plot using ggplot2
p_tsne_pca_combined_control5_AllPPs <- ggplot(tsne_data_pca_combined_control5_AllPPs, aes(x = TSNE1, y = TSNE2, color = Type)) +
  geom_point(size=0.65, alpha=0.75) +
  scale_color_manual(values = my_colors_combined_control5_AllPPs) + # Use the custom colors
  labs(title = "t-SNE Visualization of Protein Clusters (Weismann_Disprot_Scope_mpStruc_NCBI_DB) based on PCA (All_PP_IDs)",
       x = "t-SNE Dimension 1",
       y = "t-SNE Dimension 2",
       color = "Protein Type") +
  theme_minimal()

# Print the plot
p_tsne_pca_combined_control5_AllPPs
```

# Script for dimensionality reduction on dataset of human microproteins taken from weismman paper,human Globular protein from SCOPE (Astral with less than 40% identity), human membrane protein from mpStruc, human IDPs from Disprot and human peptide sequence (new) from NCBI and prediction scores from GRAVY, DeepTMHMM, IUpred2A etc.
#All canonical proteins are above 100 aa and peptides are <= 75 (z_normalized and min_max_normalized).

```{r}
# These datasets for microprot (Weismann paper) contains prediction scores for GRAVY, DeepTMHMM, IUPred2A
# Microprotein dataset
Human_uprot_weismann_TMHMM <- read.table("/Users/namrataxxx/Desktop/Master_Thesis_material/Thesis_data_script_result/Weismann_Scope_MObiDB_Mpstruc_DimRed_JoostIDs/Tools_Prediction_score_data/TMHMM_Scores/human_uprot_Weismann_TMHMMScore_final.txt", header=TRUE, sep="\t")
View(Human_uprot_weismann_TMHMM)
dim(Human_uprot_weismann_TMHMM) # 9768 x 3

# Read the first table with GRAVY scores
Human_uprot_weismann_GRAVY <- read.delim("/Users/namrataxxx/Desktop/Master_Thesis_material/Thesis_data_script_result/Weismann_Scope_MObiDB_Mpstruc_DimRed_JoostIDs/Tools_Prediction_score_data/GRAVY_Scores/human_uprot_Weismann_GRAVYScore_withoutSequence.txt", sep="", header = TRUE)
dim(Human_uprot_weismann_GRAVY) # 13104 x 2
#head(Human_uprot_weismann_GRAVY)
View(Human_uprot_weismann_GRAVY)

# Remove the leading '>' from the header in the GRAVY dataframe
Human_uprot_weismann_GRAVY$header <- sub("^>", "", Human_uprot_weismann_GRAVY$header)

# Read the second table with IUpred2 scores
Human_uprot_weismann_IUpred2 <- read.delim("/Users/namrataxxx/Desktop/Master_Thesis_material/Thesis_data_script_result/Weismann_Scope_MObiDB_Mpstruc_DimRed_JoostIDs/Tools_Prediction_score_data/IUPred_Scores/human_uprots_weissma_riboseq_11_100.IUPred_score.txt", sep="", header = TRUE)
dim(Human_uprot_weismann_IUpred2) # 10694 x 2
#head(Human_uprot_weismann_IUpred2)
View(Human_uprot_weismann_IUpred2)

# Merge the two tables by their ID, which is assumed to be in the 'header' column
merged_data <- merge(Human_uprot_weismann_GRAVY, Human_uprot_weismann_IUpred2,by = "header")
final_merged_data <- merge(merged_data, Human_uprot_weismann_TMHMM,by = "header" )
View(final_merged_data)

# If you want to add the 'type' column with value "Microprotein"
final_merged_data$type <- "Microprotein"

# To place the 'type' column in the second position
final_merged_data <- final_merged_data[c("header", "length","type", "GRAVY", "IUPred2", "TMHMM_score")]
View(final_merged_data)

sum(is.na(final_merged_data))
final_merged_data <- na.omit(final_merged_data)
dim(final_merged_data) # 7560 x  6
# Renaming the merged dataset
human_uprot_weismann_GRAVY_IUpred2_TMHMM <- final_merged_data  
View(human_uprot_weismann_GRAVY_IUpred2_TMHMM)
# Removing duplicates
human_uprot_weismann_GRAVY_IUpred2_TMHMM <- human_uprot_weismann_GRAVY_IUpred2_TMHMM[!duplicated(human_uprot_weismann_GRAVY_IUpred2_TMHMM$header), ]
dim(human_uprot_weismann_GRAVY_IUpred2_TMHMM) # 7560 x 6 
```

```{r}
# These datasets for membprot (mpStruc database) contains prediction scores for GRAVY, DeepTMHMM, IUPred2A
# Membrane protein dataset

Human_membprot_mpstruc_TMHMM <- read.table("/Users/namrataxxx/Desktop/Master_Thesis_material/Thesis_data_script_result/Weismann_Scope_MObiDB_Mpstruc_DimRed_JoostIDs/Tools_Prediction_score_data/TMHMM_Scores/human_memprot_mpstruc_TMHMMScore_final.txt", header=TRUE, sep="\t")
head(Human_membprot_mpstruc_TMHMM)
dim(Human_membprot_mpstruc_TMHMM) # 1758 x 3

# Read the first table with GRAVY scores
Human_membprot_mpstruc_GRAVY <- read.delim("//Users/namrataxxx/Desktop/Master_Thesis_material/Thesis_data_script_result/Weismann_Scope_MObiDB_Mpstruc_DimRed_JoostIDs/Tools_Prediction_score_data/GRAVY_Scores/human_membprot_mpstrucDB_GRAVYScore_withoutSequence.txt", sep="", header = TRUE)
dim(Human_membprot_mpstruc_GRAVY) # 1749 x 2
#head(Human_membprot_mpstruc_GRAVY)
View(Human_membprot_mpstruc_GRAVY) 

# Remove the leading '>' from the header in the GRAVY dataframe
Human_membprot_mpstruc_GRAVY$header <- sub("^>", "", Human_membprot_mpstruc_GRAVY$header)

# Read the second table with IUpred2 scores
Human_membprot_mpstruc_IUpred2 <- read.delim("/Users/namrataxxx/Desktop/Master_Thesis_material/Thesis_data_script_result/Weismann_Scope_MObiDB_Mpstruc_DimRed_JoostIDs/Tools_Prediction_score_data/IUPred_Scores/human_membprot_mpStruc_IUpred_score.txt", sep="", header = TRUE)
dim(Human_membprot_mpstruc_IUpred2) # 1758 x 2
#head(Human_membprot_mpstruc_IUpred2)
View(Human_membprot_mpstruc_IUpred2)

# Merge the two tables by their ID, which is assumed to be in the 'header' column
merged_data_membprot <- merge(Human_membprot_mpstruc_GRAVY, Human_membprot_mpstruc_IUpred2, by = "header")
final_merged_data_membprot <- merge(merged_data_membprot, Human_membprot_mpstruc_TMHMM, by = "header")
View(final_merged_data_membprot)


# If you want to add the 'type' column with value "Membrane protein"
final_merged_data_membprot$type <- "Membrane protein"

# To place the 'type' column in the second position
final_merged_data_membprot <- final_merged_data_membprot[c("header", "length","type", "GRAVY", "IUpred2", "TMHMM_score")]
View(final_merged_data_membprot)

sum(is.na(final_merged_data_membprot))
final_merged_data_membprot <- na.omit(final_merged_data_membprot)
dim(final_merged_data_membprot) # 1749 x  6
# Renaming the merged dataset
human_membprot_mpstruc_GRAVY_IUpred2_TMHMM <- final_merged_data_membprot  
View(human_membprot_mpstruc_GRAVY_IUpred2_TMHMM)
# Removing duplicates
human_membprot_mpstruc_GRAVY_IUpred2_TMHMM <- human_membprot_mpstruc_GRAVY_IUpred2_TMHMM[!duplicated(human_membprot_mpstruc_GRAVY_IUpred2_TMHMM$header), ]
dim(human_membprot_mpstruc_GRAVY_IUpred2_TMHMM) # 1749 x  6
View(human_membprot_mpstruc_GRAVY_IUpred2_TMHMM)

# Selecting sequences only above 100 aa.
human_membprot_mpstruc_GRAVY_IUpred2_TMHMM_longerthan100 <- human_membprot_mpstruc_GRAVY_IUpred2_TMHMM[human_membprot_mpstruc_GRAVY_IUpred2_TMHMM$length > 100,]
dim(human_membprot_mpstruc_GRAVY_IUpred2_TMHMM_longerthan100) # 1455 x 6
```

```{r}
# These datasets for globular proteins (Scope Astral 40) contains prediction scores for GRAVY, DeepTMHMM, IUPred2A
# Globular protein dataset

Human_globprot_ScopeAstral40_TMHMM <- read.table("/Users/namrataxxx/Desktop/Master_Thesis_material/Thesis_data_script_result/Weismann_Scope_MObiDB_Mpstruc_DimRed_JoostIDs/Tools_Prediction_score_data/TMHMM_Scores/human_globprot_scopeAstral40DB_TMHMMScore_final.txt", header=TRUE, sep="\t")
dim(Human_globprot_ScopeAstral40_TMHMM) #2383 x 3
View(Human_globprot_ScopeAstral40_TMHMM)

# Read the first table with GRAVY scores
Human_globprot_ScopeAstral40_GRAVY <- read.delim("/Users/namrataxxx/Desktop/Master_Thesis_material/Thesis_data_script_result/Weismann_Scope_MObiDB_Mpstruc_DimRed_JoostIDs/Tools_Prediction_score_data/GRAVY_Scores/human_globprot_scpeAstral40DB_GRAVYScore_withoutSequence.txt", sep="", header = TRUE)
dim(Human_globprot_ScopeAstral40_GRAVY) # 2788 x 2
head(Human_globprot_ScopeAstral40_GRAVY)
#View(Human_globprot_ScopeAstral40_GRAVY)

# Remove the leading '>' from the header in the GRAVY dataframe
Human_globprot_ScopeAstral40_GRAVY$header <- sub("^>", "", Human_globprot_ScopeAstral40_GRAVY$header)

# Read the second table with IUpred2 scores
Human_globprot_ScopeAstral40_IUpred2 <- read.delim("/Users/namrataxxx/Desktop/Master_Thesis_material/Thesis_data_script_result/Weismann_Scope_MObiDB_Mpstruc_DimRed_JoostIDs/Tools_Prediction_score_data/IUPred_Scores/human_globular_protein_scope_astral_40.IUpred_score.txt", sep="", header = TRUE)
dim(Human_globprot_ScopeAstral40_IUpred2) # 2383 x 2
#head(Human_globprot_ScopeAstral40_IUpred2)
View(Human_globprot_ScopeAstral40_IUpred2)

# Merge the two tables by their ID, which is assumed to be in the 'header' column
merged_dataglobprot_ScopeAstral40 <- merge(Human_globprot_ScopeAstral40_GRAVY, Human_globprot_ScopeAstral40_IUpred2, by = "header")
final_merged_dataglobprot_ScopeAstral40 <- merge(merged_dataglobprot_ScopeAstral40, Human_globprot_ScopeAstral40_TMHMM, by = "header")
View(final_merged_dataglobprot_ScopeAstral40)

# If you want to add the 'type' column with value "Globular protein"
final_merged_dataglobprot_ScopeAstral40$type <- "Globular_protein"

# To place the 'type' column in the second position
final_merged_dataglobprot_ScopeAstral40 <- final_merged_dataglobprot_ScopeAstral40[c("header", "length","type", "GRAVY", "IUpred2", "TMHMM_score")]
View(final_merged_dataglobprot_ScopeAstral40)

sum(is.na(final_merged_dataglobprot_ScopeAstral40))
final_merged_dataglobprot_ScopeAstral40 <- na.omit(final_merged_dataglobprot_ScopeAstral40)
dim(final_merged_dataglobprot_ScopeAstral40) # 2788 x  6
# Renaming the merged dataset
human_globprot_ScopeAstral40_GRAVY_IUpred2_TMHMM <- final_merged_dataglobprot_ScopeAstral40  
View(human_globprot_ScopeAstral40_GRAVY_IUpred2_TMHMM) 
# Removing duplicates
human_globprot_ScopeAstral40_GRAVY_IUpred2_TMHMM <- human_globprot_ScopeAstral40_GRAVY_IUpred2_TMHMM[!duplicated(human_globprot_ScopeAstral40_GRAVY_IUpred2_TMHMM$header), ]
dim(human_globprot_ScopeAstral40_GRAVY_IUpred2_TMHMM) # 2383 x 6

# Selecting sequences only above 100 aa.
human_globprot_ScopeAstral40_GRAVY_IUpred2_TMHMM_longerthan100 <- human_globprot_ScopeAstral40_GRAVY_IUpred2_TMHMM[human_globprot_ScopeAstral40_GRAVY_IUpred2_TMHMM$length > 100,]
dim(human_globprot_ScopeAstral40_GRAVY_IUpred2_TMHMM_longerthan100) # 1527 x 6
```


```{r}
# These datasets for IDP (Disprot DB) contains prediction scores for for GRAVY, DeepTMHMM, IUPred2A
# Disordered protein dataset

Human_IDP_Disprot_TMHMM <- read.table("/Users/namrataxxx/Desktop/Master_Thesis_material/Thesis_data_script_result/Weismann_Scope_MObiDB_Mpstruc_DimRed_JoostIDs/Tools_Prediction_score_data/TMHMM_Scores/human_IDP_Disprot_TMHMMScore_final.txt", header=TRUE, sep="\t")
View(Human_IDP_Disprot_TMHMM)
dim(Human_IDP_Disprot_TMHMM) # 4587 x 3

# Read the first table with GRAVY scores
Human_IDP_Disprot_GRAVY <- read.delim("/Users/namrataxxx/Desktop/Master_Thesis_material/Thesis_data_script_result/Weismann_Scope_MObiDB_Mpstruc_DimRed_JoostIDs/Tools_Prediction_score_data/GRAVY_Scores/human_IDP_Disprot_GRAVYScore_without_sequence1.txt", sep="\t", header = TRUE)
dim(Human_IDP_Disprot_GRAVY) # 4587 x 8 
#head(Human_IDP_Disprot_GRAVY)
View(Human_IDP_Disprot_GRAVY)

Human_IDP_Disprot_GRAVY <- Human_IDP_Disprot_GRAVY[c(1,2)]

# Rename the second column to "GRAVY"
names(Human_IDP_Disprot_GRAVY)[2] <- "GRAVY"


# Read the second table with fasta IDs to replace in the header column in previous dataframe.
Human_IDP_Disprot_GRAVY2 <- read.delim("/Users/namrataxxx/Desktop/Master_Thesis_material/Thesis_data_script_result/Weismann_Scope_MObiDB_Mpstruc_DimRed_JoostIDs/Tools_Prediction_score_data/GRAVY_Scores/human_IDP_Disprot_GRAVYScore_without_sequence2.txt", sep="\t", header = TRUE)
dim(Human_IDP_Disprot_GRAVY2) # 4587 x 1
View(Human_IDP_Disprot_GRAVY2)

# Replacing the 'header' column in df1 with the 'header' column from df2
Human_IDP_Disprot_GRAVY$header <- Human_IDP_Disprot_GRAVY2$header
Human_IDP_Disprot_GRAVY <- Human_IDP_Disprot_GRAVY[c(2,3)]

# Remove the leading '>' from the header in the GRAVY dataframe
Human_IDP_Disprot_GRAVY$header <- sub("^>", "", Human_IDP_Disprot_GRAVY$header)

View(Human_IDP_Disprot_GRAVY)

# Read the second table with IUpred2 scores
Human_IDP_Disprot_IUpred2 <- read.delim("/Users/namrataxxx/Desktop/Master_Thesis_material/Thesis_data_script_result/Weismann_Scope_MObiDB_Mpstruc_DimRed_JoostIDs/Tools_Prediction_score_data/IUPred_Scores/human_IDP_Disprot_IUpred_score.txt", sep="", header = TRUE)
dim(Human_IDP_Disprot_IUpred2) # 4587 x 2
#head(Human_IDP_Disprot_IUpred2)
View(Human_IDP_Disprot_IUpred2)


# Merge the two tables by their ID, which is assumed to be in the 'header' column
merged_data_IDP_Disprot <- merge(Human_IDP_Disprot_GRAVY, Human_IDP_Disprot_IUpred2, by = "header")
final_merged_data_IDP_Disprot <- merge(merged_data_IDP_Disprot, Human_IDP_Disprot_TMHMM, by = "header")
View(final_merged_data_IDP_Disprot)

# If you want to add the 'type' column with value "Microprotein"
final_merged_data_IDP_Disprot$type <- "Disordered_protein"

# To place the 'type' column in the second position
final_merged_data_IDP_Disprot <- final_merged_data_IDP_Disprot[c("header", "length","type", "GRAVY", "IUpred2", "TMHMM_score")]
View(final_merged_data_IDP_Disprot)

sum(is.na(final_merged_data_IDP_Disprot))
final_merged_data_IDP_Disprot <- na.omit(final_merged_data_IDP_Disprot)
dim(final_merged_data_IDP_Disprot) # 4587 x  6

# Renaming the merged dataset
human_IDP_Disprot_GRAVY_IUpred2_TMHMM <- final_merged_data_IDP_Disprot  
View(human_IDP_Disprot_GRAVY_IUpred2_TMHMM)

# Removing duplicates
human_IDP_Disprot_GRAVY_IUpred2_TMHMM <- human_IDP_Disprot_GRAVY_IUpred2_TMHMM[!duplicated(human_IDP_Disprot_GRAVY_IUpred2_TMHMM$header), ]
dim(human_IDP_Disprot_GRAVY_IUpred2_TMHMM) # 4587 x 6 

# Selecting sequences only above 100 aa.
human_IDP_Disprot_GRAVY_IUpred2_TMHMM_longerthan100 <- human_IDP_Disprot_GRAVY_IUpred2_TMHMM[human_IDP_Disprot_GRAVY_IUpred2_TMHMM$length > 100,]
dim(human_IDP_Disprot_GRAVY_IUpred2_TMHMM_longerthan100) # 1069 x 6
View(human_IDP_Disprot_GRAVY_IUpred2_TMHMM_longerthan100)

```

```{r}
# These datasets for peptides_new (NCBI database) contains prediction scores for GRAVY, DeepTMHMM, IUPred2A
# Peptides dataset

Human_peptides_new_NCBI_TMHMM <- read.table("/Users/namrataxxx/Desktop/Master_Thesis_material/Thesis_data_script_result/Weismann_Scope_MObiDB_Mpstruc_DimRed_JoostIDs/Tools_Prediction_score_data/TMHMM_Scores/human_peptide_NCBI_TMHMMScore_2500Seq_final.txt", header=TRUE, sep="\t")
dim(Human_peptides_new_NCBI_TMHMM) # 1461 x 3

# Read the first table with GRAVY scores
Human_peptides_new_NCBI_GRAVY <- read.delim("/Users/namrataxxx/Desktop/Master_Thesis_material/Thesis_data_script_result/Weismann_Scope_MObiDB_Mpstruc_DimRed_JoostIDs/Tools_Prediction_score_data/GRAVY_Scores/human_peptide_NCBI_GRAVYScore_withoutSequence.txt", sep="", header = TRUE)
dim(Human_peptides_new_NCBI_GRAVY) # 2789 x 2
#head(Human_peptides_new_NCBI_GRAVY)
View(Human_peptides_new_NCBI_GRAVY)

# Remove the leading '>' from the header in the GRAVY dataframe
Human_peptides_new_NCBI_GRAVY$header <- sub("^>", "", Human_peptides_new_NCBI_GRAVY$header)

# Read the second table with IUpred2 scores
Human_peptides_new_NCBI_IUpred2 <- read.delim("/Users/namrataxxx/Desktop/Master_Thesis_material/Thesis_data_script_result/Weismann_Scope_MObiDB_Mpstruc_DimRed_JoostIDs/Tools_Prediction_score_data/IUPred_Scores/human_peptideSeq_NCBI_new.IUpred_score.txt", sep="", header = TRUE)
dim(Human_peptides_new_NCBI_IUpred2) # 1455 x 2
#head(Human_peptides_new_NCBI_IUpred2)
View(Human_peptides_new_NCBI_IUpred2)

# Merge the two tables by their ID, which is assumed to be in the 'header' column
merged_data_peptides_new_NCBI <- merge(Human_peptides_new_NCBI_GRAVY, Human_peptides_new_NCBI_IUpred2, by = "header")
final_merged_data_peptides_new_NCBI <- merge(merged_data_peptides_new_NCBI, Human_peptides_new_NCBI_TMHMM, by = "header")
View(final_merged_data_peptides_new_NCBI)

# If you want to add the 'type' column with value "Peptides"
final_merged_data_peptides_new_NCBI$type <- "Peptides"

# To place the 'type' column in the second position
final_merged_data_peptides_new_NCBI <- final_merged_data_peptides_new_NCBI[c("header", "length","type", "GRAVY", "IUpred2", "TMHMM_score")]
View(final_merged_data_peptides_new_NCBI)

sum(is.na(final_merged_data_peptides_new_NCBI))
final_merged_data_peptides_new_NCBI <- na.omit(final_merged_data_peptides_new_NCBI)
dim(final_merged_data_peptides_new_NCBI) # 2535 x  6
# Renaming the merged dataset
human_peptides_new_NCBI_GRAVY_IUpred2_TMHMM <- final_merged_data_peptides_new_NCBI  
View(human_peptides_new_NCBI_GRAVY_IUpred2_TMHMM)
# Removing duplicates
human_peptides_new_NCBI_GRAVY_IUpred2_TMHMM <- human_peptides_new_NCBI_GRAVY_IUpred2_TMHMM[!duplicated(human_peptides_new_NCBI_GRAVY_IUpred2_TMHMM$header), ]
dim(human_peptides_new_NCBI_GRAVY_IUpred2_TMHMM) # 1323 x 6 

```

```{r}

# Create the ggplot objects for GRAVY, IUpred2A, and TMHMM scores with improved histograms
p1_uprot <- ggplot(human_uprot_weismann_GRAVY_IUpred2_TMHMM, aes(x=GRAVY)) +
  geom_histogram(binwidth=0.1, fill="#0073C2FF", color="black", alpha=0.7) +
  labs(title="Distribution of GRAVY Scores", x="GRAVY Score", y="Frequency") +
  theme_minimal() +
  theme(
    plot.title = element_text(hjust=0.5, size=14, face="bold"),
    axis.title = element_text(size=12),
    axis.text = element_text(size=10)
  )

p2_uprot <- ggplot(human_uprot_weismann_GRAVY_IUpred2_TMHMM, aes(x=IUPred2)) +
  geom_histogram(binwidth=0.1, fill="#EFC000FF", color="black", alpha=0.7) +
  labs(title="Distribution of IUpred2A Scores", x="IUpred2A Score", y="Frequency") +
  theme_minimal() +
  theme(
    plot.title = element_text(hjust=0.5, size=14, face="bold"),
    axis.title = element_text(size=12),
    axis.text = element_text(size=10)
  )

p3_uprot <- ggplot(human_uprot_weismann_GRAVY_IUpred2_TMHMM, aes(x=TMHMM_score)) +
  geom_histogram(binwidth=0.1, fill="#868686FF", color="black", alpha=0.7) +
  labs(title="Distribution of DeepTMHMM Scores", x="DeepTMHMM Score", y="Frequency") +
  theme_minimal() +
  theme(
    plot.title = element_text(hjust=0.5, size=14, face="bold"),
    axis.title = element_text(size=12),
    axis.text = element_text(size=10)
  )

# Arranging the plots side by side using patchwork
combined_plot <- p1_uprot + p2_uprot + p3_uprot + 
  plot_annotation(title="Distribution of Scores from Different Prediction Tools",
                  theme=theme(plot.title = element_text(size=16, face="bold", hjust=0.5)))

# Print the combined plot
print(combined_plot)
```

```{r}
# Z-score normalization of uprot
human_uprot_weismann_GRAVY_IUpred2_TMHMM$GRAVY_normalized <- scale(human_uprot_weismann_GRAVY_IUpred2_TMHMM$GRAVY)
human_uprot_weismann_GRAVY_IUpred2_TMHMM$IUpred2_normalized <- scale(human_uprot_weismann_GRAVY_IUpred2_TMHMM$IUPred2)
human_uprot_weismann_GRAVY_IUpred2_TMHMM$TMHMM_normalized <- scale(human_uprot_weismann_GRAVY_IUpred2_TMHMM$TMHMM_score)
View(human_uprot_weismann_GRAVY_IUpred2_TMHMM)

# Create the ggplot objects for GRAVY and IUpred2 scores with only frequency histograms
p1_uprot_z_normalized <- ggplot(human_uprot_weismann_GRAVY_IUpred2_TMHMM, aes(x=GRAVY_normalized)) +
  geom_histogram(binwidth=0.1, fill="blue", alpha=0.5) +
  labs(title="Distribution of z-normalized GRAVY Scores", x="Normalized GRAVY Score", y="Frequency") +
  theme_minimal()

p2_uprot_z_normalized <- ggplot(human_uprot_weismann_GRAVY_IUpred2_TMHMM, aes(x=IUpred2_normalized)) +
  geom_histogram(binwidth=0.1, fill="green", alpha=0.5) +
  labs(title="Distribution of z-normalized IUpred2 Scores", x="Normalized IUpred2 Score", y="Frequency") +
  theme_minimal()

p3_uprot_z_normalized <- ggplot(human_uprot_weismann_GRAVY_IUpred2_TMHMM, aes(x=TMHMM_normalized)) +
  geom_histogram(binwidth=0.1, fill="red", alpha=0.5) +
  labs(title="Distribution of z-normalized TMHMM Scores", x="Normalized TMHMM Score", y="Frequency") +
  theme_minimal()

# Arranging the plots side by side 
p1_uprot_z_normalized + p2_uprot_z_normalized + p3_uprot_z_normalized
 
```

```{r}
### Z-score normalizing and combining all the dataset.
View(human_uprot_weismann_GRAVY_IUpred2_TMHMM)
z_sore_normalized_human_uprot_weismann_GRAVY_IUpred2_TMHMM <- human_uprot_weismann_GRAVY_IUpred2_TMHMM [c(1:3,7:9)]
head(z_sore_normalized_human_uprot_weismann_GRAVY_IUpred2_TMHMM)
dim(z_sore_normalized_human_uprot_weismann_GRAVY_IUpred2_TMHMM) # 7560 x 6

# membrane protein
human_membprot_mpstruc_GRAVY_IUpred2_TMHMM_longerthan100$GRAVY_normalized <- scale(human_membprot_mpstruc_GRAVY_IUpred2_TMHMM_longerthan100$GRAVY)
human_membprot_mpstruc_GRAVY_IUpred2_TMHMM_longerthan100$IUpred2_normalized <- scale(human_membprot_mpstruc_GRAVY_IUpred2_TMHMM_longerthan100$IUpred2)
human_membprot_mpstruc_GRAVY_IUpred2_TMHMM_longerthan100$TMHMM_normalized <- scale(human_membprot_mpstruc_GRAVY_IUpred2_TMHMM_longerthan100$TMHMM_score)
View(human_membprot_mpstruc_GRAVY_IUpred2_TMHMM_longerthan100)

z_sore_normalized_human_membprot_mpstruc_GRAVY_IUpred2_TMHMM_longerthan100 <- human_membprot_mpstruc_GRAVY_IUpred2_TMHMM_longerthan100 [c(1:3,7:9)]
head(z_sore_normalized_human_membprot_mpstruc_GRAVY_IUpred2_TMHMM_longerthan100)
dim(z_sore_normalized_human_membprot_mpstruc_GRAVY_IUpred2_TMHMM_longerthan100) # 1445 x 6

# disordered protein
human_IDP_Disprot_GRAVY_IUpred2_TMHMM_longerthan100$GRAVY_normalized <- scale(human_IDP_Disprot_GRAVY_IUpred2_TMHMM_longerthan100$GRAVY)
human_IDP_Disprot_GRAVY_IUpred2_TMHMM_longerthan100$IUpred2_normalized <- scale(human_IDP_Disprot_GRAVY_IUpred2_TMHMM_longerthan100$IUpred2)
human_IDP_Disprot_GRAVY_IUpred2_TMHMM_longerthan100$TMHMM_normalized <- scale(human_IDP_Disprot_GRAVY_IUpred2_TMHMM_longerthan100$TMHMM_score)
View(human_IDP_Disprot_GRAVY_IUpred2_TMHMM_longerthan100)

z_sore_normalized_human_IDP_Disprot_GRAVY_IUpred2_TMHMM_longerthan100 <- human_IDP_Disprot_GRAVY_IUpred2_TMHMM_longerthan100 [c(1:3,7:9)]
head(z_sore_normalized_human_IDP_Disprot_GRAVY_IUpred2_TMHMM_longerthan100)
dim(z_sore_normalized_human_IDP_Disprot_GRAVY_IUpred2_TMHMM_longerthan100) # 1069 x 6

# globular protein
human_globprot_ScopeAstral40_GRAVY_IUpred2_TMHMM_longerthan100$GRAVY_normalized <- scale(human_globprot_ScopeAstral40_GRAVY_IUpred2_TMHMM_longerthan100$GRAVY)
human_globprot_ScopeAstral40_GRAVY_IUpred2_TMHMM_longerthan100$IUpred2_normalized <- scale(human_globprot_ScopeAstral40_GRAVY_IUpred2_TMHMM_longerthan100$IUpred2)
human_globprot_ScopeAstral40_GRAVY_IUpred2_TMHMM_longerthan100$TMHMM_normalized <- scale(human_globprot_ScopeAstral40_GRAVY_IUpred2_TMHMM_longerthan100$TMHMM_score)
View(human_globprot_ScopeAstral40_GRAVY_IUpred2_TMHMM_longerthan100)

z_sore_normalized_human_globprot_ScopeAstral40_GRAVY_IUpred2_TMHMM_longerthan100 <- human_globprot_ScopeAstral40_GRAVY_IUpred2_TMHMM_longerthan100 [c(1:3,7:9)]
head(z_sore_normalized_human_globprot_ScopeAstral40_GRAVY_IUpred2_TMHMM_longerthan100)
dim(z_sore_normalized_human_globprot_ScopeAstral40_GRAVY_IUpred2_TMHMM_longerthan100) # 1527 x 6

# peptides
human_peptides_new_NCBI_GRAVY_IUpred2_TMHMM$GRAVY_normalized <- scale(human_peptides_new_NCBI_GRAVY_IUpred2_TMHMM$GRAVY)
human_peptides_new_NCBI_GRAVY_IUpred2_TMHMM$IUpred2_normalized <- scale(human_peptides_new_NCBI_GRAVY_IUpred2_TMHMM$IUpred2)
human_peptides_new_NCBI_GRAVY_IUpred2_TMHMM$TMHMM_normalized <- scale(human_peptides_new_NCBI_GRAVY_IUpred2_TMHMM$TMHMM_score)
View(human_peptides_new_NCBI_GRAVY_IUpred2_TMHMM)

z_sore_normalized_human_peptides_new_NCBI_GRAVY_IUpred2_TMHMM <- human_peptides_new_NCBI_GRAVY_IUpred2_TMHMM [c(1:3,7:9)]
head(z_sore_normalized_human_peptides_new_NCBI_GRAVY_IUpred2_TMHMM)
dim(z_sore_normalized_human_peptides_new_NCBI_GRAVY_IUpred2_TMHMM) # 1323 x 6

# Filtering peptides <= 75
z_sore_normalized_human_peptides_new_NCBI_GRAVY_IUpred2_TMHMM_smallerORequal75 <- z_sore_normalized_human_peptides_new_NCBI_GRAVY_IUpred2_TMHMM %>% filter(length <= 75)
dim(z_sore_normalized_human_peptides_new_NCBI_GRAVY_IUpred2_TMHMM_smallerORequal75) # 839 x 6
#View(z_sore_normalized_human_peptides_new_NCBI_GRAVY_IUpred2_TMHMM_smallerORequal75)

# Selecting only 5000 uprot samples
z_sore_normalized_human_uprot_weismann_GRAVY_IUpred2_TMHMM_5000 <- z_sore_normalized_human_uprot_weismann_GRAVY_IUpred2_TMHMM[sample(nrow(z_sore_normalized_human_uprot_weismann_GRAVY_IUpred2_TMHMM), 5000),]  #subsampling to reduce microprot set size 
dim(z_sore_normalized_human_uprot_weismann_GRAVY_IUpred2_TMHMM_5000) # 5000 x  6
#head(z_sore_normalized_human_uprot_weismann_GRAVY_IUpred2_TMHMM_5000)

z_sore_normalized_G_I_1 <- rbind(z_sore_normalized_human_uprot_weismann_GRAVY_IUpred2_TMHMM_5000,z_sore_normalized_human_IDP_Disprot_GRAVY_IUpred2_TMHMM_longerthan100)
#head(z_sore_normalized_G_I_1)
z_sore_normalized_G_I_2 <- rbind(z_sore_normalized_G_I_1, z_sore_normalized_human_membprot_mpstruc_GRAVY_IUpred2_TMHMM_longerthan100)
z_sore_normalized_G_I_3 <- rbind(z_sore_normalized_G_I_2,z_sore_normalized_human_globprot_ScopeAstral40_GRAVY_IUpred2_TMHMM_longerthan100)
combined_z_sore_normalized_G_I <- rbind(z_sore_normalized_G_I_3,z_sore_normalized_human_peptides_new_NCBI_GRAVY_IUpred2_TMHMM_smallerORequal75)
dim(combined_z_sore_normalized_G_I) # 9880  x  6
head(combined_z_sore_normalized_G_I)
View(combined_z_sore_normalized_G_I)
sum(is.na(combined_z_sore_normalized_G_I))
combined_z_sore_normalized_G_I <- na.omit(combined_z_sore_normalized_G_I)
```

```{r}
# Prepare the data for UMAP, selecting only the columns with the physical property values
umap_data_combined_z_sore_normalized_G_I <- combined_z_sore_normalized_G_I[, c("GRAVY_normalized","IUpred2_normalized", "TMHMM_normalized")]
head(umap_data_combined_z_sore_normalized_G_I)
# Run UMAP
set.seed(4) # Set a random seed for reproducibility
umap_result_combined_z_sore_normalized_G_I <- umap(umap_data_combined_z_sore_normalized_G_I,n_neighbors=15, min_dist=0.3)

# Create a data frame for plotting that includes the UMAP dimensions and the protein type
plot_data_combined_z_sore_normalized_G_I <- data.frame(UMAP1 = umap_result_combined_z_sore_normalized_G_I$layout[,1], UMAP2 = umap_result_combined_z_sore_normalized_G_I$layout[,2], Type = combined_z_sore_normalized_G_I$type)
# Define custom colors for the plot
my_colors_combined_z_sore_normalized_G_I <- c("Disordered_protein" = "red", "Globular_protein" = "green", "Membrane protein" = "blue", "Microprotein" = "yellow", "Peptides" = "pink")

# Plot using ggplot2
plot_combined_z_sore_normalized_G_I <- ggplot(plot_data_combined_z_sore_normalized_G_I, aes(x = UMAP1, y = UMAP2, color = Type)) +
  geom_point(size=0.75, alpha=0.75) + # Adjust point transparency with the alpha parameter
  scale_color_manual(values = my_colors_combined_z_sore_normalized_G_I) + # Use the custom colors
  labs(title = "UMAP Visualization of Human Protein Clusters_Weismann_Disprot_Scope_mpstruc_NCBI(new)_DB(Gravy_IUpred2_TMHMM)",
       x = "UMAP Dimension 1",
       y = "UMAP Dimension 2",
       color = "Protein Type") +
  theme_minimal()
plot_combined_z_sore_normalized_G_I
```

```{r}
# Perform t-SNE
set.seed(42) # Set a random seed for reproducibility
tsne_result_combined_z_sore_normalized_G_I <- Rtsne(dist(umap_data_combined_z_sore_normalized_G_I), dims = 2, perplexity = 20, theta = 0.0, max_iter= 1000, verbose = FALSE )

# Create a data frame for plotting that includes the t-SNE dimensions and the protein type
tsne_data_combined_z_sore_normalized_G_I <- data.frame(TSNE1 = tsne_result_combined_z_sore_normalized_G_I$Y[,1], TSNE2 = tsne_result_combined_z_sore_normalized_G_I$Y[,2], Type = combined_z_sore_normalized_G_I$type)

# Define custom colors for the plot
my_colors_combined_z_sore_normalized_G_I <- c("Disordered_protein" = "red", "Globular_protein" = "green", "Membrane protein" = "blue", "Microprotein" = "yellow", "Peptides" = "pink")

# Plot using ggplot2
plot_combined_z_sore_normalized_G_I <- ggplot(tsne_data_combined_z_sore_normalized_G_I, aes(x = TSNE1, y = TSNE2, color = Type)) +
   geom_point(size=0.65, alpha=0.75) + # Adjust point transparency with the alpha parameter
  scale_color_manual(values = my_colors_combined_z_sore_normalized_G_I) + # Use the custom colors
  labs(title = "t-SNE Visualization of Human Protein Clusters_Weismann_Disprot_Scope_mpstruc_NCBI(Gravy_IUpred2_TMHMM_z_normalized)",
       x = "t-SNE Dimension 1",
       y = "t-SNE Dimension 2",
       color = "Protein Type") +
  theme_minimal()
plot_combined_z_sore_normalized_G_I
```

```{r}
# Violin plot of z-normalized scores of the combined dataset
# Custom colors 
my_colors_combined_z_sore_normalized_G_I <- c("Disordered_protein" = "red", "Globular_protein" = "green", "Membrane protein" = "blue", "Microprotein" = "yellow", "Peptides" = "pink")

# Reshape the dataframe to long format
df_long_combined_z_sore_normalized_G_I <- combined_z_sore_normalized_G_I %>%
  pivot_longer(cols = c("GRAVY_normalized","IUpred2_normalized", "TMHMM_normalized"),names_to = "property",values_to = "score")

# Function to create and adjust violin plot for a given property
create_violin_plot_combined_z_sore_normalized_G_I <- function(property_name, y_limits = NULL) {
  p <- ggplot(subset(df_long_combined_z_sore_normalized_G_I, property == property_name), aes(x = type, y = score, fill = type)) +
    geom_violin(trim = FALSE, adjust = 1.5) +  # adjust parameter smooths the violin plot
    geom_boxplot(width=0.05, fill="white", outlier.shape = NA, position=position_dodge(width=0.25)) + # Adjust width and position
    scale_fill_manual(values = my_colors_combined_z_sore_normalized_G_I) +
    theme_minimal() +
    theme(axis.text.x = element_text(angle = 45, hjust = 1),
          legend.position = "none") +
    labs(x = "Protein_Type", y = "Z-normalized Scores", title = property_name)

  # Adjust y-axis limits if provided
  if (!is.null(y_limits)) {
    p <- p + ylim(y_limits)
  }

  return(p)
}

p_GRAVY_normalized_combined_z_sore_normalized_G_I <- create_violin_plot_combined_z_sore_normalized_G_I("GRAVY_normalized", c(-5, 5))
print(p_GRAVY_normalized_combined_z_sore_normalized_G_I)
```


```{r}
# Violin plot of z-normalized IUpred2 scores of the combined dataset
p_IUpred2_normalized_combined_z_sore_normalized_G_I <- create_violin_plot_combined_z_sore_normalized_G_I("IUpred2_normalized", c(-4, 4))
print(p_IUpred2_normalized_combined_z_sore_normalized_G_I)
```


```{r}
# Violin plot of z-normalized TMHMM scores of the combined dataset
p_TMHMM_normalized_combined_z_sore_normalized_G_I <- create_violin_plot_combined_z_sore_normalized_G_I("TMHMM_normalized", c(-0.6, 0.6))
print(p_TMHMM_normalized_combined_z_sore_normalized_G_I)
```


```{r}
# Normalization using Min-max scaling to [0,1] range
human_uprot_weismann_GRAVY_IUpred2_TMHMM$GRAVY_minmax <- (human_uprot_weismann_GRAVY_IUpred2_TMHMM$GRAVY - min(human_uprot_weismann_GRAVY_IUpred2_TMHMM$GRAVY)) / (max(human_uprot_weismann_GRAVY_IUpred2_TMHMM$GRAVY) - min(human_uprot_weismann_GRAVY_IUpred2_TMHMM$GRAVY))

human_uprot_weismann_GRAVY_IUpred2_TMHMM$IUpred2_minmax <- (human_uprot_weismann_GRAVY_IUpred2_TMHMM$IUPred2 - min(human_uprot_weismann_GRAVY_IUpred2_TMHMM$IUPred2)) / (max(human_uprot_weismann_GRAVY_IUpred2_TMHMM$IUPred2) - min(human_uprot_weismann_GRAVY_IUpred2_TMHMM$IUPred2))

human_uprot_weismann_GRAVY_IUpred2_TMHMM$TMHMM_minmax <- (human_uprot_weismann_GRAVY_IUpred2_TMHMM$TMHMM_score - min(human_uprot_weismann_GRAVY_IUpred2_TMHMM$TMHMM_score)) / (max(human_uprot_weismann_GRAVY_IUpred2_TMHMM$TMHMM_score) - min(human_uprot_weismann_GRAVY_IUpred2_TMHMM$TMHMM_score))
View(human_uprot_weismann_GRAVY_IUpred2_TMHMM)

Min_max_normalized_human_uprot_weismann_GRAVY_IUpred2_TMHMM <- human_uprot_weismann_GRAVY_IUpred2_TMHMM [c(1:3,10:12)]
head(Min_max_normalized_human_uprot_weismann_GRAVY_IUpred2_TMHMM)
dim(Min_max_normalized_human_uprot_weismann_GRAVY_IUpred2_TMHMM) # 7560 x 6

# disordered protein
human_IDP_Disprot_GRAVY_IUpred2_TMHMM_longerthan100$GRAVY_minmax <- (human_IDP_Disprot_GRAVY_IUpred2_TMHMM_longerthan100$GRAVY - min(human_IDP_Disprot_GRAVY_IUpred2_TMHMM_longerthan100$GRAVY)) / (max(human_IDP_Disprot_GRAVY_IUpred2_TMHMM_longerthan100$GRAVY) - min(human_IDP_Disprot_GRAVY_IUpred2_TMHMM_longerthan100$GRAVY))

human_IDP_Disprot_GRAVY_IUpred2_TMHMM_longerthan100$IUpred2_minmax <- (human_IDP_Disprot_GRAVY_IUpred2_TMHMM_longerthan100$IUpred2 - min(human_IDP_Disprot_GRAVY_IUpred2_TMHMM_longerthan100$IUpred2)) / (max(human_IDP_Disprot_GRAVY_IUpred2_TMHMM_longerthan100$IUpred2) - min(human_IDP_Disprot_GRAVY_IUpred2_TMHMM_longerthan100$IUpred2))

human_IDP_Disprot_GRAVY_IUpred2_TMHMM_longerthan100$TMHMM_minmax <- (human_IDP_Disprot_GRAVY_IUpred2_TMHMM_longerthan100$TMHMM_score - min(human_IDP_Disprot_GRAVY_IUpred2_TMHMM_longerthan100$TMHMM_score)) / (max(human_IDP_Disprot_GRAVY_IUpred2_TMHMM_longerthan100$TMHMM_score) - min(human_IDP_Disprot_GRAVY_IUpred2_TMHMM_longerthan100$TMHMM_score))
View(human_IDP_Disprot_GRAVY_IUpred2_TMHMM_longerthan100)

Min_max_normalized_human_IDP_Disprot_GRAVY_IUpred2_TMHMM_longerthan100 <- human_IDP_Disprot_GRAVY_IUpred2_TMHMM_longerthan100 [c(1:3,10:12)]
head(Min_max_normalized_human_IDP_Disprot_GRAVY_IUpred2_TMHMM_longerthan100)
dim(Min_max_normalized_human_IDP_Disprot_GRAVY_IUpred2_TMHMM_longerthan100) # 1069 x 6

# membrane protein
human_membprot_mpstruc_GRAVY_IUpred2_TMHMM_longerthan100$GRAVY_minmax <- (human_membprot_mpstruc_GRAVY_IUpred2_TMHMM_longerthan100$GRAVY - min(human_membprot_mpstruc_GRAVY_IUpred2_TMHMM_longerthan100$GRAVY)) / (max(human_membprot_mpstruc_GRAVY_IUpred2_TMHMM_longerthan100$GRAVY) - min(human_membprot_mpstruc_GRAVY_IUpred2_TMHMM_longerthan100$GRAVY))

human_membprot_mpstruc_GRAVY_IUpred2_TMHMM_longerthan100$IUpred2_minmax <- (human_membprot_mpstruc_GRAVY_IUpred2_TMHMM_longerthan100$IUpred2 - min(human_membprot_mpstruc_GRAVY_IUpred2_TMHMM_longerthan100$IUpred2)) / (max(human_membprot_mpstruc_GRAVY_IUpred2_TMHMM_longerthan100$IUpred2) - min(human_membprot_mpstruc_GRAVY_IUpred2_TMHMM_longerthan100$IUpred2))

human_membprot_mpstruc_GRAVY_IUpred2_TMHMM_longerthan100$TMHMM_minmax <- (human_membprot_mpstruc_GRAVY_IUpred2_TMHMM_longerthan100$TMHMM_score - min(human_membprot_mpstruc_GRAVY_IUpred2_TMHMM_longerthan100$TMHMM_score)) / (max(human_membprot_mpstruc_GRAVY_IUpred2_TMHMM_longerthan100$TMHMM_score) - min(human_membprot_mpstruc_GRAVY_IUpred2_TMHMM_longerthan100$TMHMM_score))
View(human_membprot_mpstruc_GRAVY_IUpred2_TMHMM_longerthan100)

Min_max_normalized_human_membprot_mpstruc_GRAVY_IUpred2_TMHMM_longerthan100 <- human_membprot_mpstruc_GRAVY_IUpred2_TMHMM_longerthan100 [c(1:3,10:12)]
head(Min_max_normalized_human_membprot_mpstruc_GRAVY_IUpred2_TMHMM_longerthan100)
dim(Min_max_normalized_human_membprot_mpstruc_GRAVY_IUpred2_TMHMM_longerthan100) # 1445 x 6

# globular protein
human_globprot_ScopeAstral40_GRAVY_IUpred2_TMHMM_longerthan100$GRAVY_minmax <- (human_globprot_ScopeAstral40_GRAVY_IUpred2_TMHMM_longerthan100$GRAVY - min(human_globprot_ScopeAstral40_GRAVY_IUpred2_TMHMM_longerthan100$GRAVY)) / (max(human_globprot_ScopeAstral40_GRAVY_IUpred2_TMHMM_longerthan100$GRAVY) - min(human_globprot_ScopeAstral40_GRAVY_IUpred2_TMHMM_longerthan100$GRAVY))

human_globprot_ScopeAstral40_GRAVY_IUpred2_TMHMM_longerthan100$IUpred2_minmax <- (human_globprot_ScopeAstral40_GRAVY_IUpred2_TMHMM_longerthan100$IUpred2 - min(human_globprot_ScopeAstral40_GRAVY_IUpred2_TMHMM_longerthan100$IUpred2)) / (max(human_globprot_ScopeAstral40_GRAVY_IUpred2_TMHMM_longerthan100$IUpred2) - min(human_globprot_ScopeAstral40_GRAVY_IUpred2_TMHMM_longerthan100$IUpred2))

human_globprot_ScopeAstral40_GRAVY_IUpred2_TMHMM_longerthan100$TMHMM_minmax <- (human_globprot_ScopeAstral40_GRAVY_IUpred2_TMHMM_longerthan100$TMHMM_score - min(human_globprot_ScopeAstral40_GRAVY_IUpred2_TMHMM_longerthan100$TMHMM_score)) / (max(human_globprot_ScopeAstral40_GRAVY_IUpred2_TMHMM_longerthan100$TMHMM_score) - min(human_globprot_ScopeAstral40_GRAVY_IUpred2_TMHMM_longerthan100$TMHMM_score))
View(human_globprot_ScopeAstral40_GRAVY_IUpred2_TMHMM_longerthan100)

Min_max_normalized_human_globprot_ScopeAstral40_GRAVY_IUpred2_TMHMM_longerthan100 <- human_globprot_ScopeAstral40_GRAVY_IUpred2_TMHMM_longerthan100 [c(1:3,10:12)]
head(Min_max_normalized_human_globprot_ScopeAstral40_GRAVY_IUpred2_TMHMM_longerthan100)
dim(Min_max_normalized_human_globprot_ScopeAstral40_GRAVY_IUpred2_TMHMM_longerthan100) # 1527 x 6

# peptides
human_peptides_new_NCBI_GRAVY_IUpred2_TMHMM$GRAVY_minmax <- (human_peptides_new_NCBI_GRAVY_IUpred2_TMHMM$GRAVY - min(human_peptides_new_NCBI_GRAVY_IUpred2_TMHMM$GRAVY)) / (max(human_peptides_new_NCBI_GRAVY_IUpred2_TMHMM$GRAVY) - min(human_peptides_new_NCBI_GRAVY_IUpred2_TMHMM$GRAVY))

human_peptides_new_NCBI_GRAVY_IUpred2_TMHMM$IUpred2_minmax <- (human_peptides_new_NCBI_GRAVY_IUpred2_TMHMM$IUpred2 - min(human_peptides_new_NCBI_GRAVY_IUpred2_TMHMM$IUpred2)) / (max(human_peptides_new_NCBI_GRAVY_IUpred2_TMHMM$IUpred2) - min(human_peptides_new_NCBI_GRAVY_IUpred2_TMHMM$IUpred2))

human_peptides_new_NCBI_GRAVY_IUpred2_TMHMM$TMHMM_minmax <- (human_peptides_new_NCBI_GRAVY_IUpred2_TMHMM$TMHMM_score - min(human_peptides_new_NCBI_GRAVY_IUpred2_TMHMM$TMHMM_score)) / (max(human_peptides_new_NCBI_GRAVY_IUpred2_TMHMM$TMHMM_score) - min(human_peptides_new_NCBI_GRAVY_IUpred2_TMHMM$TMHMM_score))
View(human_peptides_new_NCBI_GRAVY_IUpred2_TMHMM)

Min_max_normalized_human_peptides_new_NCBI_GRAVY_IUpred2_TMHMM <- human_peptides_new_NCBI_GRAVY_IUpred2_TMHMM [c(1:3,10:12)]
head(Min_max_normalized_human_peptides_new_NCBI_GRAVY_IUpred2_TMHMM)
dim(Min_max_normalized_human_peptides_new_NCBI_GRAVY_IUpred2_TMHMM) # 1323 x 6

## Need to filter peptides. take only those <= 75 aa
Min_max_normalized_human_peptides_new_NCBI_GRAVY_IUpred2_TMHMM_smallerOeEqual75 <- Min_max_normalized_human_peptides_new_NCBI_GRAVY_IUpred2_TMHMM %>% filter(length <= 75)
dim(Min_max_normalized_human_peptides_new_NCBI_GRAVY_IUpred2_TMHMM_smallerOeEqual75) # 839 x 6

# selecting 5000 uprots
Min_max_normalized_human_uprot_weismann_GRAVY_IUpred2_TMHMM_5000 <- Min_max_normalized_human_uprot_weismann_GRAVY_IUpred2_TMHMM[sample(nrow(Min_max_normalized_human_uprot_weismann_GRAVY_IUpred2_TMHMM), 5000),]  #subsampling to reduce microprot set size 
dim(Min_max_normalized_human_uprot_weismann_GRAVY_IUpred2_TMHMM_5000) # 5000 x  6
#head(Min_max_normalized_human_uprot_weismann_GRAVY_IUpred2_TMHMM_5000)

Min_max_normalized_G_I_1 <- rbind(Min_max_normalized_human_uprot_weismann_GRAVY_IUpred2_TMHMM_5000,Min_max_normalized_human_IDP_Disprot_GRAVY_IUpred2_TMHMM_longerthan100)
#head(Min_max_normalized_G_I_1)
Min_max_normalized_G_I_2 <- rbind(Min_max_normalized_G_I_1, Min_max_normalized_human_membprot_mpstruc_GRAVY_IUpred2_TMHMM_longerthan100)
Min_max_normalized_G_I_3 <- rbind(Min_max_normalized_G_I_2,Min_max_normalized_human_globprot_ScopeAstral40_GRAVY_IUpred2_TMHMM_longerthan100)
combined_Min_max_normalized_G_I <- rbind(Min_max_normalized_G_I_3,Min_max_normalized_human_peptides_new_NCBI_GRAVY_IUpred2_TMHMM_smallerOeEqual75)
dim(combined_Min_max_normalized_G_I) # 9880  x  6
head(combined_Min_max_normalized_G_I)
View(combined_Min_max_normalized_G_I)
sum(is.na(combined_Min_max_normalized_G_I))
combined_Min_max_normalized_G_I <- na.omit(combined_Min_max_normalized_G_I)
```

```{r}
# Create the ggplot objects for GRAVY and IUpred2 scores with only frequency histograms
p1_uprot_Min_max_normalized_G_I <- ggplot(Min_max_normalized_human_uprot_weismann_GRAVY_IUpred2_TMHMM_5000, aes(x=GRAVY_minmax)) +
  geom_histogram(binwidth=0.1, fill="blue", alpha=0.5) +
  labs(title="Distribution of minmax_normalized GRAVY Scores", x="Minmax_normalized GRAVY Score", y="Frequency") +
  theme_minimal()

p2_uprot_Min_max_normalized_G_I <- ggplot(Min_max_normalized_human_uprot_weismann_GRAVY_IUpred2_TMHMM_5000, aes(x=IUpred2_minmax)) +
  geom_histogram(binwidth=0.1, fill="green", alpha=0.5) +
  labs(title="Distribution of minmax_normalized IUpred2 Scores", x="Minmax_normalized IUpred2 Score", y="Frequency") +
  theme_minimal()

p3_uprot_Min_max_normalized_G_I <- ggplot(Min_max_normalized_human_uprot_weismann_GRAVY_IUpred2_TMHMM_5000, aes(x=TMHMM_minmax)) +
  geom_histogram(binwidth=0.1, fill="green", alpha=0.5) +
  labs(title="Distribution of minmax_normalized TMHMM Scores", x="Minmax_normalized IUpred2 Score", y="Frequency") +
  theme_minimal()

# Arranging the plots side by side 
p1_uprot_Min_max_normalized_G_I + p2_uprot_Min_max_normalized_G_I + p3_uprot_Min_max_normalized_G_I

```

```{r}
# Violin plot of min_max GRAVY scores of the combined dataset
# Custom colors 
my_colors_combined_z_sore_normalized_G_I <- c("Disordered_protein" = "red", "Globular_protein" = "green", "Membrane protein" = "blue", "Microprotein" = "yellow", "Peptides" = "pink")

# Reshape the dataframe to long format
df_long_combined_Min_max_normalized_G_I <- combined_Min_max_normalized_G_I %>%
  pivot_longer(cols = c("GRAVY_minmax","IUpred2_minmax" ,"TMHMM_minmax"),names_to = "property",values_to = "score")

# Function to create and adjust violin plot for a given property
create_violin_plot_combined_Min_max_normalized_G_I <- function(property_name, y_limits = NULL) {
  p <- ggplot(subset(df_long_combined_Min_max_normalized_G_I, property == property_name), aes(x = type, y = score, fill = type)) +
    geom_violin(trim = FALSE, adjust = 1.5) +  # adjust parameter smooths the violin plot
    geom_boxplot(width=0.05, fill="white", outlier.shape = NA, position=position_dodge(width=0.25)) + # Adjust width and position
    scale_fill_manual(values = my_colors_combined_z_sore_normalized_G_I) +
    theme_minimal() +
    theme(axis.text.x = element_text(angle = 45, hjust = 1),
          legend.position = "none") +
    labs(x = "Protein_Type", y = "Min-Max normalized scores", title = property_name)

  # Adjust y-axis limits if provided
  if (!is.null(y_limits)) {
    p <- p + ylim(y_limits)
  }

  return(p)
}

p_GRAVY_normalized_combined_Min_max_normalized_G_I <- create_violin_plot_combined_Min_max_normalized_G_I("GRAVY_minmax", c(0, 1))
print(p_GRAVY_normalized_combined_Min_max_normalized_G_I)
```


```{r}
# Violin plot of min_max IUpred2 scores of the combined dataset
p_IUpred2_normalized_combined_Min_max_normalized_G_I <- create_violin_plot_combined_Min_max_normalized_G_I("IUpred2_minmax", c(0, 1))
print(p_IUpred2_normalized_combined_Min_max_normalized_G_I)
```

```{r}
# Violin plot of min_max TMHMM scores of the combined dataset
p_TMHMM_normalized_combined_Min_max_normalized_G_I <- create_violin_plot_combined_Min_max_normalized_G_I("TMHMM_minmax", c(0, 1))
print(p_TMHMM_normalized_combined_Min_max_normalized_G_I)
```

```{r}
# Prepare the data for UMAP, selecting only the columns with the physical property values
umap_data_combined_Min_max_normalized_G_I <- combined_Min_max_normalized_G_I[, c("GRAVY_minmax","IUpred2_minmax","TMHMM_minmax")]
head(umap_data_combined_Min_max_normalized_G_I)
# Run UMAP
set.seed(4) # Set a random seed for reproducibility
umap_result_combined_Min_max_normalized_G_I <- umap(umap_data_combined_Min_max_normalized_G_I,n_neighbors=15, min_dist=0.3)

# Create a data frame for plotting that includes the UMAP dimensions and the protein type
plot_data_combined_Min_max_normalized_G_I <- data.frame(UMAP1 = umap_result_combined_Min_max_normalized_G_I$layout[,1], UMAP2 = umap_result_combined_Min_max_normalized_G_I$layout[,2], Type = combined_Min_max_normalized_G_I$type)
# Define custom colors for the plot
my_colors_combined_z_sore_normalized_G_I <- c("Disordered_protein" = "red", "Globular_protein" = "green", "Membrane protein" = "blue", "Microprotein" = "yellow", "Peptides" = "pink")

# Plot using ggplot2
plot_combined_Min_max_normalized_G_I_UMAP <- ggplot(plot_data_combined_Min_max_normalized_G_I, aes(x = UMAP1, y = UMAP2, color = Type)) +
  geom_point(size=0.75, alpha=0.75) + # Adjust point transparency with the alpha parameter
  scale_color_manual(values = my_colors_combined_z_sore_normalized_G_I) + # Use the custom colors
  labs(title = "UMAP Visualization of Human Protein Clusters_Weismann_Disprot_Scope_mpstruc_NCBI(Gravy_IUpred2_TMHMM_Min-max_normalized)",
       x = "UMAP Dimension 1",
       y = "UMAP Dimension 2",
       color = "Protein Type") +
  theme_minimal()
plot_combined_Min_max_normalized_G_I_UMAP
```

```{r}
# Perform t-SNE
set.seed(42) # Set a random seed for reproducibility
tsne_result_combined_Min_max_normalized_G_I <- Rtsne(dist(umap_data_combined_Min_max_normalized_G_I), dims = 2, perplexity = 20, theta = 0.0, max_iter= 1000, verbose = FALSE )

# Create a data frame for plotting that includes the t-SNE dimensions and the protein type
tsne_data_combined_Min_max_normalized_G_I <- data.frame(TSNE1 = tsne_result_combined_Min_max_normalized_G_I$Y[,1], TSNE2 = tsne_result_combined_Min_max_normalized_G_I$Y[,2], Type = combined_Min_max_normalized_G_I$type)

# Define custom colors for the plot
my_colors_combined_Min_max_normalized_G_I_normalized_G_I <- c("Disordered_protein" = "red", "Globular_protein" = "green", "Membrane protein" = "blue", "Microprotein" = "yellow", "Peptides" = "pink")

# Plot using ggplot2
plot_combined_Min_max_normalized_G_I <- ggplot(tsne_data_combined_Min_max_normalized_G_I, aes(x = TSNE1, y = TSNE2, color = Type)) +
   geom_point(size=0.65, alpha=0.75) + # Adjust point transparency with the alpha parameter
  scale_color_manual(values = my_colors_combined_Min_max_normalized_G_I_normalized_G_I) + # Use the custom colors
  labs(title = "t-SNE Visualization of Human Protein Clusters_Weismann_Disprot_Scope_mpstruc_NCBI(Gravy_IUpred2_TMHMM_Min_max_normalized)",
       x = "t-SNE Dimension 1",
       y = "t-SNE Dimension 2",
       color = "Protein Type") +
  theme_minimal()
plot_combined_Min_max_normalized_G_I
```

# Statistical testing for checking of the protein groups are different on the basis of prediction scores.
```{r}
# Loading the dataset
df_combined_disport_control6_5PP_J <- combined_disport_control6_5PP_J

# Inspecting the dataset
head(df_combined_disport_control6_5PP_J)

# Defining the properties to test
properties <- c("CIDH920105_norm", "CHOP780101_norm", "CHOP780201_norm", "CHOP780202_norm", "KLEP840101_norm")

# Function to perform subsampling
subsample_proteins <- function(data, sample_size = 100) {
  data %>%
    group_by(type) %>%
    sample_n(sample_size, replace = FALSE)
}

# Performing subsampling
subsampled_df <- subsample_proteins(df_combined_disport_control6_5PP_J)

# Checking the length distribution of the subsampled dataset
length_distribution <- subsampled_df %>%
  group_by(type) %>%
  summarise(mean_length = mean(length), sd_length = sd(length), count = n())

# Printing length distribution
cat("\nLength distribution of subsampled dataset:\n")
print(length_distribution)

# Plotting length distribution
ggplot(subsampled_df, aes(x = type, y = length, fill = type)) +
  geom_boxplot() +
  labs(title = "Length Distribution of Subsampled Dataset", x = "Protein Type", y = "Length") +
  theme_minimal()

```

```{r}
# Checking normality for each property
normality_results <- list()
for (property in properties) {
  normality_test <- shapiro.test(subsampled_df[[property]])
  normality_results[[property]] <- normality_test
}

# Printing normality test results
for (property in properties) {
  cat("\nNormality test results for", property, ":\n")
  print(normality_results[[property]])
}
```

# Visualizations using histograms,box,QQ,density plots on complete dataset.
```{r}
properties <- names(combined_disport_control6_5PP_J)[4:8] 

# Create a combined histogram plot for each property
for (property in properties) {
  ggplot(combined_disport_control6_5PP_J, aes_string(x = property, fill = 'type')) + 
    geom_histogram(binwidth = 0.1, alpha = 0.6, position = 'identity') + # adjust binwidth as needed
    facet_wrap(~type, scales = "free") + 
    theme_bw() +
    labs(title = paste("Histogram for", property), x = property, y = "Count") +
    theme(legend.position = "bottom") -> p
  
  print(p)
}

```

```{r}
# Create Q-Q plots for each property
for (property in properties) {
  ggplot(combined_disport_control6_5PP_J, aes_string(sample = property)) + 
    stat_qq() +
    stat_qq_line() +
    facet_wrap(~type, scales = "free") +
    theme_bw() +
    labs(title = paste("Q-Q Plot for", property)) -> p
  
  print(p)
}

# In the case of KLEP840101, the deviations from the line in the Q-Q plots suggest that the physicochemical properties for these protein types do not follow a normal distribution. This is particularly true for the tails of the distributions (both light and heavy tails) and is most pronounced in the "micro" and "peptide" protein types. If the points in the QQ plot fall approximately along a straight line, it suggests that the two distributions being compared are similar.
#If the points deviate systematically from a straight line, it indicates that the distributions differ. Deviations towards the ends of the line indicate that one distribution is more spread out than the other.
```

```{r}
# Create a density plot for each property
for (property in properties) {
  ggplot(combined_disport_control6_5PP_J, aes_string(x = property, fill = 'type')) + 
    geom_density(alpha = 0.6) +
    facet_wrap(~type, scales = "free") +
    theme_bw() +
    labs(title = paste("Density Plot for", property), x = property, y = "Density") +
    theme(legend.position = "bottom") -> p
  
  print(p)
}

# Conclusion: Overall, the plots suggest that the physicochemical property scores are not normally distributed. There are significant variations among the protein types, with some showing a sharp peak indicating that most proteins have similar physicochemical property scores, while others have a broader distribution.

#The skewness and multiple peaks in some protein types suggest that the underlying biological processes may produce these properties in a non-uniform manner, or there could be subgroups within the types that have different characteristics. These observations suggest caution when applying statistical tests that assume normal distributions, and they also provide insight into the biological variability inherent in these protein types.
```

# Performing Kruskal-Wallis test followed by pairwise comparison using dunn test (if  Kruskal-Wallis test results are found significant)
```{r}
# Performing Kruskal-Wallis test for each property
kruskal_results <- list()
for (property in properties) {
  formula <- as.formula(paste(property, "~ type"))
  kruskal_test <- kruskal.test(formula, data = subsampled_df)
  kruskal_results[[property]] <- kruskal_test
}

# Print Kruskal-Wallis results
for (property in properties) {
  cat("\nKruskal-Wallis test results for", property, ":\n")
  print(kruskal_results[[property]])
}
```

```{r}
# Performing post-hoc Dunn's test for each property
dunn_results <- list()
for (property in properties) {
  dunn_test <- dunnTest(subsampled_df[[property]] ~ subsampled_df$type, method = "bonferroni")
  dunn_results[[property]] <- dunn_test
}

# Print Dunn's test results
for (property in properties) {
  cat("\nDunn's test results for", property, ":\n")
  print(dunn_results[[property]])
}
```


# Script for analysis of AlphaFold results on 500 microprotein samples. Follwing things are being done:
# 1. plotting the distibution of plDDT scores
# 2. Checking correlation between plDDT scores and scores output from agadir wrapper

```{r}
average_plDDT <- read.table("/Users/namrataxxx/Desktop/Master_Thesis_material/Thesis_data_script_result/Weismann_Scope_MObiDB_Mpstruc_DimRed_JoostIDs/microproteins/average_plddt.txt", header=FALSE, sep="\t")
dim(average_plDDT) # 497  x  2
# Rename columns in average_plDDT
colnames(average_plDDT) <- c("protein", "plDDT")
View(average_plDDT)

# Create histogram with density overlay
ggplot(average_plDDT, aes(x = V2)) +
  geom_histogram(binwidth = 1, fill = "skyblue", color = "black", alpha = 0.5) +
  geom_density(aes(y = ..count..), fill = "orange", alpha = 0.5) +
  labs(title = "Distribution of plDDT Scores",
       x = "plDDT Score",
       y = "Frequency")

```

```{r}
# Filtering out proteins from second dataframe 
# Filter the normalized_human_uprot_weismann_8physpropsids data frame
filtered_data_pp_uprot <- normalized_human_uprot_weismann_8physpropsids %>%
  filter(protein %in% average_plDDT$protein)
# selecting only 5 pps
filtered_data_pp_uprot <- filtered_data_pp_uprot[c(1:8)]

# rename the physico-chemical property columns
colnames(filtered_data_pp_uprot) <- c("protein", "type","length","hydrophobicity","beta-turn frequency","alpha-helix frequency","beta-sheet frequency","net-charge")
# Check the result
View(filtered_data_pp_uprot)

# merging plDDT and pp dataframes
merged_data_plDDT_pp <- left_join(average_plDDT, filtered_data_pp_uprot, by = "protein")

# Check the result
View(merged_data_plDDT_pp)
```

```{r}
# Reshaping data from wide to long format
merged_data_plDDT_pp_scores <- merged_data_plDDT_pp[c(1,2,5:9)]
head(merged_data_plDDT_pp_scores)
long_data_plDDT_pp <- melt(merged_data_plDDT_pp_scores, id.vars = "protein", variable.name = "Property", value.name = "Score")
View(long_data_plDDT_pp)
# Standardizing the scores within the long_data dataframe
long_data_plDDT_pp$Score <- scale(long_data_plDDT_pp$Score)

# Plotting again with scaled scores
ggplot(long_data_plDDT_pp, aes(x = Property, y = Score)) +
  geom_violin(trim = FALSE) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  labs(title = "Normalized Distribution of pLDDT and Physico-Chemical Properties", x = "Property", y = "Normalized Score")

```

```{r}
# Print the column names of your dataframe
names(merged_data_plDDT_pp_scores)

# Calculate the correlation matrix
cor_matrix_merged_data_plDDT_pp <- cor(merged_data_plDDT_pp_scores[, c("plDDT", "hydrophobicity", "beta-turn frequency", "alpha-helix frequency", "beta-sheet frequency", "net-charge")], use = "complete.obs")

# Print the correlation matrix
print(cor_matrix_merged_data_plDDT_pp)

```

```{r}
# plots on scaled data
# Select columns to scale, assuming they start from the second column to the seventh
scaled_data <- merged_data_plDDT_pp_scores
scaled_data[2:7] <- scale(merged_data_plDDT_pp_scores[2:7])

# View the scaled data to confirm scaling
head(scaled_data)

# Plotting using standard evaluation
plot_list <- lapply(names(scaled_data)[2:7], function(property) {
  ggplot(scaled_data, aes(x = plDDT, y = .data[[property]])) +
    geom_point(alpha = 0.6) +
    geom_smooth(method = "lm", se = FALSE, color = "blue") +
    labs(title = paste("Scatter Plot of pLDDT vs", property),
         x = "pLDDT Score", y = property)
})

# Create and store the grid plot
if (length(plot_list) > 0) {
  combined_plot <- do.call(grid.arrange, plot_list)
}

# Save the plot
#ggsave("combined_plots.png", plot = combined_plot, width = 16, height = 8, dpi = 300)

```

```{r}
# Filtering microproteins with plDDT scores above 90 and below 50
average_plDDT_greaterthanEqual90 <- average_plDDT %>% filter(V2 >= 90)
dim(average_plDDT_greaterthanEqual90) # 9 x 2
View(average_plDDT_greaterthanEqual90)

average_plDDT_LessthanEqual50 <- average_plDDT %>% filter(V2 <= 50)
dim(average_plDDT_LessthanEqual50) # 15 x 2
View(average_plDDT_LessthanEqual50)
```


# This script contains PCA, k-mean clustering, UMAP and correlation analysis. UMAP plots are made with representative IDs obtained from k-means clsuters done on raw data. These IDs were not corresponding to the clsuters obtained from UMAP analysis.Then I did k-mean clustering on UMAP dimesnions whic gave some conclusive results. 

```{r}
# Loading the data
pc_data <- read_excel("/Users/namrataxxx/Desktop/Master_Thesis_material/Docs_by_Joost/Physical_properties_edited.xlsx")
View(pc_data)
# Converting tibble to data.frame
pc_data <- as.data.frame(pc_data)

# Setting the physicochemical property IDs as row names
rownames(pc_data) <- pc_data$AA
pc_data$AA <- NULL # remove the 'AA' column
View(pc_data)

# Standardizing the data by subtracting the mean and dividing by variance
pc_data_scaled <- scale(pc_data,center = TRUE, scale = TRUE)
#View(pc_data_scaled)
dim(pc_data_scaled)

```


```{r}
# Performing PCA on the scaled data
pca_scaled_t <- t(pc_data_scaled)
pca_result <- prcomp(pca_scaled_t, scale. = TRUE)
# Scree plot to visualize the significance of each principal component in explaining the variance
var_explained <- pca_result$sdev^2 / sum(pca_result$sdev^2)
ggplot(as.data.frame(var_explained), aes(x = seq_along(var_explained), y = var_explained)) +
  geom_line() +
  geom_point() +
  xlab("Principal Component") +
  ylab("Proportion of Variance Explained") +
  theme_minimal()
```

```{r}
# Calculating variance explained by each principal component
var_explained <- pca_result$sdev^2 / sum(pca_result$sdev^2)
var_explained_df <- data.frame(PC = seq_along(var_explained), Variance = var_explained)

# Creating the scree plot using ggplot2
ggplot(var_explained_df, aes(x = PC, y = Variance)) +
  geom_bar(stat = "identity", fill = "skyblue") +
  geom_text(aes(label = round(Variance, digits = 4)), vjust = -0.5, size = 3) +
  xlab("Principal Component") +
  ylab("Proportion of Variance Explained") +
  ggtitle("Scree Plot of PCA") +
  theme_minimal()

```

```{r}
# Extracting loadings for the first principal component
pc1_loadings <- pca_result$rotation[, "PC1"]

# Creating a data frame from the loadings
loadings_df <- data.frame(physprop_id = rownames(pca_result$rotation), loading = pc1_loadings)
#View(loadings_df)

# Sorting the dataframe by the absolute value of loading, and select the top 25
top_loadings <- loadings_df %>%
  arrange(desc(abs(loading))) %>%
  top_n(25, abs(loading))


ggplot(top_loadings, aes(x = reorder(physprop_id, loading), y = loading, fill = loading > 0)) +
  geom_bar(stat = "identity") +
  coord_flip() + # Flip the coordinates for better readability
  scale_fill_manual(values = c("red", "blue"), labels = c("Negative", "Positive")) +
  theme_minimal() +
  labs(x = "Physprop ID", y = "Loading Value", fill = "Loading Sign") +
  ggtitle("Top variables by Loading Value")


```



```{r}
# Performing UMAP dimensionality reduction
set.seed(42) # Set a seed for reproducibility
umap_result <- umap(pc_data_scaled)

# Performing k-means clustering on the UMAP results
set.seed(42) # Set a seed for reproducibility
kmeans_result <- kmeans(umap_result$layout, 8, 30) # Change the number of centers as needed

# Creating a dataframe for plotting UMAP results
umap_df <- data.frame(UMAP1 = umap_result$layout[,1], UMAP2 = umap_result$layout[,2], Labels = rownames(pc_data_scaled))
umap_df$Cluster <- as.factor(kmeans_result$cluster) # Assign cluster results to the dataframe

# Finding the closest point to each cluster's centroid
get_closest_points <- function(kmeans_result, umap_result) {
  centers <- kmeans_result$centers
  closest_points <- apply(centers, 1, function(center) {
    which.min(colSums((t(umap_result$layout) - center)^2))
  })
  return(closest_points)
}

closest_points <- get_closest_points(kmeans_result, umap_result)

# Extracting the representative IDs based on the indices found
representative_ids <- rownames(pc_data_scaled)[closest_points]


# Printing out the representative IDs
print(representative_ids)

```

```{r}
## Labeliing the calculated representative IDs on the UMAP plot along with IDs suggetsed by my host lab.
specific_ids <- c("CIDH920105", "CHOP780101", "CHOP780201", "CHOP780202", "KLEP840101", "TANS770110", "KARP850103", "CHAM830105", "QIAN880123", "CORJ870102", "ONEK900101" ,"RACS820105", "TANS770101")

# Creating a new label column that is blank by default, and label only the specific IDs
umap_df$IDLabels <- ifelse(umap_df$Labels %in% specific_ids, umap_df$Labels, '')

# Creating a custom color palette for clusters, avoiding the 'red' color to reserve it for specific IDs
cluster_colors <- setNames(rainbow(length(unique(kmeans_result$cluster))), unique(umap_df$Cluster))

# Overwriting the color for specific IDs to 'red'
cluster_colors[cluster_colors %in% specific_ids] <- 'red'

# Plotting the UMAP results with k-means clusters colored and specific IDs labeled in black
ggplot(umap_df, aes(x = UMAP1, y = UMAP2)) +
  geom_point(aes(color = Cluster), alpha = 0.5, size = 2) + # Color points based on cluster assignment
  geom_text(aes(label = IDLabels), color = "black", check_overlap = TRUE, hjust = 0.5, vjust = 0.5, size = 3) +
  scale_color_manual(values = cluster_colors) +
  theme_minimal() +
  labs(title = "UMAP with k-means clustering") +
  theme(legend.position = "none") +
  guides(color = guide_legend(override.aes = list(alpha = 1))) # Ensure legend is not semi-transparent

# Executing the plot
print(ggplot(umap_df, aes(x = UMAP1, y = UMAP2)) +
  geom_point(aes(color = Cluster), alpha = 0.5, size = 2) +
  geom_text(aes(label = IDLabels), color = "black", check_overlap = FALSE, hjust = 0.5, vjust = 0.5, size = 3) +
  scale_color_manual(values = cluster_colors) +
  theme_minimal() +
  labs(title = "UMAP with k-means centroids plotted (on UMAP dimesnions)") +
  theme(legend.position = "none") +
  guides(color = guide_legend(override.aes = list(alpha = 1))))


```

```{r}
# Performing UMAP dimensionality reduction
set.seed(42) 
umap_result <- umap(pc_data_scaled)

# Performing k-means clustering on the UMAP results
set.seed(42) 
kmeans_result <- kmeans(umap_result$layout, 8, 30) # Change the number of centers as needed

# Creating a dataframe for plotting UMAP results
umap_df <- data.frame(UMAP1 = umap_result$layout[,1], UMAP2 = umap_result$layout[,2], Labels = rownames(pc_data_scaled))
umap_df$Cluster <- as.factor(kmeans_result$cluster) # Assign cluster results to the dataframe

# Finding the closest point to each cluster's centroid
get_closest_points <- function(kmeans_result, umap_result) {
  centers <- kmeans_result$centers
  closest_points <- apply(centers, 1, function(center) {
    which.min(colSums((t(umap_result$layout) - center)^2))
  })
  return(closest_points)
}

closest_points <- get_closest_points(kmeans_result, umap_result)

# Extracting the representative IDs based on the indices found
representative_ids <- rownames(pc_data_scaled)[closest_points]

# Printing out the representative IDs
print(representative_ids)

# Defining the specific IDs you want to label in the UMAP plot
bold_black_ids <- c("CIDH920105", "CHOP780101", "CHOP780201", "CHOP780202", "KLEP840101")
bold_red_ids <- c("TANS770110", "KARP850103", "CHAM830105", "QIAN880123", "CORJ870102", "ONEK900101", "RACS820105", "TANS770101")

# Creating a new label column for specific IDs
umap_df$IDLabels <- ifelse(umap_df$Labels %in% c(bold_black_ids, bold_red_ids), umap_df$Labels, '')

# Creating a custom color palette for clusters
cluster_colors <- setNames(rainbow(length(unique(kmeans_result$cluster))), unique(umap_df$Cluster))

# Plotting the UMAP results with k-means clusters colored and specific IDs labeled

ggplot(umap_df, aes(x = UMAP1, y = UMAP2)) +
  geom_point(aes(color = Cluster), alpha = 0.5, size = 2) + # Color points based on cluster assignment
  geom_text(data = subset(umap_df, Labels %in% bold_black_ids),
            aes(label = Labels, fontface = "bold"),
            color = "black", check_overlap = TRUE, hjust = 0.5, vjust = 0.5, size = 3) +
  geom_text(data = subset(umap_df, Labels %in% bold_red_ids),
            aes(label = Labels, fontface = "bold"),
            color = "red", check_overlap = TRUE, hjust = 0.5, vjust = 0.5, size = 3) +
  scale_color_manual(values = cluster_colors) +
  theme_minimal() +
  labs(title = "UMAP with k-means centroids plotted (on UMAP dimensions)") +
  theme(legend.position = "none") +
  guides(color = guide_legend(override.aes = list(alpha = 1)))

```


```{r}
## Labeliing the calculated representative IDs on the UMAP plot along with IDs suggetsed by Joost.

specific_ids <- c("CIDH920105", "CHOP780101", "CHOP780201", "CHOP780202", "KLEP840101", "KARP850103", "CHAM830105", "ONEK900101")

# Creating a new label column that is blank by default, and label only the specific IDs
umap_df$IDLabels <- ifelse(umap_df$Labels %in% specific_ids, umap_df$Labels, '')

# Creating a custom color palette for clusters, avoiding the 'red' color to reserve it for specific IDs
cluster_colors <- setNames(rainbow(length(unique(kmeans_result$cluster))), unique(umap_df$Cluster))

# Overwriting the color for specific IDs to 'red'
cluster_colors[cluster_colors %in% specific_ids] <- 'red'

# Plotting the UMAP results with k-means clusters colored and specific IDs labeled in black
ggplot(umap_df, aes(x = UMAP1, y = UMAP2)) +
  geom_point(aes(color = Cluster), alpha = 0.5, size = 2) + # Color points based on cluster assignment
  geom_text(aes(label = IDLabels), color = "black", check_overlap = TRUE, hjust = 0.5, vjust = 0.5, size = 3) +
  scale_color_manual(values = cluster_colors) +
  theme_minimal() +
  labs(title = "UMAP with k-means clustering") +
  theme(legend.position = "none") +
  guides(color = guide_legend(override.aes = list(alpha = 1))) # Ensure legend is not semi-transparent

# Executing the plot
print(ggplot(umap_df, aes(x = UMAP1, y = UMAP2)) +
  geom_point(aes(color = Cluster), alpha = 0.5, size = 2) +
  geom_text(aes(label = IDLabels), color = "black", check_overlap = FALSE, hjust = 0.5, vjust = 0.5, size = 3) +
  scale_color_manual(values = cluster_colors) +
  theme_minimal() +
  labs(title = "UMAP with k-means clustering (on UMAP dimesnions)") +
  theme(legend.position = "none") +
  guides(color = guide_legend(override.aes = list(alpha = 1))))


```

```{r}
# Defining the specific IDs you want to label in the UMAP plot
bold_black_ids <- c("CIDH920105", "CHOP780101", "CHOP780201", "CHOP780202", "KLEP840101")
bold_red_ids <- c("KARP850103", "CHAM830105", "ONEK900101")

# Creating a new label column for specific IDs
umap_df$IDLabels <- ifelse(umap_df$Labels %in% c(bold_black_ids, bold_red_ids), umap_df$Labels, '')

# Creating a custom color palette for clusters
cluster_colors <- setNames(rainbow(length(unique(kmeans_result$cluster))), unique(umap_df$Cluster))

# Plotting the UMAP results with k-means clusters colored and specific IDs labeled

ggplot(umap_df, aes(x = UMAP1, y = UMAP2)) +
  geom_point(aes(color = Cluster), alpha = 0.5, size = 2) + # Color points based on cluster assignment
  geom_text(data = subset(umap_df, Labels %in% bold_black_ids),
            aes(label = Labels, fontface = "bold"),
            color = "black", check_overlap = TRUE, hjust = 0.5, vjust = 0.5, size = 3) +
  geom_text(data = subset(umap_df, Labels %in% bold_red_ids),
            aes(label = Labels, fontface = "bold"),
            color = "red", check_overlap = TRUE, hjust = 0.5, vjust = 0.5, size = 3) +
  scale_color_manual(values = cluster_colors) +
  theme_minimal() +
  labs(title = "UMAP with k-means centroids plotted (on UMAP dimensions)") +
  theme(legend.position = "none") +
  guides(color = guide_legend(override.aes = list(alpha = 1)))

```



```{r}
# Defining the specific IDs and their descriptions
specific_ids <- c("CIDH920105", "CHOP780101", "CHOP780201", "CHOP780202", "KLEP840101",
                  "KARP850103", "CHAM830105", "ONEK900101")
descriptions <- c("Normalized average hydrophobicity scales", "Normalized frequency of beta-turn",
                  "Normalized frequency of alpha-helix", "Normalized frequency of beta-sheet",
                  "Net charge", "The number of atoms in the side chain labelled 3+1",
                  "Flexibility parameter for two rigid neighbors", "Delta G values for the peptides extrapolated to 0 M urea")

# Creating a named vector for easy lookup
descriptions_map <- setNames(descriptions, specific_ids)

# Updating the IDLabels column to include the description
umap_df$IDLabels <- ifelse(umap_df$Labels %in% specific_ids, paste(umap_df$Labels, ":", descriptions_map[umap_df$Labels]), '')

# Getting unique clusters excluding the specific IDs
unique_clusters <- setdiff(unique(umap_df$Cluster), specific_ids)

# Creating a custom color palette for clusters, ensuring it matches the number of unique cluster identifiers
cluster_colors <- setNames(rainbow(length(unique_clusters)), unique_clusters)

# Overwriting the color for specific IDs to 'red'
specific_id_colors <- setNames(rep('red', length(specific_ids)), specific_ids)
full_colors <- c(cluster_colors, specific_id_colors)

# Ensuring that the color vector has entries for all possible clusters
full_colors <- full_colors[as.character(umap_df$Cluster)]

# Plotting the UMAP results with enhanced labeling
ggplot(umap_df, aes(x = UMAP1, y = UMAP2)) +
  geom_point(aes(color = as.factor(Cluster)), alpha = 0.5, size = 2) +
  geom_text(aes(label = IDLabels), color = "black", check_overlap = TRUE, hjust = 0.5, vjust = 0.5, size = 3) +
  scale_color_manual(values = full_colors) +
  theme_minimal() +
  labs(title = "UMAP with k-means clustering") +
  theme(legend.position = "none") +
  guides(color = guide_legend(override.aes = list(alpha = 1)))

# Executing the plot with annotations
print(ggplot(umap_df, aes(x = UMAP1, y = UMAP2)) +
  geom_point(aes(color = as.factor(Cluster)), alpha = 0.5, size = 2) +
  geom_text(aes(label = IDLabels), color = "black", check_overlap = TRUE, hjust = 0.5, vjust = 0.5, size = 3) +
  scale_color_manual(values = full_colors) +
  theme_minimal() +
  labs(title = "UMAP with k-means clustering (on UMAP dimensions)") +
  theme(legend.position = "none") +
  guides(color = guide_legend(override.aes = list(alpha = 1))))

```

```{r}
## Visualizing k-means cluster (on raw data) on UMAP plot
# Compute the k-means cluster object for k clusters
set.seed(42) # Set a random seed for reproducibility
k <- 5 # Number of clusters
pc_kmeans <- kmeans(pc_data_scaled,5,20)

# Perform UMAP
set.seed(10)
umap_result <- umap(pc_data_scaled)

# Create a dataframe for plotting
plot_data <- data.frame(UMAP1 = umap_result$layout[,1],
                        UMAP2 = umap_result$layout[,2],
                        Cluster = as.factor(pc_kmeans$cluster))

# Plotting using ggplot2
ggplot(plot_data, aes(x = UMAP1, y = UMAP2, color = Cluster)) +
  geom_point(alpha = 0.8) + # Set transparency to see overlapping points
  scale_color_brewer(palette = "Set1") + # Color palette for clusters
  theme_minimal() +
  labs(title = "UMAP visualization with k-means clusters",
       x = "UMAP Dimension 1",
       y = "UMAP Dimension 2") +
  theme(legend.title = element_blank()) # Remove legend title

# Executing the plot
print(ggplot(plot_data, aes(x = UMAP1, y = UMAP2, color = Cluster)) +
        geom_point(alpha = 0.8) +
        scale_color_brewer(palette = "Set1") +
        theme_minimal() +
        labs(title = "UMAP visualization with k-means clusters",
             x = "UMAP Dimension 1",
             y = "UMAP Dimension 2") +
        theme(legend.title = element_blank()))



```


